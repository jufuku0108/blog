<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Japan Azure Identity Support Blog</title>
  
  <subtitle>日本マイクロソフトの Azure Active Directory と AD FS に関するサポート情報のブログです。</subtitle>
  <link href="https://jpazureid.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpazureid.github.io/blog/"/>
  <updated>2021-12-10T10:01:41.265Z</updated>
  <id>https://jpazureid.github.io/blog/</id>
  
  <author>
    <name>Azure Identity Support Japan</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ID の保護をより広範囲に</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/more-coverage-to-protect-your-identities/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/more-coverage-to-protect-your-identities/</id>
    <published>2021-12-07T21:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.265Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2021 年 11 月 29 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/more-coverage-to-protect-your-identities/ba-p/2365685">AMore coverage to protect your identities</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p><a href="https://myignite.microsoft.com/sessions/fe5951da-9fa5-4e09-b529-007fff7a2add?source=sessions">Microsoft Ignite 2021</a> では、激化する ID への攻撃から守るために、Microsoft がサイバー セキュリティのコミュニティとどのように協力してきたかを紹介しました。今回のブログ記事では、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/overview-identity-protection">Azure Active Directory (AD) Identity Protection</a> と <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/overview">条件付きアクセス</a> について発表された ID セキュリティ機能について深く掘り下げてみたいと思います。これらの ID セキュリティ機能は以下のような機能を提供します。</p><ul><li>新たな脅威の見える化 (Identity Protection におけるトークン窃取の検出)</li><li>ほぼリアルタイムでの保護 (継続的なアクセス評価)</li><li>ワークロード ID への保護の拡張 (ワークロード ID 用の条件付きアクセス)</li></ul><h2 id="新たな攻撃手段の検出-トークン窃取の検出"><a href="#新たな攻撃手段の検出-トークン窃取の検出" class="headerlink" title="新たな攻撃手段の検出: トークン窃取の検出"></a>新たな攻撃手段の検出: トークン窃取の検出</h2><p>攻撃者はトークンを窃取して再利用し、被害をうけるリソースに継続的にアクセスしたり、取得済みの多要素認証のクレームを取得して高い権限を取得したりする場合が増えています。トークンの窃取は、主にマルウェアや MITM (Machine-In-The-Middle) のフィッシング攻撃によって行われています。攻撃者はユーザーやアプリなどの ID からトークンを盗むと、それを使って ID になりすまし、データを盗むことができます。</p><p><img src="/blog/azure-active-directory/more-coverage-to-protect-your-identities/illustration-of-how-token-theft-happens.png" alt="図 1: トークンの窃取発生時の図解"></p><p>Ignite では、トークンの再利用について管理者に警告する <strong>2 つの新しい検出機能</strong> の一般提供を発表しました。それぞれ「<strong>異常なトークン</strong>」と「<strong>セッション クッキーの通常とは異なるサインイン プロパティ</strong>」です。これらの新しい検出機能は、トークン内のクレーム、トークンが発行されてからの時間、およびその他の認証属性に異常がないかを確認します。これらのリスクが検出された場合、まずはユーザーのアクティブなトークンを失効させ、トークンがどのように盗まれたかを評価し、マルウェアが存在する場合はそれを除去するまでユーザーのアクセスをブロックするようご対応ください。アクティブなトークンの失効については、Revoke-AzureADUserAllRefreshToken の PowerShell コマンドレットを使用いただけます。</p><p><img src="/blog/azure-active-directory/more-coverage-to-protect-your-identities/new-token-detection-image.png" alt="図 2: 異常なトークンとトークン発行者の異常が検出された際の管理画面"></p><p>トークン再利用の検知と防止に加えて、トークンの窃取を検知して対応する機能を開発しています。次の検知機能である <strong>トークン発行者の異常</strong> は、攻撃者がトークンを自由に発行できてしまう、侵害されたオンプレミスの SAML ID プロバイダーを特定するための最初の取り組みとなります。この検出結果を調査した結果、攻撃があったと判断した場合は次のことを行うようお勧めします。</p><ul><li>署名証明書の不正使用の原因を特定し排除する。</li><li>すべての <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/manage-certificates-for-federated-single-sign-on">SAML トークン署名証明書</a> を入れ替える。</li><li>Revoke-AzureADUserAllRefreshToken の PowerShell コマンドレットを使用してアクティブなトークンを取り消す。</li><li>AD FS を使用している場合は、<a href="https://docs.microsoft.com/ja-jp/windows-server/identity/ad-fs/deployment/best-practices-securing-ad-fs">AD FS と Web Application Proxy の安全性を確保するためのベスト プラクティス</a> を確認する。</li><li><a href="https://aka.ms/protectm365">https://aka.ms/protectm365</a> に基づきオンプレミスの SAML 信頼への依存度を減らす。</li><li><a href="https://docs.microsoft.com/ja-jp/azure/dedicated-hsm/faq">HSM を使用して SAML トークン署名証明書を管理</a> する。</li></ul><h2 id="ほぼリアルタイムでのポリシー適用-継続的なアクセス評価"><a href="#ほぼリアルタイムでのポリシー適用-継続的なアクセス評価" class="headerlink" title="ほぼリアルタイムでのポリシー適用: 継続的なアクセス評価"></a>ほぼリアルタイムでのポリシー適用: 継続的なアクセス評価</h2><p>新しい検知機能は、セッションや更新トークンが悪意を持って再利用された際の検知に有効です。しかし、認証プロトコルでは、トークンをチェックするのはそれらが更新されたときのみです (アクセス トークンの場合、通常 1 時間に 1 回程度)。つまり、ユーザーやポリシーの状態の変化を検知するには、更新間隔の時間分だけ遅れてしまうのです。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">継続的なアクセス評価 (CAE)</a> は、Azure AD がアプリとのやり取りを維持して、そのギャップを解消するための仕組みです。CAE は、ユーザーのサインインがブロックされたり、信頼できない場所に移動したり、ユーザーのリスクが検出されたりするなど、条件の変化にリスクが生じた場合に、リアルタイムでアクセスを取り消すことができます。</p><p>例えば、CAE を有効にして、信頼できない IP 範囲やマルウェアに感染したデバイスをブロックするように条件付きアクセス ポリシーを構成することができます。これを有効にすると、信頼できる IP 範囲にある感染したデバイスから盗まれたトークンは、信頼できる範囲外で再利用されると拒否されます (悪意があると想定されるため)。このようなことが起こる前であっても、トークンを盗んでいるマルウェアが検出された場合、トークンを無効にすることができます。CAE と Identity Protection が連携することで、定義した条件以外でのトークンの再利用をブロックし、トークンの再利用が試みられた場合には、それを検知して自動的に修復します。CAE は、<strong>2021 年末までに一般提供</strong> を開始する予定です。それ以降は、CAE の構成を何も変更していない場合は、デフォルトで CAE が有効になります (何か構成を変更している場合は、その設定が尊重されます)。それまでは、条件付きアクセス配下の設定で CAE の構成を変更することができます。</p><h2 id="保護の範囲をさらに拡大-ワークロード-ID-用の条件付きアクセス"><a href="#保護の範囲をさらに拡大-ワークロード-ID-用の条件付きアクセス" class="headerlink" title="保護の範囲をさらに拡大: ワークロード ID 用の条件付きアクセス"></a>保護の範囲をさらに拡大: ワークロード ID 用の条件付きアクセス</h2><p>洗練され、組織的で様々な手法を組み合わせた攻撃が増加しています。そのため、すべての企業や組織にとって、<a href="https://docs.microsoft.com/ja-jp/security/zero-trust/">ゼロ トラスト戦略</a> が必須となっています。ゼロ トラストの中核となるのが、Azure AD 条件付きアクセスであり、この機能ではすべての ID に対して明示的に検証を行います。人間の ID を保護するだけでなく、アプリやサービス プリンシパルなどのワークロード ID を用いたアプリのみの認証も保護するように、条件付きアクセスの機能を拡張しています。環境内のワークロード ID を保護することは、悪意のある人物がこれらの ID を侵害および使用して環境にアクセスすることを防ぐために重要です。</p><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/workload-identity">ワークロード ID 用の条件付きアクセス</a> では、信頼できるネットワーク外からの認証をブロックすることで、サービス プリンシパルの不正使用を防ぐことができます。ワークロード ID のための条件付きアクセスは、現在パブリック プレビュー中です。</p><p><img src="/blog/azure-active-directory/more-coverage-to-protect-your-identities/admin-experience-for-conditional-access-for-workload-identities.png" alt="図 3: ワークロード ID 用の条件付きアクセスの管理画面"></p><p>Microsoft Ignite 2021 をお楽しみいただけておりましたら幸いです。質問やコメントがありましたら、お声がけください。皆様からのフィードバックをお待ちしております。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 29 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techc</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>条件付きアクセスにワークロード ID を対象とする機能がプレビューとして追加されました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-ca-for-workload-id/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-ca-for-workload-id/</id>
    <published>2021-12-07T08:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.213Z</updated>
    
    <content type="html"><![CDATA[<p>本記事は <a href="https://qiita.com/advent-calendar/2021/microsoft-azure-tech">Azure Tech Advent Calendar 2021</a> 7 日目の記事です。<br>Japan Azure Identity Support Blog では、お問合せの多い事象へのトラブルシューティング方法や、英文で公開された記事の日本語訳の情報を発信しています。今回の記事では、以下のプレビュー機能の紹介となります。</p><p>ワークロード ID 用の条件付きアクセス (プレビュー)<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/workload-identity">https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/workload-identity</a></p><p>従来、条件付きアクセスは “ユーザー” の “リソース” へのサインインを制御する機能でした。今回のプレビューによって、”ワークロード ID” というサービス プリンシパルのサインインに対して IP アドレス ベースの制御を構成することが可能になりました。</p><p>この記事は、2021/12 の記事作成時点における公開情報の内容を補足することを目的としています。最新の情報については、公開情報のページを確認ください。<br>まずは、この機能の対象について、Azure の利用者向けの補足になるような情報をまとめています。後半には、Azure AD の管理者寄りの情報を記載しています。</p><h2 id="ワークロード-ID-と該当するサインインの操作について"><a href="#ワークロード-ID-と該当するサインインの操作について" class="headerlink" title="ワークロード ID と該当するサインインの操作について"></a>ワークロード ID と該当するサインインの操作について</h2><p>この機能で制御対象となるのは、例えば、以下の方法を利用したサインインです。</p><ul><li><code>az login --service-principal -u &lt;app-id&gt; -p &lt;password-or-cert&gt; --tenant &lt;tenant&gt;</code><br>参考 : <a href="https://docs.microsoft.com/ja-jp/cli/azure/authenticate-azure-cli#sign-in-with-a-service-principal">Azure CLI を使用してサインインする</a></li><li><code>Connect-AzAccount -CertificateThumbprint $Thumbprint -ApplicationId $ApplicationId -Tenant $TenantId -ServicePrincipal</code><br>参考 : <a href="https://docs.microsoft.com/en-us/powershell/module/az.accounts/Connect-AzAccount?view=azps-6.6.0#example-7--connect-using-certificates">Connect-AzAccount</a></li><li><code>Connect-AzureAD -TenantId $tenant.ObjectId -ApplicationId  $sp.AppId -CertificateThumbprint $thumb</code><br>参考 : <a href="https://docs.microsoft.com/en-us/powershell/module/azuread/connect-azuread?view=azureadps-2.0#example-3--connect-a-session-as-a-service-principal">Connect-AzureAD</a></li></ul><p>これらのサインインでは、ユーザーの資格情報なしにサービス プリンシパルの権限でサインインを行います。この場合、事前にサブスクリプションやテナントの管理者がサービス プリンシパルに対しリソースへのアクセス権を付与し、サービス プリンシパルはその権限の範囲でリソースアクセスが可能となります。<br>このようにユーザー操作を必要とせずサービス プリンシパルに割り当てられた権限を利用し、定期的に情報を取得したり、リソースを変更するようなバッチ処理を行うようなアプリをワークロード ID と呼んでいます。</p><p>ワークロード ID は、ユーザーとは異なり、バッチ処理を行うスクリプト内、もしくはマシンにアプリケーションの資格情報が保存されています。<br>環境内のワークロード ID を保護することは、悪意のある人物がこれらの ID を侵害し、不正にアクセスすることを防ぐために重要です。<br>ワークロード ID の条件付きアクセスでは、<strong>信頼できるネットワーク外からの認証をブロックすることで、サービス プリンシパルの不正使用を防ぐことができます。</strong></p><p>現時点におけるワークロード ID と判別されるアプリケーションは、シングルテナント アプリケーションのみです。<br>シングル テナントアプリケーションが登録されるのは、Azure Portal から登録する際に、<code>Azure Active Directory</code> &gt; <code>アプリの登録</code> &gt; <code>+ 新規登録</code>  からアプリを追加する際に <strong>“この組織ディレクトリのみに含まれるアカウント”</strong> を選択して作成した場合です。</p><p><img src="/blog/azure-active-directory/introducing-ca-for-workload-id/1_signInAudience.png" alt="signInAudience の確認"></p><p>上記以外にも、以下のコマンドで作成されたアプリケーションなども該当します。</p><p><code>az ad sp create-for-rbac</code><br>参考 : <a href="https://docs.microsoft.com/en-us/cli/azure/ad/sp?view=azure-cli-latest">az ad sp</a></p><p>現時点では、次の分類のサービス プリンシパルはワークロード ID には含まれません。</p><ul><li>マネージド ID</li><li>マルチテナント アプリケーション (サードパーティー の SaaS アプリ)</li><li>マイクロソフトが提供するサービスが動作するためのアプリケーション</li></ul><h2 id="制御対象となったときの動作"><a href="#制御対象となったときの動作" class="headerlink" title="制御対象となったときの動作"></a>制御対象となったときの動作</h2><p>ワークロード ID 用の条件付きアクセスの機能によってサインインがブロックされたとき、Azure AD から 400 エラーとともに、次に例示するメッセージが返されます。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;error&quot;</span>: <span class="string">&quot;invalid_grant&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;error_description&quot;</span>: <span class="string">&quot;AADSTS53003: Access has been blocked by Conditional Access policies. The access policy does not allow token issuance.\r\nTrace ID: a50bbe59-dd02-42f6-b6b1-3931021e0f02\r\nCorrelation ID: 355da6cc-ab30-4456-91aa-0be3e8e0925c\r\nTimestamp:****&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;error_codes&quot;</span>: [</span><br><span class="line">        <span class="number">53003</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;timestamp&quot;</span>: <span class="string">&quot;****&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;trace_id&quot;</span>: <span class="string">&quot;a50bbe59-dd02-42f6-b6b1-3931021e0f02&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;correlation_id&quot;</span>: <span class="string">&quot;355da6cc-ab30-4456-91aa-0be3e8e0925c&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;error_uri&quot;</span>: <span class="string">&quot;https://login.microsoftonline.com/error?code=53003&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;suberror&quot;</span>: <span class="string">&quot;message_only&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;claims&quot;</span>: <span class="string">&quot;&#123;\&quot;access_token\&quot;:&#123;\&quot;capolids\&quot;:&#123;\&quot;essential\&quot;:true,\&quot;values\&quot;:[\&quot;da9d1d9d-2cf5-498f-8463-69025e65fe48\&quot;]&#125;&#125;&#125;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AADSTS53003 は、条件付きアクセスによってサインインがブロックされたときに表示されるメッセージです。<br>条件付きアクセスは、組織の管理者によって設定されています。現状 IP アドレスの制御のみが構成できるため、現在の実行環境からのアクセスがブロックされるように構成されている可能性があります。<br>ポリシーを変更する権限を持たない場合は、アクセス可能なように設定変更することはできないため、必要に応じてテナント内で権限を持つ管理者に確認ください。</p><h2 id="ポリシーの設定に関連する補足"><a href="#ポリシーの設定に関連する補足" class="headerlink" title="ポリシーの設定に関連する補足"></a>ポリシーの設定に関連する補足</h2><p>設定を行う管理者向けに、補足となるような情報を QA 形式でまとめてみました。参考になりましたら幸いです。</p><p>Q.  条件付きアクセスをワークロード ID 用に構成しようとすると、UI 上で選択できる項目が減ってしまう。設定する方法はないか？</p><p>A.  ポリシーの対象をワークロード ID にした場合、ワークロード ID 用の条件付きアクセスの機能で現在利用できる項目のみの表記に変わります。<br><code>クラウド アプリまたは操作</code> の項目では、**”すべてのクラウド アプリ”** を選び、すべてのサインインが対象になるように構成する必要があります。<br>また、現在構成可能なのは IP アドレス ベースの条件と、制御としてブロックのみ利用できます。</p><hr><p>Q.  組織内で、ワークロード ID に分類されるアプリを確認したい。</p><p>A.  ワークロード ID に分類されるオブジェクトは、少なくとも <code>Azure Active Directory</code> &gt; <code>アプリの登録</code> &gt; <code>(対象のアプリを選択)</code> &gt; <code>認証</code>  の項目から <code>サポートされているアカウントの種類</code> が <strong>“この組織ディレクトリのみに含まれるアカウント”</strong> として設定されているものです。</p><p><img src="/blog/azure-active-directory/introducing-ca-for-workload-id/2_signInAudience.png" alt="signInAudience の確認"></p><p>ワークロード ID に分類されるアプリを抽出することを目的に、取得できるアプリケーションの一覧から対象外となるアプリを除く例について紹介します。<br>シングルテナント アプリを取得して、3rd Party の SaaS 用のアプリを除きます。<br>一部、マイクロソフトのサービスを利用するためのアプリが含まれる可能性があります。</p><p>以下のスクリプトをグローバル管理者のアカウントを利用して実行ください。<br>Microsoft Graph PowerShell SDK を利用するため、事前に以下のコマンドでモジュールをインストールします。</p><p><code>Install-Module Microsoft.Graph</code><br>参考 : <a href="https://github.com/microsoftgraph/msgraph-sdk-powershell">Microsoft Graph PowerShell SDK</a></p><p>次のコマンドを順に実行します。<br>グローバル管理者でのサインイン時に、Microsoft Graph PowerShell SDK に対する Application.Read.All の権限を許可するように表示された場合は、承諾する必要があります。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Connect-MgGraph</span> <span class="literal">-Scope</span> <span class="string">&quot;Application.Read.All&quot;</span></span><br><span class="line"><span class="built_in">Get-MgApplication</span> <span class="literal">-Filter</span> <span class="string">&quot;signInAudience eq &#x27;AzureADMyOrg&#x27;&quot;</span> <span class="literal">-All</span> | <span class="built_in">where</span> &#123;<span class="variable">$_</span>.ApplicationTemplateId <span class="operator">-eq</span> <span class="variable">$null</span>&#125;</span><br></pre></td></tr></table></figure><p>出力結果は以下のコマンドなどで CSV 形式で保存できます。</p><figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">Get-MgApplication</span> <span class="literal">-Filter</span> <span class="string">&quot;signInAudience eq &#x27;AzureADMyOrg&#x27;&quot;</span> <span class="literal">-All</span> | <span class="built_in">where</span> &#123;<span class="variable">$_</span>.ApplicationTemplateId <span class="operator">-eq</span> <span class="variable">$null</span>&#125; | <span class="built_in">select</span> DisplayName,AppId,SignInAudience |  <span class="built_in">Export-Csv</span> <span class="literal">-Path</span> <span class="string">&quot;&lt;出力先のパス&gt;&quot;</span> <span class="literal">-NoTypeInformation</span></span><br></pre></td></tr></table></figure><hr><p>Q.  マネージド ID の利用に関しても何かしらの制御を構成したい。</p><p>A.  ワークロード ID の条件付きアクセスにおいては、マネージド ID は対象外であるため、割り当てられているロールが適切であるか確認します。<br>Azure AD 内のユーザーやグループの操作は、グローバル管理者などが適切なロールや権限を付与しない限り、変更できません。</p><hr><p>Q.  制御の適用状況を確認したい。</p><p>A.  サインイン ログを確認します。<br><code>Azure Active Directory</code> &gt; <code>サインイン ログ</code> の項目から表示するログを <code>サービス プリンシパルのサインイン</code> に変更します。<br>サービス プリンシパルのサインインでは、同じサインインリクエストは指定された時間でまとめて表示されます。<br>まとめられた項目を展開すると、それぞれのサインインの詳細を選択することができるようになるため、確認したい項目を選択します。(画像内 3 ~ 4)</p><p><img src="/blog/azure-active-directory/introducing-ca-for-workload-id/3_GuideServicePrincipalLogs.png" alt="サービスプリンシパル ログの確認"></p><p>表示されたブレードにて、<code>条件付きアクセス</code> のタブを選択します。<br>設定したポリシー名を選択します。</p><p><img src="/blog/azure-active-directory/introducing-ca-for-workload-id/4_ca-tab.png" alt="サービスプリンシパル ログの確認"></p><p>以下は、許可していない IP アドレスからのサインインがブロックされたときの例です。<br>この点はユーザーの条件付きアクセスと同じような確認ができます。</p><p><img src="/blog/azure-active-directory/introducing-ca-for-workload-id/5_ca-result.png"></p><hr><p>Q.  対象とするアプリケーションの一覧に表示されるのに、選択できないアプリがある。以下の画像の様な表示を確認する。</p><p><img src="/blog/azure-active-directory/introducing-ca-for-workload-id/6_SearchMultiTenantApp2.png" alt="対象とするアプリの検索"></p><p>A.  <code>サポートされているアカウントの種類</code> がマルチ テナントとなっているアプリである可能性があります。<br>現状の動作として、対象のアプリケーションを選択する際に、<code>アプリの登録</code> &gt; <code>対象のアプリを選択</code> &gt; <code>認証</code>  の項目にある <code>サポートされているアカウントの種類</code> が <strong>“任意の組織ディレクトリ内のアカウント (任意の Azure AD ディレクトリ - マルチ テナント)”</strong> として設定されているアプリは、対象として選択できません。<br>マルチ テナントアプリとして設定されている場合は、ワークロード ID に含まれないためです。<br>あらためて、ワークロード ID に含まれないアプリは、以下に分類されるアプリとなります。</p><ul><li>マネージド ID</li><li>マルチテナント アプリケーション (サードパーティー の SaaS アプリ)</li><li>マイクロソフトが提供するサービスが動作するためのアプリケーション</li></ul><hr><p>プレビュー機能である、ワークロード ID の条件付きアクセスについて紹介しました。<br>主に、どういった操作がワークロード ID のサインインとして対象となるのか、その具体例について補足してみました。<br>上記内容が少しでも参考となりますと幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事は &lt;a href=&quot;https://qiita.com/advent-calendar/2021/microsoft-azure-tech&quot;&gt;Azure Tech Advent Calendar 2021&lt;/a&gt; 7 日目の記事です。&lt;br&gt;Japan Azure </summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Conditional Access Policy" scheme="https://jpazureid.github.io/blog/tags/Conditional-Access-Policy/"/>
    
  </entry>
  
  <entry>
    <title>TKPG-F8G 署名キーのロールオーバー頻度の変更について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/tkpg-f8g-changes-to-signing-key-rollover-frequency/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/tkpg-f8g-changes-to-signing-key-rollover-frequency/</id>
    <published>2021-12-02T01:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.357Z</updated>
    
    <content type="html"><![CDATA[<p>2021-12-01 にサービス正常性通知の TKPG-F8G にて通知されております、「Action recommended: Azure Changes to Signing Key Rollover Frequency description: Active: Action recommended: Azure Changes to Signing Key Rollover Frequency service」について、具体的な通知の内容について解説いたします。</p><blockquote><p>You’re receiving this notice because you use Azure Active Directory (Azure AD).<br>At Microsoft, we want to ensure that we’re providing our customers with frequently rotated signing keys for security tokens. This announcement is a courtesy notification to Azure AD application developers that we’re making changes to the signing key rotation frequency.<br>What is the Microsoft Identity change?<br>To provide greater security for signing key rollover, there will be a gradual increase in the frequency of key rollovers starting in December until a one-week frequency is reached over the course of several months.<br>Previously, Microsoft informed customers that the Microsoft identity platform’s signing key rolls on a periodic basis and, in the case of an emergency, could be rolled over immediately. There will continue to be no set or guaranteed time between these key rolls. Any application that integrates with the Microsoft identity platform should be prepared to handle a key rollover event no matter how frequently it may occur.</p><p>Am I affected by this change?<br>How your application handles key rollover depends on variables such as the type of application or what identity protocol and library was used. As such, not all Azure AD applications will be affected.<br>Please reference our documentation and follow the instructions to assess if your application will be affected. If your application will be affected, follow the guidance on how to update the application to support automatic key rollover or manually update the key to prevent impact.<br>If you have any questions or concerns, please contact us.</p></blockquote><h2 id="OverView"><a href="#OverView" class="headerlink" title="OverView"></a>OverView</h2><p>Azure AD では OpenID Connect などの標準技術を利用し、公開鍵基盤を利用したアプリケーション間の信頼を構成しています。具体的には Azure AD が保持する秘密鍵を利用しトークンに署名を行い、連携先のアプリケーションはメタデータとして公開されている公開鍵を利用し、署名の検証を行いトークンの有効性を確認します。</p><p>メタデータとして公開されている公開鍵は、これまでもセキュリティ上の理由から定期的にロールオーバーされていました。一方でそのロールオーバーがより頻繁に行われるようになる旨を今回の通知ではご案内しております。具体的には、これまで約 6 週おきにロールオーバーされていたものが 12 月から順次更新間隔を短くし、数ヶ月かけて 1 週間の頻度に達するようにします。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/active-directory-signing-key-rollover?WT.mc_id=Portal-Microsoft_Azure_Health#overview-of-signing-keys-in-the-microsoft-identity-platform">Microsoft ID プラットフォームでの署名キーのロールオーバー | Microsoft Docs</a></li></ul><p>通常、ライブラリがメタデータの定期的なチェックし、公開鍵の自動更新を実装していることが一般的です。しかしながら、ライブラリがメタデータの定期チェックを実装していない、あるいはメタデータの自動更新を実装していない独自アプリは、今回の変更の影響を受ける可能性があります。</p><h2 id="私のアプリは影響を受けますか？"><a href="#私のアプリは影響を受けますか？" class="headerlink" title="私のアプリは影響を受けますか？"></a>私のアプリは影響を受けますか？</h2><p>本影響は貴社アプリ内にて、トークンの署名検証を行うアプリのみに影響があります。たとえば、 Web API や OpenID Connect で連携するアプリを開発している場合に影響を受ける可能性がございます。トークンの署名検証を行うアプリであっても、弊社の標準ライブラリなどでメタデータを定期的に更新するよう実装されている場合には影響を受けません。またこれまでもメタデータの公開鍵は、約 6 週間おきにロールオーバーされておりましたので、すでに 6 週間以上動作しているアプリは問題ないと判断いただけるものと存じます。</p><p>メタデータを利用した署名の検証をしているかは、Azure ポータル上で確認することはできず、アプリの実装観点での確認が必要です。上記公開情報に<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/active-directory-signing-key-rollover?WT.mc_id=Portal-Microsoft_Azure_Health#how-to-assess-if-your-application-will-be-affected-and-what-to-do-about-it">一般的な実装パターンごとに確認方法と対処方法</a>をおまとめしておりますので、こちらをご確認ください。</p><h2 id="よくある質問"><a href="#よくある質問" class="headerlink" title="よくある質問"></a>よくある質問</h2><p>以下に、よくある質問をおまとめします。</p><h3 id="az-login-などでサービス-プリンシパルを利用した認証を実施していますが影響を受けますか"><a href="#az-login-などでサービス-プリンシパルを利用した認証を実施していますが影響を受けますか" class="headerlink" title="az login などでサービス プリンシパルを利用した認証を実施していますが影響を受けますか"></a>az login などでサービス プリンシパルを利用した認証を実施していますが影響を受けますか</h3><p>いいえ、az login などクライアントではトークンの検証を行いませんので影響を受けません。</p><h3 id="エンタープライズ-アプリケーションでシングル-サインオン設定をしている-SAML-アプリには影響がありますか"><a href="#エンタープライズ-アプリケーションでシングル-サインオン設定をしている-SAML-アプリには影響がありますか" class="headerlink" title="エンタープライズ アプリケーションでシングル サインオン設定をしている SAML アプリには影響がありますか"></a>エンタープライズ アプリケーションでシングル サインオン設定をしている SAML アプリには影響がありますか</h3><p>いいえ、エンタープライズ アプリケーションのシングル サインオン設定にて、トークン署名証明書を生成している SAML アプリは、今回のロールオーバーの影響を受けません。個別の SAML アプリのトークン署名用証明書は引き続きお客さまにて管理いただけます。</p><h3 id="OpenID-Connect-で連携している-SaaS-アプリに影響はありますか"><a href="#OpenID-Connect-で連携している-SaaS-アプリに影響はありますか" class="headerlink" title="OpenID Connect で連携している SaaS アプリに影響はありますか"></a>OpenID Connect で連携している SaaS アプリに影響はありますか</h3><p>はい、OpenID Connect で連携している SaaS アプリが ID トークンの検証をしている場合、今回の影響を受ける可能性があります。ただ、通常は SaaS アプリベンダーにて対処が実施されるかと存じますので、ご不安な場合には各アプリベンダーまでご確認ください。</p><h3 id="Azure-AD-アプリケーション-プロキシで公開されたアプリは影響を受けますか"><a href="#Azure-AD-アプリケーション-プロキシで公開されたアプリは影響を受けますか" class="headerlink" title="Azure AD アプリケーション プロキシで公開されたアプリは影響を受けますか"></a>Azure AD アプリケーション プロキシで公開されたアプリは影響を受けますか</h3><p>公開されたアプリが OpenID Connect で Azure AD と連携しており、アプリ側でトークンの検証を実装している場合は確認が必要です。Azure AD アプリケーション プロキシの事前認証のみで認証を実施している場合、お客様での対処は不要です。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;2021-12-01 にサービス正常性通知の TKPG-F8G にて通知されております、「Action recommended: Azure Changes to Signing Key Rollover Frequency description: Active: Act</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Security" scheme="https://jpazureid.github.io/blog/tags/Security/"/>
    
  </entry>
  
  <entry>
    <title>条件付きアクセスの認証コンテキストを触ってみた</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/introducing-authentication-context/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/introducing-authentication-context/</id>
    <published>2021-12-01T08:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.205Z</updated>
    
    <content type="html"><![CDATA[<p>本記事は <a href="https://qiita.com/advent-calendar/2021/microsoft-azure-tech">Azure Tech Advent Calendar 2021</a> 1 日目の記事です。<br>Japan Azure Identity Support Blog では、お問合せの多い事象へのトラブルシューティング方法や、運用環境でのおススメの構成などサポート情報を中心に案内しておりますが、今回の記事は、プレビュー機能についていろいろと試してみた所謂「やってみた系」の記事です。</p><p>認証コンテキスト自体は 2021 年 3 月に <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/granular-conditional-access-for-sensitive-data-and-actions/ba-p/1751775">Microsoft Ignite で 発表された</a>条件付きアクセス ポリシーの新しい機能ですが、日本語での解説記事が全然出ておらず、個人的にもっと広まってほしいと思い、この機会にご紹介します。</p><div class="alert is-important"><p class="alert-title">重要</p><p>認証コンテキスト機能は、現在 Public Preview での提供であり、プレビュー期間中は作成した認証コンテキストを削除できません。</p><p>そのため以下の手順をお試しいただく際には、検証用テナントなどで動作を確認いただくことを推奨します。</p><p>本記事でご紹介する機能は 2021/12/01 現在の動作であり、最新の動作については公開ドキュメントをご参照ください。</p></div><h2 id="認証コンテキストとは？"><a href="#認証コンテキストとは？" class="headerlink" title="認証コンテキストとは？"></a>認証コンテキストとは？</h2><p>Azure AD の条件付きアクセス ポリシーは、サインインの場所、デバイスの状態、ユーザーのリスクなど様々なシグナルをもとに Azure AD で保護されたリソースへのアクセスを制御する機能です。<br>従来のポリシーで制御可能な操作は、保護されたリソース (クラウド アプリ) へのアクセス、セキュリティ情報の登録またはデバイスの登録または参加の操作のみでした。</p><p>しかしながら、より高度なアクセス制御を求めたいアプリケーションでは、特定の操作を行うときのみ多要素認証を要求する、あるいは、準拠済みデバイスからのアクセスを要求するといった、ステップアップ認証を設定したい場合があります。<br>このような要件を満たすために実装が進んでいる機能が、認証コンテキストです。</p><ul><li>条件付きアクセス ポリシーのクラウド アプリ、アクション、認証コンテキスト - Azure Active Directory | Microsoft Docs<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-cloud-apps#authentication-context-preview">https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-cloud-apps#authentication-context-preview</a></li></ul><p>認証コンテキストを利用することで、特定の SharePoint サイトにアクセスする際のみに追加の認証を要求したり、Microsoft Defender for Cloud Apps (旧 MCAS) を利用し、セッション ポリシーを割り当てたアプリケーションで、特定の動作に対し追加の認証を要求したりすることが可能になります。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/conditional-accees-policy-example.png" alt="条件付きアクセス ポリシーの動作例"></p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-example.png" alt="認証コンテキストの動作例"></p><p>ちなみに、サポート チームではこのような情報は社内情報として入手することもあれば、お客様と同時に Ignite や Tech ブログなどの発表で知る… ということもあります😅</p><h2 id="公式ドキュメントを読む"><a href="#公式ドキュメントを読む" class="headerlink" title="公式ドキュメントを読む"></a>公式ドキュメントを読む</h2><p>新機能が発表されてもすぐに使えるとは限りません。認証コンテキストの場合は、3 月に Ignite で発表されてから 5 月ごろに <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/conditional-access-authentication-context-now-in-public-preview/ba-p/1942484">パブリック プレビューが開始され</a> ました。</p><p>同時に公式ドキュメントもたいてい公開されるので、私も早速動作を試してみました。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-conditional-access-cloud-apps#authentication-context-preview">条件付きアクセス ポリシーのクラウド アプリ、アクション、認証コンテキスト - Azure Active Directory | Microsoft Docs</a></li></ul><h2 id="実際に試してみる"><a href="#実際に試してみる" class="headerlink" title="実際に試してみる"></a>実際に試してみる</h2><p>では、公式ドキュメントを参考に早速試してみましょう。認証コンテキストを試すには、以下の手順が必要です。</p><ol><li>認証コンテキストを作成する</li><li>認証コンテキストに条件付きアクセス ポリシーを適用する</li><li>認証コンテキストを利用アプリに割り当てる</li></ol><p>構認証コンテキストは単体で動作するわけではなく、アプリ、認証コンテキスト、条件付きアクセスが連動して動作します。<br>もう少し具体的に言うと、アプリが認証コンテキストを利用するという認証要求を Azure AD に送信し、Azure AD は指定された認証コンテキストに紐づく条件付きアクセス ポリシーを適用、結果としてポリシーに基づいた追加のアクセス制御が可能となります。</p><div class="alert is-info"><p class="alert-title">Note</p><p>認証コンテキスト機能を利用するには Azure AD Premium P1 以上のライセンスが必要です。</p></div><h3 id="認証コンテキストの作成"><a href="#認証コンテキストの作成" class="headerlink" title="認証コンテキストの作成"></a>認証コンテキストの作成</h3><p>認証コンテキストを作成するには、Azure ポータルの <code>Azure Active Directory</code> &gt; <code>セキュリティ</code> &gt; <code>条件付きアクセス ポリシー</code> &gt; <code>認証コンテキスト</code> から作成します。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context01.png" alt="認証コンテキストの作成"></p><p>今回は、Require_MFA, Require_CompliantDevice, Require_TOU の 3 つの認証コンテキストを作成しました。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context02.png" alt="作成した認証コンテキスト"></p><p>認証コンテキストは作成順に c1 ~ c25 までの ID が割り振られます。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-id.png" alt="認証コンテキストの ID"></p><div class="alert is-important"><p class="alert-title">重要</p><p>認証コンテキスト機能は、現在 Public Preview での提供であり、プレビュー期間中認証コンテキストの上限は 25 個で、作成した認証コンテキストを削除できません。</p></div><h3 id="認証コンテキストへ条件付きアクセスの適用"><a href="#認証コンテキストへ条件付きアクセスの適用" class="headerlink" title="認証コンテキストへ条件付きアクセスの適用"></a>認証コンテキストへ条件付きアクセスの適用</h3><p>作成した認証コンテキストは、それのみでは何も機能しません。そのため、認証コンテキストに条件付きアクセス ポリシーを割り当てます。<br>認証コンテキストは「コンテキスト」の定義で合って、実際の動作は条件付きアクセス ポリシーで制御します。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/apply-policy-to-authentication-context.png" alt="認証コンテキストとポリシーの関係"></p><p>通常の条件付きアクセス ポリシー同様にユーザーや適用の条件などを設定でき、緊急用の管理アカウントなどを除外することも可能です。</p><p>今回は、それぞれ C001_Require_MFA, C002_Require_CompliantDevice, C003_Require_TOU の名前でポリシー作成し、認証コンテキストに合った制御を設定しました。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context03.png" alt="条件付きアクセス ポリシーの対象"></p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context04.png" alt="作成した条件付きアクセス ポリシー"></p><p>複数の条件付きアクセス ポリシーを一つの認証コンテキストに割り当てたり、逆に複数の認証コンテキストに 1 つの条件付きアクセス ポリシーを割り当てることも可能です。<br>たとえば、機密情報アクセス用の認証コンテキストに、社内 IP からのアクセス時のポリシーと、社外 IP からのアクセス時のポリシーをそれぞれ適用する、といった利用法が考えられます。</p><p>認証コンテキストと条件付きアクセス ポリシーの組み合わせを大量に管理するのは労力が大きくなるため、なるべく汎用的な認証コンテキストを定義し、複数のアプリで使いまわせるように設計するのが良いように思います。</p><h3 id="認証コンテキストの対応サービスへの適用"><a href="#認証コンテキストの対応サービスへの適用" class="headerlink" title="認証コンテキストの対応サービスへの適用"></a>認証コンテキストの対応サービスへの適用</h3><p>作成した認証コンテキストと、そのコンテキストに対する条件付きアクセスは呼び出されない限りは機能しません。つまり、アプリが認証コンテキストを明示的に呼び出し、追加の認証を要求する必要があります。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/apply-authentication-context-to-apps.png" alt="認証コンテキストとポリシー、アプリの関係"></p><p>今回は認証コンテキストを呼び出すアプリとして SharePoint Online の特定サイトを利用します。つまり、SharePoint Online の特定サイトにアクセスする際に、認証コンテキストが呼び出されるよう構成し、条件付きアクセス ポリシーにて追加の認証が要求されるか確かめます。</p><p>SharePoint Online への認証コンテキストの適用方法は、現時点では 2 つあります。一つは特定の機密度ラベルに認証コンテキストを割り当てる方法です。<a href="https://docs.microsoft.com/ja-jp/sharepoint/authentication-context-example">公開ドキュメントの手順</a> では機密度ラベルに認証コンテキストを割り当てる方法が紹介されています。</p><p>機密度ラベルを利用したほうがファイルの暗号化などと組み合わせてより高度な設定が可能ですが、今回は条件付きアクセス ポリシーの動作を確認することが目的ですので、もう一つの、簡易な手順であるサイトに直接認証コンテキストを割り当てる手順にて検証します。(機密度ラベルを利用した検証はラベルの作成や展開時間を含めると丸一日かかりました)</p><p>特定のサイトに認証コンテキストを適用するには、<a href="https://docs.microsoft.com/ja-jp/powershell/module/sharepoint-online/set-sposite?view=sharepoint-ps">SharePoint Online PowerShell の Set-SPOSite コマンド</a> を利用します。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># SharePoint Online にグローバル管理者権限でサインインします。</span><br><span class="line">Connect-SPOService -Uri https://&lt;yourdomain&gt;-admin.sharepoint.com/</span><br><span class="line"></span><br><span class="line"># 認証コンテキストを特定のサイトを指定して割り当てます。</span><br><span class="line">Set-SPOSite -Identity https://&lt;yourdomain&gt;.sharepoint.com/sites/confidential -ConditionalAccessPolicy AuthenticationContext -AuthenticationContextName &quot;Require_CompliantDevice&quot;</span><br></pre></td></tr></table></figure><p>上記手順では、準拠済みデバイスが必要と設定した認証コンテキストをサイトに割り当てました。<br>その後、認証コンテキストを割り当てたサイトに非準拠デバイスでアクセスを実施すると、以下のように準拠済みデバイスが必要な旨が表示され、アクセスがブロックされます。もちろん、認証コンテキストを設定していないサイトには今まで通りアクセスが可能です。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context05.png" alt="条件付きアクセス ポリシーによるブロック"></p><p>サインイン ログの条件付きアクセス ポリシーの項目を確認すると、期待通り認証コンテキストに割り当てたポリシーが適用されていることが確認できます。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context06.png" alt="適用された条件付きアクセス"></p><div class="alert is-info"><p class="alert-title">Note</p><p>サインインログから条件付きアクセス ポリシーの適用状況を確認する方法は、<a href="/blog/azure-active-directory/conditional-cannot-access-rightnow/">「現時点ではこれにはアクセスできません」 エラーについて</a> を参照下さい。</p></div><h2 id="プロトコルの詳細を見てみる"><a href="#プロトコルの詳細を見てみる" class="headerlink" title="プロトコルの詳細を見てみる"></a>プロトコルの詳細を見てみる</h2><p>機能紹介はここまでですが、今回はもう少し認証コンテキストが動作する仕組みを見てみましょう。SharePoint Online へアクセスをする際には Azure AD で OpenID Connect を利用した認証が実施されます。つまり、SharePoint Online から Azure AD に対し、ID トークンを発行するための認可リクエストが送信されています。</p><p>そこでブラウザーの F12 ツールなどを利用し、条件付きアクセス ポリシーでブロックされた際の通信トレースを取得してみます。<br>以下の通信は、認証コンテキストを設定した SharePoint サイトにアクセスを行った際、Azure AD に送信された認可リクエストの中身です。ここで注目してほしいのは claims パラメータの中身です。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context07.png" alt="claims パラメーター"></p><p>claims パラメータは <a href="https://openid.net/specs/openid-connect-core-1_0.html#ClaimsParameter">OpenID Connect Core で定義されている</a> トークンに含めてほしいクレームを定義するパラメータです。ここでは id_token に acrs クレームを含めるよう、指示をしています。<br>acrs クレームは、OpenID Connect の <a href="https://openid.net/specs/openid-connect-core-1_0.html#rfc.section.5.5.1.1">acr (Authentication Context Class Reference) クレーム</a> と同じような動作をするクレームで、以下のように認証コンテキストを指定することで、ID トークンの発行時に 指定された認証コンテキストに適用された条件付きアクセス ポリシーを完了させることを要求します。</p><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123; </span><br><span class="line">  <span class="attr">&quot;id_token&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;acrs&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;essential&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;c2&quot;</span> <span class="comment">//認証コンテキストの ID</span></span><br><span class="line">      &#125;,</span><br><span class="line">    <span class="attr">&quot;xms_cc&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;values&quot;</span>:[<span class="string">&quot;CP1&quot;</span>] <span class="comment">//クレーム チャレンジ対応クライアントを要求</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上記の例では、c2 つまり、Require_CompliantDevice の認証コンテキストを指定して、ID トークンの発行を要求していることがわかります。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context08.png" alt="c2 の認証コンテキスト"></p><p>認証コンテキストに割り当てられた条件付きアクセス ポリシーを突破したかどうかは、発行される ID トークンの acrs クレームを確認することで判定が可能です。実際に条件付きアクセス ポリシーを突破した状態でアクセスを行った際には、以下のように acrs クレームが含まれる ID トークンが発行されます</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context09.png" alt="ID トークン"></p><p>SharePoint Online 側では、acrs クレームをチェックして、本当にユーザーが認証コンテキストを満たす認証を実施したかを判定できます。</p><div class="alert is-info"><p class="alert-title">Note</p><p>xms_cc オプションはクライアント アプリケーションがクレーム チャレンジに対応しており、API が返却するクレーム チャレンジ ヘッダーを適切に処理できることを示しています。</p><p>話の本筋からそれますのでここでは紹介しませんが、詳しくは <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/claims-challenge">クレーム チャレンジ、クレーム要求、およびクライアントの機能 - Microsoft identity platform | Microsoft Docs</a> や、<a href="https://github.com/Azure-Samples/ms-identity-ca-auth-context/blob/71b9d8a07de995d47b030e8449202016a9f76c41/TodoListClient/Controllers/TodoListController.cs#L44">該当の</a> <a href="https://github.com/Azure-Samples/ms-identity-ca-auth-context/blob/74146a201bf28b04145d1743d4d8d52919bd5896/TodoListClient/Infrastructure/ExtractAuthenticationHeader.cs">ソース</a> <a href="https://github.com/Azure-Samples/ms-identity-ca-auth-context/blob/74146a201bf28b04145d1743d4d8d52919bd5896/TodoListService/Controllers/TodoListController.cs#L98">コード</a> を参照ください。</p></div><h2 id="Appendix-公式サンプルを触ってみる"><a href="#Appendix-公式サンプルを触ってみる" class="headerlink" title="Appendix: 公式サンプルを触ってみる"></a>Appendix: 公式サンプルを触ってみる</h2><p>ここまで SharePoint Online を例にして、実際の認証コンテキストの動作を確認してきました。<br>認証コンテキストの動作をまとめると、以下のようなフローになります。</p><ol><li>アプリが保持する機密情報へのアクセス</li><li>アプリで設定した認証コンテキストを含む、認可要求</li><li>Azure AD の条件付きアクセス ポリシーによる認証コンテキストに応じた追加の認証要件</li><li>認証コンテキスト突破済みのトークン</li></ol><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-flow.png" alt="認証コンテキストの大まかなフロー"></p><p>ここまでは、認証コンテキストを要求するアプリは SharePoint Online でしたが、上記のプロトコルをきちんと実装すれば、自社の OpenID Connect で実装されたアプリにも組み込むことが可能です。<br>MSAL ライブラリを利用し、認証コンテキストを呼び出す具体的なサンプルは、<a href="https://github.com/Azure-Samples/ms-identity-ca-auth-context">GitHub</a> にあります。</p><p>認証コンテキスト利用したアプリを実装する際には、認証コンテキストの具体的な内容はアプリ側では確認できない点に注意してください。<br>今回の手順では認証コンテキストとして、今回の手順では認証コンテキストとして、Require_MFA (c1), Require_CompliantDevice (c2), Require_TOU (c3) の 3 つを作成しましたが、あくまでこれは私のテストテナントでの話です。<br>他のテナントでは c1 が CompliantDevice と MFA が必要な認証コンテキスト、といったように c1, c2, c3 という ID は認証コンテキストの内容を推定する役には立ちません。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-with-custom-apps.png" alt="認証コンテキストの内容はアプリからはわからない"></p><p>特にマルチテナント アプリでは認証コンテキストはテナントによって異なるため、アプリ上で管理者による認証コンテキストの参照を行う機能の実装を検討ください。<br>上記のサンプル コードでは、管理者専用の設定ページにて Graph API で認証コンテキストの一覧を取得し、アプリケーションの動作時に要求する認証コンテキストを選択できるようなインターフェイスを実装しています。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-sample-admin.png" alt="アプリは認証コンテキストの内容を知らない"></p><p>アプリを実装する際には、認証コンテキストをどのように取得するかという点にも気を付けて実装いただく必要があります。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-app-fetch.png" alt="認証コンテキストの情報を取得する必要がある"></p><p>なお、Graph API で認証コンテキストの情報を取得したとしても、あくまでアプリは認証コンテキストの名前などのみが取得でき、実際に設定されている条件付きアクセス ポリシーの内容は確認できません。条件付きアクセス ポリシーの管理は引き続きテナント管理者が実施することとなります。(認証コンテキストと、適用されるポリシーの実際の動作が合致するように管理する必要があります)</p><p>さて、サンプルの動作に戻りましょう。上記の管理者ページでは、ToDo List の POST または DELETE 操作を実施時に必要な認証コンテキストを選択することが可能です。試しに TODO リストの POST に Require_TOU を、TODO リストの削除に Require_MFA を設定したところ、それぞれの操作を実施時に設定した認証コンテキストによる追加の認証が行われました。</p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-sample-post.png" alt="TODO リストの作成時に規約の同意が求められる"></p><p><img src="/blog/azure-active-directory/introducing-authentication-context/authentication-context-sample-delete.png" alt="TODO リストの削除時に多要素認証が求められる"></p><div class="alert is-important"><p class="alert-title">重要</p><p>認証コンテキストに限りませんが、条件付きアクセス ポリシーは適用時に必ず認証を求めるものではなく、要求された条件を満たした認証を完了しているかを判定します。</p><p>上記のサンプルでも一度多要素認証を実施したのちは、Azure AD 側あるいはアプリの認証キャッシュが有効な間は TODO リストの削除が可能です。</p></div><h2 id="まとめ"><a href="#まとめ" class="headerlink" title="まとめ"></a>まとめ</h2><p>今回は Azure AD の条件付きアクセス ポリシーのプレビュー機能である、Authentication Context を紹介しました。実際に設定をしたのは SharePoint Online のみですが、Microsoft Defender for Cloud Apps (旧 MCAS) でセッション制御に利用したり、また自作のアプリでもステップアップ認証要求を求めるよう実装したりすることが可能です。また、Azure AD Privileged Identity で、ロールの昇格の条件として認証コンテキスト利用できるようになるという発表もされており (早く Public Preview 来てくれー)、今後の展開も大変楽しみです。</p><p>皆さんもぜひこの新機能をお試しいただき何かお気づきの点などございましたらフィードバックをお待ちしております。</p><p>Azure AD を含む弊社のクラウド サービスでは日々新機能が発表されますが、お客様をサポートできるようサポート チームでも新しい機能について学習し、日々検証を行っています。本記事は、そんな検証の様子の一コマとしてもお楽しみいただければ幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事は &lt;a href=&quot;https://qiita.com/advent-calendar/2021/microsoft-azure-tech&quot;&gt;Azure Tech Advent Calendar 2021&lt;/a&gt; 1 日目の記事です。&lt;br&gt;Japan Azure </summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Conditional Access Policy" scheme="https://jpazureid.github.io/blog/tags/Conditional-Access-Policy/"/>
    
  </entry>
  
  <entry>
    <title>TLS 1.2 へ移行して基盤環境のセキュリティ確保を</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/act-fast-by-moving-to-tls-1-2/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/act-fast-by-moving-to-tls-1-2/</id>
    <published>2021-12-01T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.005Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 11 月 22 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/act-fast-to-secure-your-infrastructure-by-moving-to-tls-1-2/ba-p/2967457">Act fast to secure your infrastructure by moving to TLS 1.2!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><div class="alert is-info"><p class="alert-title">Note</p><p>TLS 1.2 に関する案内は、すでに公開中の <a href="https://jpazureid.github.io/blog/azure-active-directory-connect/azure-ad-connect-tls/">Azure AD Connect における TLS 1.2 の対応</a> の記事でも解説されておりますので併せてご覧ください。</p></div><hr><p>適切なセキュリティ対策を講じて機密データを保護することは、すべての組織にとって最も重要なことです。そのためには、データを保護し脅威に対抗するため、常に規格や規制を満たしていく必要があります。このような規格のうちの 1 つとして、Transport Layer Security (TLS) があります。TLS は、Web ブラウザと Web サーバーの間、モバイル アプリケーションとサーバー間の通信を暗号化するためのインターネット プロトコルです。弊社では、Azure Active Directory で TLS 1.2 を使用し基盤環境を保護することを推奨しています。テナントのセキュリティ態勢を向上させ、業界標準に準拠するため、旧バージョンの TLS (1.0 および 1.1) は廃止となり削除されます。 </p><p>TLS は広く採用されているセキュリティ プロトコルで、インターネット上の通信におけるプライバシーとデータ セキュリティを促進する仕組みです。TLS は、Azure AD、Office 365、および Microsoft や他のクラウド サービス プロバイダーが所有するその他のクラウド サービスに接続する際に使用されます。TLS の 3 つの要素のうち、1 つ目のものは暗号化であり、転送されるデータを第三者から隠蔽します。2 つ目の要素は認証であり、これは情報を交換する当事者が確かにその主張どおりの人物であることを確認します。3 つ目は整合性であり、データが偽造されていないか、改ざんされていないかを検証します。TLS 1.0 および 1.1 のプロトコルや 3DES 暗号は古いため、最新の暗号アルゴリズムに対応していません。その結果、攻撃者に悪用される可能性のあるセキュリティ上の脆弱性があります。FedRamp と <a href="https://csrc.nist.gov/news/2019/nist-publishes-sp-800-52-revision-2">NIST SP 800-52r2</a> に準拠するためには、レガシーのTLS (1.0、1.1) プロトコルと暗号 (3DES) の利用を廃止する必要があります。</p><p>Microsoft 365 など、ほとんどのマイクロソフトのサービスでは、TLS 1.0 および 1.1 を非推奨にする方法についての<a href="https://docs.microsoft.com/ja-jp/microsoft-365/compliance/tls-1.0-and-1.1-deprecation-for-office-365?view=o365-worldwide">ガイダンス</a> を提供しています。Azure AD を使用している多くのお客様は、すでに TLS 1.2 に移行していますが、この移行を促進するために、追加のガイダンスを提供いたします。2022 年 1 月 31 日から、Azure AD は、これら廃止予定の TLS バージョン 1.0 および 1.1 をサポートしなくなります。TLS 1.2 に移行していないお客様は、Azure AD へのリクエストが失敗するため、影響を受けることとなります。</p><h2 id="Azure-AD-のサインイン-ログを使用してレガシーな-TLS-を検出し移行を計画する"><a href="#Azure-AD-のサインイン-ログを使用してレガシーな-TLS-を検出し移行を計画する" class="headerlink" title="Azure AD のサインイン ログを使用してレガシーな TLS を検出し移行を計画する"></a>Azure AD のサインイン ログを使用してレガシーな TLS を検出し移行を計画する</h2><p>Azure AD で TLS 1.2 をサポートするための完全なガイダンスについては、こちらの <a href="https://docs.microsoft.com/ja-jp/troubleshoot/azure/active-directory/enable-support-tls-environment?tabs=azure-monitor">ドキュメント</a> を参照ください。これに加えてお客様は、Azure AD サインイン ログを使用して、お客様の環境でレガシーな TLS を使用しているクライアントやアプリケーションを特定することができます。レガシーな TLS で実行されたサインインに対して、Azure AD は、”追加の詳細” において、「Legacy TLS (TLS 1.0, 1.1, 3DES)」の項目 を True とマークします。「Legacy TLS」の項目は、レガシーな TLS によるサインインが行われた場合にのみ表示されるため、お客様のログにこの項目が表示されていない場合は、TLS 1.2 への切り替えの準備ができていることになります。</p><p>管理者がレガシーな TLS プロトコルをログから確認し、サインインの試行を特定する方法は複数あります。</p><ol><li><p><strong>PowerShel</strong>: PowerShell を使用して、レガシー TLS が使用されているサインイン ログのエントリをフィルタリングし、出力することができます。PowerShell で MS Graph API を呼び出すには、Azure AD Premium ライセンスが必要です。詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/reference-powershell-reporting">レポート用の Azure AD PowerShell コマンドレット</a> を参照ください。</p></li><li><p><strong>UX</strong>: お客様は、Azure ポータルで、レガシーな TLS ベースのサインイン ログ エントリの詳細を参照できます。詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/concept-all-sign-ins">Azure Active Directory のサインイン ログ - プレビュー</a> を参照ください。</p></li></ol><p><img src="/blog/azure-active-directory/act-fast-by-moving-to-tls-1-2/fig1.png" alt="図 1 - TLS のログを確認するため Azure ポータルを使用"> </p><ol start="3"><li><p><strong>JSON</strong>: 過去 7 日間のサインイン ログを JSON 形式でダウンロードして、「Legacy TLS」の項目を確認できます。このフラグは、レガシーな TLS がサインイン要求に使用されている場合にのみ表示されます。サインイン ログを JSON 形式ではなく CSV 形式でダウンロードすると、Legacy TLS 項目は表示されません。詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-download-logs">方法: Azure Active Directory でログをダウンロードする</a> を参照ください。</p></li><li><p><strong>Azure　モニター</strong>: 最後は、Azure Monitor を用いてログを分析し、ログのエクスポートを設定する方法です。詳細につきましては、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/reports-monitoring/howto-analyze-activity-logs-log-analytics">Azure Monitor ログを使用して Azure AD アクティビティ ログを分析する</a> を参照してください。</p></li></ol><p><img src="/blog/azure-active-directory/act-fast-by-moving-to-tls-1-2/fig2.png" alt="図 2 - TLS のログを確認するため Azure Monitor を使用"> </p><p>暗号プロトコルの進化に伴い、お客様は業界標準やベスト プラクティスを確認するとともに、既存のプロトコルに新たな脆弱性がないか注視していく必要があります。今回ご紹介したツールにより、お客様が TLS 1.2 への移行をスムーズに行い、セキュリティ体制を強化できれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 22 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authenticator の新たなセキュリティ機能が利用可能となりました！</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/new-authenticator-security-features/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/new-authenticator-security-features/</id>
    <published>2021-12-01T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.269Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 11 月 18 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/new-microsoft-authenticator-security-features-are-now-available/ba-p/2464386">New Microsoft Authenticator security features are now available!</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>昨年、私たちは「<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/it-s-time-to-hang-up-on-phone-transports-for-authentication/ba-p/1751752">認証のための SMS や音声通話を使うのはそろそろやめよう</a>」(原題: “It’s Time to Hang Up on Phone Transports for Authentication”) という記事を公開しました。今日、弊社は Microsoft Authenticator をユーザーにとってより安全に、管理者にとってはより簡便に展開できるようにしました。</p><ol><li>管理者は Microsoft Authenticator において、番号照合や追加情報の提示により、誤った承認を防ぐことができるようになりました (パブリック プレビュー)。</li><li>管理者は Microsoft Authenticator を使用して、GPS 位置情報に基づく条件付きアクセス ポリシーを設定することができるようになりました (一般提供)。</li><li>管理者は「登録キャンペーン」機能を使用して、サインイン時に Microsoft Authenticator を設定するようユーザーに促すことができるようになりました (一般提供)。</li></ol><p>これらの Microsoft Authenticator のセキュリティ アップグレードを是非お試しいただき、ご意見をお聞かせください。これら新機能の詳細については以下をご覧ください。</p><h2 id="Microsoft-Authenticator-で-MFA-を利用する際の番号照合-パブリック-プレビュー"><a href="#Microsoft-Authenticator-で-MFA-を利用する際の番号照合-パブリック-プレビュー" class="headerlink" title="Microsoft Authenticator で MFA を利用する際の番号照合 (パブリック プレビュー)"></a>Microsoft Authenticator で MFA を利用する際の番号照合 (パブリック プレビュー)</h2><p>セキュリティを高め誤った承認を減らすために、管理者は Authenticator で MFA リクエストを承認する際に、サインイン画面に表示されている番号の入力をユーザーに要求することができます。</p><p><img src="/blog/azure-active-directory/new-authenticator-security-features/fig1.png" alt="図1 - 番号の照合"></p><p>ユーザーに番号照合を利用させる方法については、<a href="https://aka.ms/numbermatchdoc">こちら</a> をご覧ください。</p><h2 id="Microsoft-Authenticator-の承認リクエストにおける追加情報の提示-パブリック-プレビュー"><a href="#Microsoft-Authenticator-の承認リクエストにおける追加情報の提示-パブリック-プレビュー" class="headerlink" title="Microsoft Authenticator の承認リクエストにおける追加情報の提示 (パブリック プレビュー)"></a>Microsoft Authenticator の承認リクエストにおける追加情報の提示 (パブリック プレビュー)</h2><p>誤った承認を減らすためのもう一つの方法は、Authenticator の通知でユーザーに追加の情報を表示することです。この機能は、ユーザーがどのアプリケーションにサインインしているか、また IP アドレスに基づいてサインインしている場所を表示します。</p><p><img src="/blog/azure-active-directory/new-authenticator-security-features/fig2.png" alt="図 2 - 通知内に番号照合と併せて追加情報を提示"></p><p>ユーザーに追加の情報を表示する方法については、<a href="https://aka.ms/additionalcontextdoc">こちら</a> をご覧ください。</p><h2 id="GPS-ベースのネームド-ロケーション-一般提供"><a href="#GPS-ベースのネームド-ロケーション-一般提供" class="headerlink" title="GPS ベースのネームド ロケーション (一般提供)"></a>GPS ベースのネームド ロケーション (一般提供)</h2><p>管理者は、条件付きアクセス ポリシーを使用して、Microsoft Authenticator の GPS を使用して、リソースへのアクセスを特定の国の境界内に制限できるようになりました。</p><p>この機能を有効にしたユーザーは、サインイン時に Microsoft Authenticator アプリを使用して GPS 位置情報を共有するよう求められます。GPS 位置情報の完全性を確保するため、デバイスが脱獄またはルート化されている場合、Microsoft Authenticator は認証を拒否します。</p><p><img src="/blog/azure-active-directory/new-authenticator-security-features/fig3.png" alt="図 3 – GPO 座標を利用してネームドロケーションを追加"></p><p>詳細については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/location-condition">管理者向けドキュメント</a>、<a href="https://docs.microsoft.com/ja-jp/graph/api/resources/countrynamedlocation?view=graph-rest-1.0">Graph API ドキュメント</a>、<a href="https://support.microsoft.com/en-us/account-billing/common-problems-with-the-microsoft-authenticator-app-12d283d1-bcef-4875-9ae5-ac360e2945dd">FAQページ</a> をご覧ください。</p><h2 id="Microsoft-Authenticator-登録キャンペーン-一般提供"><a href="#Microsoft-Authenticator-登録キャンペーン-一般提供" class="headerlink" title="Microsoft Authenticator 登録キャンペーン (一般提供)"></a>Microsoft Authenticator 登録キャンペーン (一般提供)</h2><p>Microsoft Authenticator 登録キャンペーンの機能を使用することで、ユーザーに Authenticator の設定を促し、安全性の低い SMS / 電話認証からの移行を促すことができます。この機能は、Microsoft Authenticator が有効でありながら設定されていないユーザーを対象としています。ユーザーは MFA サインインの完了後に Authenticator の設定を促され、設定後は既定の認証方法が Microsoft Authenticator アプリに変更されます。</p><p>ユーザーの登録キャンペーンを有効にする方法については、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/authentication/how-to-mfa-registration-campaign">こちら</a>をご覧ください。</p><p><img src="/blog/azure-active-directory/new-authenticator-security-features/fig4.png" alt="登録キャンペーンの有効化"></p><p>皆様からのご意見をお待ちしております。以下にコメントをお寄せいただくか、 aka.ms/AzureADFeedback までご連絡ください。</p><p>Alex Simons (<a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 18 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcom</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>アプリでゼロ トラスト対応を実現する 1 - なぜ重要なのか</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/Achieving-ZeroTrust-readiness-in-your-apps1-Why-it-matters/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/Achieving-ZeroTrust-readiness-in-your-apps1-Why-it-matters/</id>
    <published>2021-11-25T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:40.968Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure Identity サポート チームの小出です。</p><p>本記事は、 2021 年 11 月15 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/achieving-zero-trust-readiness-in-your-apps-1-why-it-matters/ba-p/2959972">Achieving Zero Trust readiness in your apps #1: Why it matters</a> を意訳したものになります。ご不明点などございましたら、サポート チームまでお問い合わせください。</p><hr><p>こんにちは、Jeff Sakowiczです。私は Microsoft Identity チームで、Application Platform Security の Principal Program Management Lead をしています。私たちのチームの目標は、安全で信頼性が高く、発展的なアプリのエコシステムを作っていくことです。この目標を達成する一環として、アプリがゼロ トラストのセキュリティ モデルをサポートできるようにすることがあげられます。</p><p>今回、弊社アプリ プラットフォームのセキュリティ チームより、皆様が開発したアプリでどのようにゼロ トラスト対応を実現すればよいかと、なぜそれが重要かについて、一連のブログで紹介してまいります。</p><p>従来、アプリケーションのセキュリティを確保するというのは、安全なネットワーク境界内にアプリケーションを配置し、悪用される可能性のあるコードを修正することでした。何か問題が発生した場合、その影響は直接アプリケーション自体に及ぶことが多かったのです。しかし今日、ユーザーや組織が依存するアプリケーションやサービスは相互に絡み合った状況にあります。侵害されたアプリケーションや安全でないアプリケーションは、他の基盤への入り口として機能し、組織全体に影響を与える可能性があります。</p><p>さらに、<a href="https://www.microsoft.com/security/blog/2021/05/12/how-to-secure-your-hybrid-work-world-with-a-zero-trust-approach/">「どこでも仕事ができる」というハイブリッド型勤務</a> を背景に、アプリケーションは急速にクラウドへ移行しています。これは従業員が、自分のネットワークやデバイスからリソースにアクセスするためです。もはや、アプリケーションが保護されたネットワーク境界内でのみ使用されると考えることはできません。</p><p><a href="https://www.microsoft.com/security/business/zero-trust">ゼロ トラスト</a> の原則である「<strong>明示的に検証する</strong>」「<strong>最小限の特権アクセスを使用する</strong>」「<strong>侵害を想定する</strong>」は、このような新しい現実に対応するためのセキュリティの枠組みを提供してくれます。エンド・ツー・エンドのゼロトラスト戦略を採用し、基本的なセキュリティ衛生管理を行うことは、組織のデジタル資産を保護する助けとなります。ゼロトラストの原則を念頭に置いてアプリを開発することで、より安全なハイブリッド型勤務環境を実現でき、セキュリティ インシデントの影響範囲を小さくできます。さらに、迅速に修復や回復を行えるようにもなり、ゼロ トラスト戦略を実施する環境でアプリがシームレスに動作するようになります。</p><p>このブログ シリーズでは、マイクロソフトの ID プラットフォームがどのようにゼロ トラストの原則をサポートしているかを説明し、皆様が ID とアクセス管理にゼロ トラストのアプローチを採用したアプリケーションを作成する手助けをしてまいりたいと思います。まずは、なぜゼロ トラストが重要なのかについてこの記事で説明します。来月は、マイクロソフトの ID プラットフォームを使用して、最小特権アクセスの原則を使用するアプリケーションの設計について説明する予定です。 </p><h2 id="ゼロ-トラストの-ID-セキュリティを実現するためには開発者と-IT-担当者の協力が必須"><a href="#ゼロ-トラストの-ID-セキュリティを実現するためには開発者と-IT-担当者の協力が必須" class="headerlink" title="ゼロ トラストの ID セキュリティを実現するためには開発者と IT 担当者の協力が必須"></a>ゼロ トラストの ID セキュリティを実現するためには開発者と IT 担当者の協力が必須</h2><p>アプリを評価する際に、IT 部門は評価基準をより厳格にする必要があります。IT 部門はリスクを伴うアプリケーションや、高いセキュリティが求められる環境で正しく機能しないアプリケーションの使用を回避するでしょう。よって、アプリケーションが採用されるためには、ゼロ トラストを念頭に置いて設計されている必要があります。</p><p>しかし、ゼロ トラストのアプローチでアプリケーションを開発、設定、展開するには、チーム全体での努力が必要です。IT 部門は自らの環境内のアプリケーションに、どのようなポリシーを適用するか決定しなければなりません。開発者には、IT 部門がよりアプリケーションの安全性を高め、さらにそれを採用し管理できる形でアプリケーションを構築および統合する責任があります。こうした協力により、企業は以下のことが可能になります。</p><ul><li>組織内でアプリケーションを大規模に展開する。</li><li>情報漏洩の可能性を最小限に抑える。また、”侵害を想定する” 観点では、侵害が発生した際の影響を最小限に抑える。</li><li>攻撃や侵害に迅速に対応する。こうした攻撃などから迅速に復旧することで、ビジネスへの損害を軽減する。</li></ul><h2 id="お客様はゼロ-トラストの原則を取り入れ始めており、最初に-ID-から取り組んでいます"><a href="#お客様はゼロ-トラストの原則を取り入れ始めており、最初に-ID-から取り組んでいます" class="headerlink" title="お客様はゼロ トラストの原則を取り入れ始めており、最初に ID から取り組んでいます"></a>お客様はゼロ トラストの原則を取り入れ始めており、最初に ID から取り組んでいます</h2><p>組織のゼロ トラストへの道のりはそれぞれ異なりますが、ほとんどの場合、まず取り組むべき場所はユーザーとアプリケーションの ID です。多くの企業がゼロ トラストを展開する際に、優先的に取り組むアプリケーションのポリシーと制御は以下のとおりとなります。</p><ul><li><strong>認証情報の管理とローテーション ポリシー</strong>: 証明書やパスワードなどの秘密情報は、保護すべき最も重要な資産の 1 つです。これはこれら秘密情報を手にした攻撃者はシステム内部のより深くにアクセスすることができるからです。コードや設定からすべてのシークレットを取り除いてください。取り除いた情報は <a href="https://docs.microsoft.com/ja-jp/azure/key-vault/general/basic-concepts">Azure Key Vault</a> に配置し、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/managed-identities-azure-resources/overview">マネージド ID</a> を介してアクセスします。IT 管理者においては、アプリケーションの認証情報の管理を徹底する <a href="https://docs.microsoft.com/ja-jp/graph/api/resources/applicationauthenticationmethodpolicy?view=graph-rest-beta">アプリケーション認証方法ポリシー</a> を導入ください。</li><li><strong>強力なリスク ベース認証</strong>: IT 管理者は、多要素認証を必要とするポリシーを設定したいと考えるでしょう。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/overview">条件付きアクセス ポリシー</a> を使用することで、管理者は必要に応じて適切なアクセス制御を行うことで、組織の安全性を保ちつつも、制御の必要のないときにはユーザーの邪魔をしないようにできます。</li><li><strong><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/publisher-verification-overview">発行者確認済み</a> としているリスクの低いアクセス許可を要求するアプリケーションへの同意を制限する</strong>: Microsoft Graph などの API を使用してデータにアクセスすることで、リッチなアプリケーションを構築することができますが、同時に組織ではエンド ユーザーが特定の条件でアプリケーションに許可を与えることのできるポリシーを設定し、リスクを制限することが可能です。IT 部門は、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/manage-apps/configure-admin-consent-workflow">Azure AD の管理者同意ワークフロー</a> を使用して、ユーザー側で承諾できない要求をレビューすることができます。</li><li><strong>レガシーなプロトコルと API のブロック</strong>: これには、「Basic 認証」のような <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/block-legacy-authentication">古い認証プロトコルをブロック</a> し、「Open ID Connect」や「OAuth 2」のような最新のプロトコルを使うようにすることが含まれます。利用しているアプリケーションがこれらの要件を満たしていることを組織全体で確認ください。</li></ul><h2 id="ゼロ-トラストでの構築を始める方法"><a href="#ゼロ-トラストでの構築を始める方法" class="headerlink" title="ゼロ トラストでの構築を始める方法"></a>ゼロ トラストでの構築を始める方法</h2><p>さらに詳しく知りたい方は、<a href="https://docs.microsoft.com/security/zero-trust/">Zero Trust Guidance Center</a> に公開された開発者向けの新しいガイダンスをご覧ください。このガイダンスには、Zero Trust に対応したアプリケーションを開発するための <a href="https://docs.microsoft.com/en-us/security/zero-trust/identity-developer">新しい開発および統合リソース</a> が含まれています。</p><p>詳細については、こちらからダウンロードできる開発者向けホワイトペーパーをご覧ください: <a href="https://aka.ms/ztdev">Zero Trust for the Microsoft Identity developer</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、 Azure Identity サポート チームの小出です。&lt;/p&gt;
&lt;p&gt;本記事は、 2021 年 11 月15 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>お客様のセキュリティを強化する新しい ID パートナーシップと統合</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/</id>
    <published>2021-11-17T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.273Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2021 年 11 月 3 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/new-identity-partnerships-and-integrations-to-strengthen-your/ba-p/2810629">New identity partnerships and integrations to strengthen your security</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>今週の Microsoft Ignite では、お客様が様々なプラットフォームやクラウド間で耐障害性、安全性、生産性を向上できるように、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/identity-at-ignite-strengthen-resilience-with-identity/ba-p/2747271">最新の ID イノベーション</a> について紹介いたしました。今週初めに紹介した新しいイノベーションに加えて、私たちは Azure Active Directory (Azure AD) の機能を拡張するために、さまざまなテクノロジー パートナーと協力してきました。私たちは複数のパートナーと協力しアプリケーションを統合することで、シームレスなアクセスを提供し、お客様固有の環境でのセキュリティをより強化するよう取り組んでいます。現在利用可能な新しいパートナー統合機能については、以下をご覧ください。</p><h2 id="Azure-AD-アプリ-ギャラリーで利用可能な新たな統合済みアプリ"><a href="#Azure-AD-アプリ-ギャラリーで利用可能な新たな統合済みアプリ" class="headerlink" title="Azure AD アプリ ギャラリーで利用可能な新たな統合済みアプリ"></a>Azure AD アプリ ギャラリーで利用可能な新たな統合済みアプリ</h2><p>Azure AD との統合において、私たちは独立系ソフトウェア ベンダー (ISVs) と密に提携し、Azure AD アプリ ギャラリーに統合済みのアプリを追加し続けています。7 月以降、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new#new-federated-apps-available-in-azure-ad-application-gallery---september-2021">シングルサインオン（SSO）をサポートする 101 の新しいアプリ</a> と、<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/fundamentals/whats-new#new-provisioning-connectors-in-the-azure-ad-application-gallery---september-2021">23 の新しいプロビジョニング コネクタ</a> を追加しました。構築済みのこれらのアプリやコネクタを統合することにより、Azure AD で使用するアプリケーションの設定や管理、セキュリティ強化が容易になります。Azure AD アプリ ギャラリーに追加された注目のアプリは以下のとおりです。</p><p><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/SSOandProvisioningIntergrations.jpg"></p><h2 id="Pathlock-社との統合により職務分離チェックの準拠状態を確認"><a href="#Pathlock-社との統合により職務分離チェックの準拠状態を確認" class="headerlink" title="Pathlock 社との統合により職務分離チェックの準拠状態を確認"></a>Pathlock 社との統合により職務分離チェックの準拠状態を確認</h2><p>Azure AD の <a href="https://jpazureid.github.io/blog/azure-active-directory/ensure-compliance-using-separation-of-duties-checks-in-access-jp/">エンタイトルメント管理</a> において、職務の分離チェック機能がプレビューで利用できるようになり、ユーザーが過剰なアクセス権を保持しないように管理することができます。運営者やアクセス管理者は、ユーザーがすでに他のアクセス パッケージに割り当てられていたり、要求されたアクセスと互換性のない他のグループのメンバーであったりする場合、ユーザーが追加のアクセス パッケージを要求するのを防ぐことができます。</p><p>これまで SAP や Oracle、その他の財務アプリケーションやビジネス アプリケーションに厳しい規制要件を持つ企業は、IT ガバナンス、リスク管理、コンプライアンス (GRC) の専門ベンダーを活用して、これらのアプリケーション内でトランザクション レベルの制御やアクセスに関するレポートを行ってきました。当社は GRC パートナーやビジネス アプリケーションの開発者と共同で統合機能を開発しており、この機能により、金融アプリケーションやその他のビジネス クリティカルなアプリケーション、さらに Azure AD に統合されたアプリケーションの間においてアクセス制御を一貫して確認し、職務の分離チェックを実施することが可能になります。</p><p>近日、私たちはアクセス オーケストレーションのベンダーである <a href="https://pathlock.com/">Pathlock</a> 社と提携し、Azure AD のエンタイトルメント管理を同社のソリューションに統合しました。この統合により、Pathlock 社のお客様は、Azure AD のアクセス パッケージで詳細な職務の分離チェック機能を活用できるようになり、将来的には 140 以上の重要な <a href="https://pathlock.com/integrations/">ビジネス アプリケーション</a> に対してサーベンス オクスリー法 (SOX 法) などコンプライアンス要件に対応できるようになります。</p><p><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/BusinessApplications.jpg"></p><h2 id="SentinelOne-社-や-Illusive-Networks-社との統合により条件付きアクセスを利用したセキュリティを強化"><a href="#SentinelOne-社-や-Illusive-Networks-社との統合により条件付きアクセスを利用したセキュリティを強化" class="headerlink" title="SentinelOne 社 や Illusive Networks 社との統合により条件付きアクセスを利用したセキュリティを強化"></a>SentinelOne 社 や Illusive Networks 社との統合により条件付きアクセスを利用したセキュリティを強化</h2><p>多くの場合、情報や脅威インテリジェンス、リスクの共有は縦割りの組織構造により分断されており、お客様にとってセキュリティ上の課題となっています。だからこそ、私たちのソリューションが幅広く連携して動作できるよう、セキュリティ エコシステム全体でパートナー関係を確立することが重要だと考えています。</p><p>先日、当社は SentinelOne 社と提携し、Azure AD を <a href="https://www.sentinelone.com/platform/">SentinelOne Singularity Platform</a> に統合しました。SentinelOne をエンドポイントに直接展開し Azure AD と統合することで、両社のお客様はすべてのユーザー ID やエンドポイントに対して、継続的かつ自動的に信頼性を検証する仕組みを利用いただけます。また、SentinelOne でユーザーが何かしらの影響を受けたことが確認された場合、ユーザーの情報はリアルタイムに Azure AD と共有され、<a href="https://www.youtube.com/watch?v=7ihTzvnmkeI">組織の条件付きアクセス ポリシーが作動</a> します。</p><p><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/ConditionalAccess.png"></p><p>上記に加えて、マイクロソフトは Illusive Networks 社と提携し、<a href="https://illusive.com/illusives-integration-with-azure-active-directory-conditional-access/">Illusive 社の ID リスク管理ソリューション</a> に条件付きアクセス ポリシーを統合しました。Illusive Networks 社は、ID のリスクやポリシー違反を自動的に軽減することで、特権を持つ ID に対する攻撃を減らすことが可能です。これは特に機密性の高い認証情報にリスクが検出された場合に、条件付きアクセス ポリシーをより強力に適用することで実現します。</p><p><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/PrivlegedIdentities.png"></p><h2 id="未来に向けて検証済みの安全なデジタル-ID-を創る"><a href="#未来に向けて検証済みの安全なデジタル-ID-を創る" class="headerlink" title="未来に向けて検証済みの安全なデジタル ID を創る"></a>未来に向けて検証済みの安全なデジタル ID を創る</h2><p>当社は ID コミュニティのリーダーと協力して、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/verifiable-credentials">検証された情報や資格情報が安全で標準化された方法でやり取り</a> されることを可能にし、<a href="https://www.microsoft.com/security/blog/2021/10/06/microsofts-5-guiding-principles-for-decentralized-identities/">プライバシー、セキュリティ、公正さ、個人のコントロールの原則</a> に沿ったテクノロジーによって、すべての人が自分自身の ID を所有および管理できるよう取り組んでいます。</p><p>先日、当社は <a href="https://www.clearme.com/">CLEAR</a> とのコラボレーションを発表しました。これにより、CLEAR の利用者は、プライバシーとセキュリティを維持しながら、デジタル ID をより多くの場所で活用できるようになります。この Azure AD との統合により、ユーザーは Authenticator アプリを通じて、CLEAR によって検証されたデジタル資格情報にアクセスできるようになります。この資格情報には、健康状態、ワクチン接種記録、年齢確認、支払い方法などが含まれますが、これらに限定されるものではありません。</p><h2 id="IDEMIA-mID-によるサインインとサインアップの効率化"><a href="#IDEMIA-mID-によるサインインとサインアップの効率化" class="headerlink" title="IDEMIA mID によるサインインとサインアップの効率化"></a>IDEMIA mID によるサインインとサインアップの効率化</h2><p>現在プレビュー中の機能で、Azure AD B2C のお客様は、IDEMIA mID ソリューションでモバイル運転免許証の <a href="https://docs.microsoft.com/ja-jp/azure/active-directory-b2c/partner-idemia?pivots=b2c-custom-policy">サインイン / サインアップ</a> が可能となります。IDEMIA 社の <a href="https://www.idemia.com/mobile-id">Mobile ID</a> により、市民は政府発行の信頼されたデジタル ID を利用できるようになり、自撮り写真の照合や自分で選択した PIN、TouchID/FaceID を活用することで、ID を検証できるようになります。Mobile ID を用いると、市民が各取引に必要な情報のみを共有でき、自分の ID をコントロール可能となります。</p><p><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/IDEMIA.gif"></p><h2 id="新しい-FIPS-認定済みの-FIDO2-セキュリティ-キー"><a href="#新しい-FIPS-認定済みの-FIDO2-セキュリティ-キー" class="headerlink" title="新しい FIPS 認定済みの FIDO2 セキュリティ キー"></a>新しい FIPS 認定済みの FIDO2 セキュリティ キー</h2><p>2021 年 5 月に発表された <a href="https://www.federalregister.gov/documents/2021/05/17/2021-10460/improving-the-nations-cybersecurity">大統領令</a> 以来、弊社は Yubico 社や FEITIAN 社などの FIDO2 セキュリティ キーのトップ ベンダーと協力して、両ベンダーのソリューションとして FIPS 140-2 認定を完了し、これらのセキュリティ キーが Windows 11 や Azure AD と互換性があることを確認してきました。新しい認定済みのキーは、以下のとおりです。</p><table><thead><tr><th>製品画像</th><th>解説</th></tr></thead><tbody><tr><td><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/FEITAN.png"></td><td><strong>FEITIAN バイオメトリック FIDO セキュリティ キー</strong>: FEITIAN 社は現在、<a href="https://www.ftsafe.com/article/792.html">バイオメトリック</a> FIPS 140-2 認定済みの FIDO2 セキュリティ キーを提供しており、FIPS 140-2 レベル 2 を達成しています。</td></tr><tr><td><img src="/blog/azure-active-directory/new-identity-partnerships-and-integrations-to-strengthen-your/Yibico.png"></td><td><strong>Yubico 5 シリーズ</strong>: Yubico 社は、<a href="https://www.yubico.com/products/yubikey-fips/">YubiKey 5</a> シリーズで FIPS 140-2 の検証を完了しました。FIPS 140-2 検証により、政府機関や規制産業は、新しい NIST SP800-63B ガイダンスの最高レベルである <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/standards/nist-authenticator-assurance-level-3">認証保証レベル 3 (AAL3)</a> の要件を満たすことができます。</td></tr></tbody></table><h2 id="ゼロ-トラスト-ガイダンス-センターで次の統合を始めましょう"><a href="#ゼロ-トラスト-ガイダンス-センターで次の統合を始めましょう" class="headerlink" title="ゼロ トラスト ガイダンス センターで次の統合を始めましょう"></a>ゼロ トラスト ガイダンス センターで次の統合を始めましょう</h2><p>マイクロソフトのセキュリティ製品と統合したゼロ トラスト対応ソリューションの開発に関心のあるパートナー様のために <a href="https://docs.microsoft.com/ja-jp/security/zero-trust/integrate/overview">ゼロ トラスト リソース センター</a> に新しいテクノロジー パートナー統合セクションを追加しました。新しいテクノロジー パートナー統合セクションでは、複数のゼロ トラストの技術分野に渡り、パートナーの皆様が統合の機会について学ぶことが可能です。Azure AD や Azure AD B2C と統合するゼロ トラスト対応ソリューションの構築方法や、ソリューションを活用できる ID 管理のシナリオについては、以下の動画でご紹介しております。</p><p>【動画】 <a href="https://youtu.be/2QY-aDFvnO8">Microsoft Azure Active Directory: Zero Trust partner integrations</a></p><p>セキュリティ エコシステム全体のパートナーシップに感謝申し上げるとともに、今後のさらなる統合の機会に期待しております。ご意見がございましたら、Twitter の <a href="https://twitter.com/Sue_Bohn">@Sue_Bohn</a> までコメントをお寄せください。</p><p>Sue Bohn<br>Vice President of Program Management<br>Microsoft Identity Division<br>Twitter: <a href="https://twitter.com/Sue_Bohn">@Sue_Bohn</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 3 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authenticator アプリ - アイコンを刷新し企業アカウントをより簡単に追加および管理できるようになりました。</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/microsoft-authenticator-app/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/microsoft-authenticator-app/</id>
    <published>2021-11-13T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.245Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 11 月 4 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/microsoft-authenticator-app-easier-ways-to-add-or-manage/ba-p/2464408">Microsoft Authenticator app – easier ways to add or manage enterprise accounts, and a cool new icon</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>皆さん、こんにちは。</p><p>本日は、<a href="https://www.microsoft.com/ja-jp/security/mobile-authenticator-app?cmp=zgcv4w_jfocsi">Microsoft Authenticator アプリ</a> にいくつかの素晴らしいアップデートを行い、企業 (会社または学校のアカウント) アカウントにおけるユーザー体験が向上されたことをお伝えします。内容は以下の通りです。</p><ul><li>アプリ内でのアカウント管理</li><li>企業アカウントのためのアカウント追加機能の改善</li><li>より先進的な印象を与える新しいアイコンへの変更</li></ul><h2 id="アプリ内でのアカウント管理"><a href="#アプリ内でのアカウント管理" class="headerlink" title="アプリ内でのアカウント管理"></a>アプリ内でのアカウント管理</h2><p>今年の初めに、Microsoft Authenticator で個人の Microsoft アカウントを直接管理できる機能を <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-to-the-microsoft-authenticator-app-now-rolling-out/ba-p/1169863">発表</a> しました。それ以来、企業のお客様から、会社や学校のアカウントでも Authenticator で同じ機能を利用したいというご意見をいただいていました。本日、Azure AD アカウントでも同じ機能を利用できるようになりました。ここでは、設定を管理する 3 つの方法をご紹介します。</p><p><strong>(1) パスワードの変更</strong>  </p><p>Microsoft Authenticator で仕事や学校のアカウントをタップし、新しい「パスワードの変更」オプションをクリックすると、アプリ内からすぐにアカウントのパスワードを変更することができます。</p><p><img src="/blog/azure-active-directory/microsoft-authenticator-app/fig1.png"></p><p><strong>(2) セキュリティ情報の更新</strong>  </p><p>職場や学校のアカウントの認証方法を、Microsoft Authenticator 内で管理することもできるようになりました。Authenticator でアカウントをタップし、「セキュリティ情報の更新」をクリックください。モバイル用の <a href="https://mysignins.microsoft.com/security-info">セキュリティ情報ページ</a> が表示され、認証方法を管理することができます。</p><p>セキュリティ情報ページの詳細については、こちらのブログをご覧ください: <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/combined-mfa-and-password-reset-registration-is-now-generally/ba-p/1257355">Combined MFA and password reset registration is now generally available</a></p><p><img src="/blog/azure-active-directory/microsoft-authenticator-app/fig2.png"></p><p><strong>(3) 最近のアクティビティの確認</strong>  </p><p>職場や学校のアカウントのサインイン履歴を Microsoft Authenticator からすぐに確認できるようになり、異常なアクティビティを報告できるようになりました。サインインの履歴を確認するには、Authenticator でアカウントをタップし、「最近のアクティビティを確認する」 をクリックします。</p><p>予期せぬサインインを報告する方法について詳しくは、こちらをご覧ください:<br><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/end-users-can-now-report-this-wasn-t-me-for-unusual-sign-in/ba-p/1257369">End users can now report “This wasn’t me” for unusual sign-in activity</a></p><p><img src="/blog/azure-active-directory/microsoft-authenticator-app/fig3.png"></p><h2 id="企業アカウントの追加方法の改善"><a href="#企業アカウントの追加方法の改善" class="headerlink" title="企業アカウントの追加方法の改善"></a>企業アカウントの追加方法の改善</h2><p>Microsoft Authenticator で会社や学校のアカウントを追加する際、ユーザーが常に PC の前など別の画面の前にいるとは限らないと思います (例えば、ユーザーがモバイル デバイスだけを持って移動している場合など)。<br>この度、Microsoft Authenticator に直接サインインすることで、別の画面から QR コードをスキャンすることなく、新しい職場や学校のアカウントを追加することができるようになりました。これにより、企業ユーザー向けの Microsoft Authenticator のセットアップが大幅に簡略化されます。詳細についてはこちらもご覧ください: <a href="https://support.microsoft.com/ja-jp/account-billing/%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E4%BB%95%E4%BA%8B%E7%94%A8%E3%81%BE%E3%81%9F%E3%81%AF%E5%AD%A6%E6%A0%A1%E3%82%A2%E3%82%AB%E3%82%A6%E3%83%B3%E3%83%88%E3%82%92microsoft-authenticator%E3%81%99%E3%82%8B-43a73ab5-b4e8-446d-9e54-2a4cb8e4e93c#sign-in-with-your-credentials">アプリに仕事用または学校アカウントをMicrosoft Authenticatorする</a></p><p>Microsoft Authenticator にサインインすることで、セットアップを実施する流れは以下の通りです。</p><ol><li>アカウントの追加ボタン（iOS では右上の「＋」、Android では「＋アカウントの追加」）をタップします。</li><li>「職場または学校のアカウント」をタップします。</li><li>「サインイン」をタップし、認証情報を入力しサインインします。</li></ol><p>必要な手順を経ることで、Authenticator が管理者のポリシーに従って設定されます。</p><p><img src="/blog/azure-active-directory/microsoft-authenticator-app/fig4.png"></p><h2 id="アイコンをより先進的なデザインに変更"><a href="#アイコンをより先進的なデザインに変更" class="headerlink" title="アイコンをより先進的なデザインに変更"></a>アイコンをより先進的なデザインに変更</h2><p>最後に、Microsoft Authenticator アプリケーションのアイコンがアップデートされたことをお知らせいたします。新しいアイコンは先進的かつ、Microsoft の幅広いデザイン言語に準拠しています。下図に示すように、新しいアイコンは既存のお客様にもなじみ深いものと思います。この変更により、Microsoft Authenticator に関する既存の挙動が変更されることはありません。なお、このデザインの変更は、2021 年 11 月以降、複数のプラットフォームで段階的に適用される予定です。</p><p><img src="/blog/azure-active-directory/microsoft-authenticator-app/fig5.png"></p><p>これらの新しいアップデートをお楽しみいただければ幸いです。また、お客様からのご意見やご要望もお待ちしております。以下のコメント欄または <a href="https://feedback.azure.com/d365community/forum/22920db1-ad25-ec11-b6e6-000d3a4f0789">Azure AD フィードバックフォーラム</a> でご意見をお聞かせください。</p><p>Alex Simons (<a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 4 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Ignite における ID 関連の発表まとめ - Azure AD の技術革新による障害耐性の強化</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/identity-at-ignite-strengthen-resilience-with-identity/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/identity-at-ignite-strengthen-resilience-with-identity/</id>
    <published>2021-11-07T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.197Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 高田 です。</p><p>本記事は、2021 年 11 月 2 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/identity-at-ignite-strengthen-resilience-with-identity/ba-p/2747271">Identity at Ignite: Strengthen resilience with identity innovations in Azure AD</a> を意訳したものになります。</p><hr><p>脅威や攻撃が拡大し続ける中でハイブリッドな業務を実現するには、障害や攻撃からの復旧に多方面から取り組むことが必要です。どれほどサイバー セキュリティを強固にしても、セキュリティに起因する問題や危機的状況、あるいはビジネスの急激な成長など良い意味での課題を含め、様々な混乱は発生するものであり、組織の運営を継続しながら可能な限り迅速に状況を回復するため、それらあらゆる問題を抑え込んでいく必要があります。</p><p>当社は、お客様のパートナーとして、お客様の組織が安全かつ生産性を維持できるよう Azure AD への投資を行っています。今週の Microsoft Ignite での私のセッションでは、基盤となるプラットフォームの機能やセキュリティ、マルチ クラウドなど、これら多岐にわたる投資内容についてお話ししました。我々は、より耐障害性の高い ID サービス、特定が困難な攻撃も検知して対応するツール、デジタル資産全体のセキュリティ態勢を強化するシステムなどを構築しています。</p><h2 id="より耐障害性の高い-ID-サービス"><a href="#より耐障害性の高い-ID-サービス" class="headerlink" title="より耐障害性の高い ID サービス"></a>より耐障害性の高い ID サービス</h2><p>マイクロソフトは Azure AD がお客様の組織にとっていかに重要であるかを理解しております。結局のところ、ユーザーがサインインできなければ、何のサービスも利用できなくなってしまいます。お客様の信頼を継続して得ていく必要があると考え、8 つの基本原則に基づいてサービスの信頼性を高める投資を継続しています。</p><p><img src="/blog/azure-active-directory/identity-at-ignite-strengthen-resilience-with-identity/ReliabilityPrinciples.png"></p><p><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/99-99-uptime-for-azure-active-directory/ba-p/1999628">99.99% の SLA コミットメント</a> を確実に実現するため、独自の技術革新を進めています。例えば、Azure AD サービス全体に <strong>セル ベースのアーキテクチャ</strong> を採用しました。これは、サービスの一部で予期せぬ障害が発生した場合、その障害を一部にとどめ、サービスの他の部分に影響を与えないようにするためです。現在、Azure AD は 107 のセルに分割されています。最大規模のセルであっても、ユーザー全体の最大 1.7% しか利用していないため、障害が発生しても大多数のお客様には影響がないようにしています。</p><p>また、<strong>バックアップ認証サービス</strong> にも投資しています。これは、プライマリの認証システムがダウンした場合でも、セッションを維持するためのセカンダリ システムです。このシステムもマイクロソフトのクラウドで稼働していますが、プライマリの Azure AD サービスとは完全に分離されています。停電時の発電機のような役割を果たし、アクティブなセッションを引き継ぐことで、ユーザーがアプリにアクセスする際に従来と変わりのないユーザー体験を提供します。また、セキュリティ設定やアクセスの準拠状態も維持されますので、例えば条件付きアクセス ポリシーの適用やロールの変更に基づくアクセス可否の制御なども可能です。このバックアップ サービスは、現在 Exchange と SharePoint のワークロード、およびすべてのネイティブ デスクトップ アプリとモバイル アプリに対して有効です。本年末までには、すべてのウェブ アプリケーションにも対応する予定です。</p><p><strong>発表内容</strong> </p><ul><li>2021 年末までに Web アプリケーションのワークロードをサポートする Azure AD バックアップ認証サービスを提供予定</li></ul><h2 id="特定が困難な攻撃を検知して対応するツール"><a href="#特定が困難な攻撃を検知して対応するツール" class="headerlink" title="特定が困難な攻撃を検知して対応するツール"></a>特定が困難な攻撃を検知して対応するツール</h2><p>ID に対する攻撃は激化しています。実際、ID は新たなサイバー セキュリティの戦場となっており、攻撃の防止と検知のためのツールがこれまで以上に重要になっています。</p><p>攻撃を防止するため、マイクロソフトの <a href="https://www.microsoft.com/ja-jp/security/business/zero-trust">Zero Trust</a> アーキテクチャの中核をなすアクセス ポリシー エンジンである Azure AD <a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/identity-compromise">条件付きアクセス</a> にいくつかの機能強化を行っています。</p><ul><li>新しい <strong>条件付きアクセスの概要ダッシュボード</strong> では、組織のサインイン パターンの分析に基づいて、ポリシーを強化するヒントを提供します。また、Azure AD のセキュリティのベスト プラクティスに基づいて作成された <strong>テンプレート</strong> を利用して、追加の保護機能を迅速に導入することもできます。ダッシュボードと <a href="https://aka.ms/CATemplates/">テンプレート</a> は、共に現在パブリック プレビューです。</li><li><strong>アプリケーションとデバイスに対する条件付きアクセス フィルター</strong> を用いて、ポリシーの対象をよりきめ細かく設定し、特定のニーズに合わせてポリシーを改良することが可能です。このフィルターは、新しいアプリケーションやデバイスに動的に適用され、例えば、Intune のポリシーに準拠しているか、ハイブリッド ドメイン参加済みか、セキュア アクセス ワークステーションとして定義されているデバイスのいずれかでのみ、機密性の高いアプリケーションへのアクセスを許可するといったポリシーを構築することができます。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-condition-filters-for-devices">デバイス用のフィルター</a> は現在一般提供済みとなっており、アプリ用のフィルターは年内にパブリック プレビューが開始される予定です。</li><li>人間以外の ID (アプリやサービスのワークロード ID) も、アクセス権限の付与が進むにつれ、悪意のある攻撃者から注目されるようになってきています。今月末にパブリックプレビューが開始される <strong>ワークロード ID 用の条件付きアクセス</strong> を使用して、これらの種類の ID を対象としたポリシーを設計することが可能となります。</li><li><strong>継続的なアクセス評価</strong> は、条件付きアクセスを個々のセッションに拡張し、新たなリスクが発生した場合に、ほぼリアルタイムでポリシーを適用する仕組みです。<a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/concept-continuous-access-evaluation">この機能</a> は年内に一般公開される予定です。</li></ul><p><img src="/blog/azure-active-directory/identity-at-ignite-strengthen-resilience-with-identity/ConditionalAccess.png"></p><p>強力な攻撃防止機能があっても、ゼロ トラストのアプローチでは常に侵害が起こることを想定します。Azure AD では、<a href="https://www.microsoft.com/ja-jp/security/business/identity-access-management/identity-compromise">Identity Protection</a> がリアルタイムでインテリジェントなリスク評価を行い、脅威や攻撃を検知して修復します。今回、Identity Protection を強化し、新機能を追加しました。これらの機能は一般提供済みとなっています。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks#sign-in-risk">新しいプロアクティブな検知機能</a> を追加することで、<strong>異常なトークンやセッション クッキーに対する見慣れないサインイン プロパティの検知</strong> など、一般的な攻撃手法と新たな攻撃手法の両方に対応します。</li><li>Identity Protection は、環境全体のユーザーおよびアクセス アクティビティを継続的に分析することで、リスクの特定や弱点の強化に利用できるデータを生成します。<strong>Identity Protection の診断設定</strong> では、選択した SIEM にワンクリックでリスク データをエクスポートしたり、データ保持期間を簡単にカスタマイズすることができます。Azure Monitor 上に構築された <strong>新しい Identity Protection リスク分析ワークブック</strong> は、リスク データと対応策の有効性を可視化するのに役立ちます。</li></ul><p> <img src="/blog/azure-active-directory/identity-at-ignite-strengthen-resilience-with-identity/HeatmapOfRiskDetections.png"></p><p>耐障害性を維持するということは、破壊的な状況に直面したときも、従業員や社外のチーム メンバーと連携できる対応力を維持することでもあります。Azure AD は、Microsoft Teams での安全なコラボレーション体験をサポートします。</p><p><strong>発表内容</strong></p><ul><li>Identity Protection のトークン盗難検出機能の一般提供開始</li><li>Identity Protection の診断設定の一般提供開始</li><li>Identity Protection のリスク分析ワークブックの一般提供開始</li><li>条件付きアクセスのデバイス フィルターの一般提供開始</li><li>2021 年末までに継続的アクセス評価の一般提供開始</li><li>条件付きアクセスのが用ダッシュボードのプレビュー開始</li><li>条件付きアクセステンプレートのプレビュー開始</li><li>2021 年 11 月後半でのワークロード ID 用の条件付きアクセスのプレビュー開始</li><li>2021 年末までに条件付きアクセスのアプリケーション フィルターのプレビュー開始</li></ul><h2 id="デジタル資産全体のセキュリティ対策を強化するシステム"><a href="#デジタル資産全体のセキュリティ対策を強化するシステム" class="headerlink" title="デジタル資産全体のセキュリティ対策を強化するシステム"></a>デジタル資産全体のセキュリティ対策を強化するシステム</h2><p>攻撃がより巧妙になっているだけでなく、ハイブリッドやマルチ クラウド戦略の採用、人やワークロードの ID も爆発的に増加しており、お客様環境も同様の対応を迫られていると思います。クラウド プロバイダーはアクセス管理の仕組みに異なるオペレーション モデルを採用しているため、複雑な環境でゼロトラストの原則である最小特権の考え方を実現することは困難です。</p><p>ほとんどの企業は自社のビジネスに最も適したアプリケーションやソリューションを選択できるように、マルチ クラウド戦略を採用しています。私たちは、マイクロソフトのクラウドで実行される部分だけでなく、お客様の環境全体を確実に保護したいと考えています。そのために、今年の初めに <a href="https://blogs.microsoft.com/blog/2021/07/21/microsoft-acquires-cloudknox-security-to-offer-unified-privileged-access-and-cloud-entitlement-management/">CloudKnox 社を買収</a> しました。CloudKnox 社のテクノロジーは、企業がすべての主要なクラウド上のすべての ID とリソースについて、アクセス許可の確認、リスクの評価と修正、異常なアクティビティの検出を支援します。これらの強力な機能を Azure AD や幅広いマイクロソフトのエコシステムと統合していく中で、来年にかけてより多くの情報を皆様に提供してまいります。</p><p>また、ID のプロビジョニング、ライフサイクル管理、ワークフローの自動化、権限管理、および分析を含む統合マルチクラウド ソリューションの提供に取り組んでいます。この戦略を推進するために、Azure AD Identity Governance を拡張し、<strong>オンプレミスやプライベート クラウドでホストされているアプリへもプロビジョニング</strong> を可能としました。個別のガバナンス システムを持つアプリ (<a href="https://docs.microsoft.com/en-us/azure/active-directory/app-provisioning/on-premises-application-provisioning-architecture">基礎となる SQL データベースやサードパーティの LDAP ディレクトリに依存しているアプリなど</a>) へのプロビジョニングも提供します。これにより、すべてのアプリケーションに対して一貫したアクセスのプロビジョニングが可能になります。</p><p>また、Azure Logic Apps をベースにした <strong>カスタム エンタイトルメント ワークフロー</strong> により、ユーザーのプロビジョニングやライフサイクルの管理を容易に行えるようにしました。Azure Logic Apps は、Salesforce や Office 365、SQL など、何百もの既存システムとのコネクターを備えており、独自にコーディングする必要はありません。</p><p><strong>発表内容</strong></p><ul><li>Azure AD からのオンプレミス アプリケーション プロビジョニングのプレビュー開始</li><li>Azure AD エンタイトルメント管理のカスタム割り当てワークフローのプレビュー開始</li></ul><h2 id="認証基盤の近代化"><a href="#認証基盤の近代化" class="headerlink" title="認証基盤の近代化"></a>認証基盤の近代化</h2><p>お客様がクラウドならではのセキュリティの進化を享受できるように、我々のチームでは、お客様がより多くのワークロードをクラウドに移行できるようにする新しい方法の検討を進めています。例えば、アプリの認証の流れをオンプレミスの Active Directory Federation Services (AD FS) から Azure AD に移行する際には、<strong>新しいクレーム、クレーム変換、トークン フィルタリング、SAML 構成設定の追加</strong> などのプレビューを利用して、<a href="https://docs.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-fed-group-claims">移行を加速</a> することができます。</p><p>また、特にワークロード ID に関連するシークレットをよりセキュアにする取り組みを採用することも検討ください。多くのアプリケーション開発者が、未だにアプリの登録にパスワード シークレットを使用しており、その中には有効期間が長いものもあります。<a href="https://docs.microsoft.com/en-us/graph/api/resources/applicationauthenticationmethodpolicy?view=graph-rest-beta">Microsoft Graph で利用できる</a> <strong>新しい認証方法ポリシー</strong> のプレビューでは、パスワード シークレットの使用をブロックしたり、その有効期限を制限したり、ワークロード ID のキーの資格情報に最大の有効期限を設定したりすることができます。また、<strong>GitHub Actions による Azure AD ワークロード ID 連携のサポート</strong> もプレビューとなりました。これにより、アプリケーション開発者は、アプリケーションを Azure にデプロイする際に、GitHubのリポジトリに Azure AD の認証情報を作成および保存する必要がなくなります。 </p><p><strong>発表内容</strong></p><ul><li>Azure AD での新しいクレーム、クレーム変換、トークン フィルタリング、SAML 構成設定のプレビュー開始</li><li>アプリとワークロード ID の新しい認証方法ポリシーのプレビュー開始</li><li>ワークロード ID 連携による GitHub との統合のプレビュー開始</li></ul><p>これらの機能をオンデマンドでご覧になりたい方は、<a href="https://myignite.microsoft.com/home">Microsoft Ignite</a> に無料で登録し、太平洋時間の本日午後 1 時 30 分から始まる私のセッション <a href="https://myignite.microsoft.com/sessions/fe5951da-9fa5-4e09-b529-007fff7a2add?source=sessions">Strengthen resilience with identity innovations in Azure AD</a> をご覧ください。また、今後数週間、<a href="https://aka.ms/identityblog">このブログ</a> でこれらの機能の詳細の案内や、お客様の組織に導入するためのベストプラクティスをご紹介していきますのでご注目ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 高田 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 11 月 2 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>User at risk detected のメールを受け取ったときの対応について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/</id>
    <published>2021-11-04T15:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.177Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、 Azure ID チームの小出です。<br>今回は、 Azure AD Identity Protection の通知機能のうち、 User at risk detected のメールを受け取ったときの対応についてご案内します。  </p><h2 id="はじめに"><a href="#はじめに" class="headerlink" title="はじめに"></a>はじめに</h2><p>Azure AD Premium P2 ライセンスをご利用いただいている多くの企業では、不審なサインインやリスクを監視するために Identity Protection を活用していることと思います。<br>Identity Protection を活用する中で、以下のメールを受信したことがある方も多いのではないでしょうか。  </p><p><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk1.png"></p><p>日々お問い合わせいただくなかでも、上記のメールを受け取ったものの、どういった理由でメールが送られたのか知りたい、どのように対応していいかわからない、といったお問い合わせを多く頂戴していますので、今回は以下 3 点についてご紹介します。  </p><span id="more"></span><h3 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h3><p>A. User at risk detected のメールはなぜ届くのか<br>B. メールが届いたら、どのように対応したらよいか<br>C. 補足情報  </p><h2 id="A-User-at-risk-detected-のメールはなぜ届くのか"><a href="#A-User-at-risk-detected-のメールはなぜ届くのか" class="headerlink" title="A. User at risk detected のメールはなぜ届くのか"></a>A. User at risk detected のメールはなぜ届くのか</h2><p>User at risk detected という件名のメールは、Identity Protection 機能がユーザーのリスクを検出した旨を通知しています。<br>Identity Protection では、機械学習機能を用いて、テナント上に存在するユーザーに関するオンライン リスク (サインイン時のリスク)、オフライン リスク (非サインイン時に計算処理によって検出されるリスク) を検出することが可能です。<br>これらのリスク検出の結果、リスク レベル (低・中・高) が、事前に設定した通知の閾値 (たとえば高を通知) に達した際に、メールが送信されます。  </p><p>実際に、メールのリンクから Identity Protection の画面にアクセスして確認してみると、たとえば以下のように、何人かのユーザーが “危険なユーザー” として検知されていることが分かります。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk2.png"></p><p>リスクの詳細は、 Identity Protection の “リスク検出” 画面にて確認いただくことも可能です。<br>以下のように [IP アドレス] の列を確認いただくことで、アクセス元のグローバル IP アドレスを確認いただくこともできます。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk3.png"></p><h2 id="B-メールが届いたら、どのように対応したらよいか"><a href="#B-メールが届いたら、どのように対応したらよいか" class="headerlink" title="B. メールが届いたら、どのように対応したらよいか"></a>B. メールが届いたら、どのように対応したらよいか</h2><p>Microsoft では、ユーザーのリスクがしきい値以上になった場合に、ユーザー リスク ポリシーなどを活用して、自動的にリスクを修復することを推奨しています。  </p><blockquote><p><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies#choosing-acceptable-risk-levels">https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-risk-policies#choosing-acceptable-risk-levels</a><br>Microsoft で推奨しているのは、ユーザー リスク ポリシーのしきい値を [高] に設定し、サインイン リスク ポリシーを [中以上] に設定して、自己修復オプションを許可することです。 </p></blockquote><p>そのため、ユーザー リスク ポリシーやサインイン リスク ポリシーをすでに利用されている場合は、本フローを実施する必要は通常ございません。<br>しかしながら、リスク ポリシーをまだ利用されていない環境や、長期にわたりリスクが修復されていないユーザーがいる環境などでは、管理者がリスクを修復・無視することで対処を行うことが可能です。  </p><p>以下はユーザーのリスクが高として検出され、管理者に User at risk detected メールが送付された時の管理者の対応フローです。こちらを参考に、管理者は検知されたリスクへの対処を速やかに実施ください。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk4.png">  </p><p>それぞれのフローについて下記で詳細に説明します。  </p><div class="alert is-success"><p class="alert-title">ヒント</p><p>下記フローでは、Azure AD Identity Protection でリスクを検出した際の一般的な対処方法について記載しています。</p><p>すでに被害が発生しているなど緊急の場合は、このフローを 1 から順に実施する必要はありません。</p><p>被害の拡大を防ぐために、まずは本フローの 5-1 を確認し、パスワードのリセットやアカウントのブロックなどを実施してください。（その後ヒアリングや調査を行います）  </p></div><h3 id="1．リスク種類の確認"><a href="#1．リスク種類の確認" class="headerlink" title="1．リスク種類の確認"></a>1．リスク種類の確認</h3><p>まず、発生したリスクがどのような理由で発生したかを確認します。<br>[検出の種類] という項目を確認すると、そのリスクがなぜ発生したのか、理由を確認することができます。<br>リスクの種類につきましては、以下の公開情報も併せてご確認ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks#risk-types-and-detection">https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks#risk-types-and-detection</a></p><p>リスクがあると判断される理由は複数ありますが、一般的によくあるものとしては、たとえば実行するクライアントの IP アドレスが普段と違う、匿名 IP アドレスからアクセスしている、いつもと違う国からアクセスしている、といったリスクが考えられます。<br>一方、パスワード スプレーなど、実際に攻撃が行われている可能性がある重大なリスクも存在します。<br>もし実際に攻撃が行われ、すでに被害が出ている場合など緊急の場合は、まずステップ 5-1 でパスワードのリセットやアカウントのブロックを実施ください。</p><h3 id="2-該当ユーザーへのヒアリング"><a href="#2-該当ユーザーへのヒアリング" class="headerlink" title="2. 該当ユーザーへのヒアリング"></a>2. 該当ユーザーへのヒアリング</h3><p>ステップ 1 でリスクの種類について確認したら、リスクが発生したユーザーにヒアリングを行います。<br>このヒアリングは、発生したリスクが悪意ある攻撃者を検知したのか、正規ユーザーの正しい操作を誤検知したのかを確認するフローです。<br>具体的には、以下のような項目をユーザーにヒアリングいただければと思います。  </p><ul><li>「リスク検出日時に実際のサインインを行ったか」</li><li>「リスク検出日時に出張などで大幅な移動を行っていないか」</li><li>「リスク検出日時に端末周辺環境 (デバイス交換、ネットワーク機器) に大きな変化 (グローバル IP アドレスが変わるなど) はなかったか 」</li><li>「リスク検出日時に海外にホストされた VM 上などから該当ユーザーでの操作を行っていないか」</li><li>「リスク検出日時に端末上で特殊なアプリケーションを起動したうえで Azure にアクセスをしていないか」</li><li>「リスク検出日時に普段の業務と異なるオペレーションはあったか」</li></ul><p>たとえば、出張などでいつもと異なる場所、国からアクセスしていたり、クライアント端末を変更したりしている事実が確認できれば、このリスクは侵害ではなく、誤検知であることを確認できます。  </p><h3 id="3-リスクの取り扱いを決定"><a href="#3-リスクの取り扱いを決定" class="headerlink" title="3. リスクの取り扱いを決定"></a>3. リスクの取り扱いを決定</h3><p>リスクを無視するかどうか、取り扱いを決定します。<br>たとえば上記のヒアリングにて、発生したリスクが問題ないもの (誤検知) であると確認できたら、発生したリスクを手動でクローズし、無視しても問題ないと判断することができます。(この場合は 5-3 へ)  </p><p>それ以外の場合は、実際にサインインに成功しているか失敗しているかをもとに、どのような対処方法を行うか検討します。<br>具体的な対処方法の詳細は、次のステップで決定します。 (この場合は 4 へ)  </p><h3 id="4-具体的な対処方法の決定"><a href="#4-具体的な対処方法の決定" class="headerlink" title="4. 具体的な対処方法の決定"></a>4. 具体的な対処方法の決定</h3><p>ユーザーにリスクの心当たりがなく攻撃の可能性がある場合、まずは、怪しいサインインの試行が成功しているか、失敗しているかを確認し、それをもとに対処方法を決定します。<br>サインインに成功している場合は、すでにアカウントが侵害されている可能性が考えられるため、緊急度を上げてリスクへの対応を行います。（この場合は 5-1 へ）  </p><p>サインイン試行に失敗している場合は、実際にアカウントが侵害されている状況ではないため、順次対応を検討します。（この場合は 5-2 へ）  </p><h3 id="5-リスクのクロージング"><a href="#5-リスクのクロージング" class="headerlink" title="5. リスクのクロージング"></a>5. リスクのクロージング</h3><p>このステップでは、これまでに検討・決定した内容をもとに、リスクへの対応を行います。各シナリオごとに、それぞれ手順を以下に記載します。  </p><p><strong>5-1 サインインに成功しており攻撃が疑われる場合、すでに被害が出ている場合</strong><br>このシナリオの場合、アカウントがすでに侵害されている可能性があるため、まずは被害が広がらないよう緊急度を高めて対応します。  </p><p>まずは、Identity Protection 上で、ユーザーに対するセキュリティ侵害が発生したことをマークします。<br>同時に、管理者側から、まずは暫定策としてそのユーザーのパスワードをリセットします。  </p><p>攻撃者がアカウントを侵害して、たとえばすでに迷惑メールやなりすましのメールを送っているなどの被害がある場合、パスワードをリセットすることで、被害がそれ以上拡大することを防ぐ効果があります。<br>ユーザーのパスワード リセットは、グローバル管理者だけでなく、ユーザー管理者やパスワード管理者でも実行できるため、まずはできるだけ早くパスワードのリセット行い、現在のパスワードでサインインできない状態にします。<br>管理者がパスワードをリセットすると一時的なパスワードが生成されるため、十分な強度を持った新しいパスワードに変更するようユーザーに依頼してください。<br>また、MFA などの登録も依頼し、パスワードが漏洩したのみではサインインできないように構成することも検討します。  </p><p>▼ 発生したリスクが侵害であることを確認する手順</p><ol><li><p>Azure ポータルにサインインします。</p></li><li><p>[Azure AD Identity Protection] を選択します。</p></li><li><p>[危険なユーザー] を選択します。</p></li><li><p>該当するユーザーを選択し、 [ユーザーに対するセキュリティ侵害を確認する] を選択します。</p><p> <img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk5.png">  </p></li><li><p>以下のように警告画面が表示されるので、 [はい] をクリックします。<br> <img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk6.png">  </p></li><li><p>以下のように、正常に処理が完了することを確認します。<br> <img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk7.png">  </p></li></ol><ol start="7"><li>リスクの状態に [セキュリティ侵害を確認しました] と表示され、リスク レベルが “高” になることを確認します。<br> <img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk8.png">  </li></ol><div class="alert is-success"><p class="alert-title">ヒント</p><p>リスクレベルが中だった場合は、このように明示的にセキュリティ侵害を確認した旨をマークすることで、リスクレベルを最上位の高に変更することが可能です。</p><p>リスクレベルが高だった場合もマークを行うことで監査ログに対処記録が残りますので、この意味でも本オペレーションは必ず実施します。  </p></div><p>▼ 管理者がユーザーのパスワードをリセットする手順  </p><ol><li><p>Azure ポータルにサインインします。</p></li><li><p>[Azure AD Identity Protection] - [危険なユーザー] にアクセスし、リスクをクローズしたいユーザーを確認します。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk9.png">  </p></li><li><p>[Azure Active Directory] – [ユーザー] をクリックし、ユーザー一覧を開きます。  </p></li><li><p>リスクを解消させたいユーザーを選択します。  </p></li><li><p>画面上部の [パスワードのリセット] をクリックします。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk10.png">  </p></li><li><p>以下のように表示されるので、 [パスワードのリセット] をクリックします。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk11.png">  </p></li></ol><ol start="7"><li>一時パスワードが表示されるので、内容を控え、安全な方法でユーザー通知します。</li><li>一時パスワードを使用して、ユーザーがサインインすると、新しいパスワードへの変更画面が表示されるので、新しいパスワードを設定します。</li><li>[危険なユーザー] や [リスク検出] の画面から、ユーザーの記載が消えることを確認します。以下のようにフィルターですべてを選択すると、管理者がパスワードをリセットしたことで、ユーザー リスクが修復されたことが確認できます。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk12.png">  </li></ol><p>▼ ユーザーからのサインインをブロックする方法<br>実際に攻撃を受けている可能性がある場合など、一時的にアカウントへのサインイン自体をブロックしたい場合には、以下の手順でサインインを行えないようにすることも可能です。<br>ただし、この設定を行うと、攻撃者・本来のユーザーを問わずサインインができなくなる点にご留意ください。  </p><ol><li>Azure ポータルにサインインします。</li><li>[Azure Active Directory] - [ユーザー] を開き、該当のユーザーをクリックします。</li><li>[編集] をクリックし、 [サインインのブロック] を [はい] に設定します。</li><li>[保存] をクリックします。</li></ol><p>その後、実際の被害状況 (メールの送受信履歴やアクセスしたファイルなどの調査) や、いつどこからのアクセスによって侵害されたかなど、詳しい調査を実施します。<br>サインイン ログの調査や、侵害されたアカウントでどのような操作が行われたかなどを確認する必要がある場合は、お問い合わせいただくことで弊社側での支援も可能です。  </p><p><strong>5-2 ユーザーにリスクの心当たりはなく、サインインに失敗している場合</strong><br>このシナリオの場合、サインインには成功していないため、緊急度を上げる必要はありませんが、リスクの修復は必要です。<br>5-1 のシナリオと同様に、管理者がパスワードをリセットすることで、リスクをクローズすることが可能ですが、SSPR の設定が完了しているユーザーであれば、管理者がリセットすることなく、ユーザーが自身のパスワードをリセットすることもできます。  </p><p>SSPR を使用するメリットは、以下の通りです。  </p><ul><li>管理者が生成させた一時パスワードを、ユーザーに通知する必要がないため、メールなどでパスワードの平文を記載する必要がない</li><li>ユーザーに SSPR の実施を依頼するのみのため、管理者の負担が軽減される</li><li>即座にパスワードをリセットする必要はないため、ユーザーが自身の任意タイミングで、パスワードをリセットすることができる</li></ul><p>特に 3 点目に記載の、ユーザーが任意のタイミングでパスワードリセットを実施できる点は、管理者の手動リセットによってユーザーの業務 (Outlook や Teams といった Office 365 アプリケーションを使った重要な業務) が急に停止されることを抑止しています。そのため、積極的に本方式を活用いただければと思います。  </p><p>▼ SSPR を使用して、ユーザーが自身でパスワードをリセットする手順</p><ol><li><p>管理者は、リスクの発生しているユーザーを確認し、 SSPR を使用してパスワードをリセットするよう依頼します。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk13.png">  </p></li><li><p>パスワードをリセットするよう依頼されたユーザーは、パスワード リセット ポータルからリセットを実施します。<br>最も簡単な方法は、aka.ms/sspr にアクセスする方法です。サインインの際に [パスワードを忘れた場合] をクリックすることでもリセットが可能です。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk14.png">  </p></li></ol><div class="alert is-warning"><p class="alert-title">警告</p><p>パスワード変更ではなく、明示的に SSPR を実行する必要がある点にご留意ください。</p></div><ol start="3"><li><p>以下のような画面が表示されるので、必要事項を入力して次へ進みます。次の画面では、電話番号やメール アドレスなどを使用した認証を行います。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk15.png">  </p></li><li><p>本人確認が完了すると、新しいパスワードを設定できます。以下のように表示されれば、正常にパスワードがリセットされています。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk16.png"></p></li><li><p>[危険なユーザー] や [リスク検出] の画面から、ユーザーの記載が消えることを確認します。以下のようにフィルターですべて選択すると、ユーザー リスクが修復されたことが確認できます。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk17.png"></p></li></ol><p>なお、”パスワードの末尾を 1 から 2 に変更した” など、リセット後に再度推測されやすいパスワードを設定した場合などは、<br>検出されたリスクは表面上解消され、Identity Protection の画面からはリスクが表示されなくなるものの、外部からの攻撃に対し潜在的なリスクが引き続き残ります。<br>リスクを下げる観点での暫定的な対処策では、パスワードをリセットいただく方法で問題ありませんが、より安全にアカウントを利用するために、MFA を利用するなどの恒久的な対策もご検討ください。  </p><p><strong>5-3 ユーザーにリスクの心当たりがあり、リスクが誤検知であったことが判明した場合</strong><br>ユーザーにヒアリングを行い、リスク検出が誤検知であると判断できた場合 (例:「あり得ない移動」というリスクが検出されたが、ユーザーは当日出張で長距離移動を行っていた場合など) に、発生しているリスクに対し “問題ない” 旨を手動で設定し、リスクをクローズする方法となります。<br>こちらの方法は上記と異なり、ユーザーがパスワードをリセットする必要はなく、リスクをそのままクローズすることが可能です。  </p><p>▼ 発生しているユーザー リスクを無視する手順</p><ol><li>Azure ポータルにサインインします。</li><li>[Azure AD Identity Protection] を選択します。</li><li>[危険なユーザー] を選択します。</li><li>該当するユーザーを選択し、 [ユーザー リスクを無視する] を選択します。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk18.png"></li></ol><ol start="5"><li>以下のように警告が表示されるので、[はい] をクリックします。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk19.png"></li></ol><ol start="6"><li>リスクがクローズされるまでに、数分程度かかるので待機します。</li><li>[危険なユーザー] や [リスク検出] の画面からユーザーの記載が消えることを確認します。以下のようにフィルターですべて選択すると、ユーザー リスクが破棄されたことが確認できます。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk20.png"></li></ol><h2 id="C-補足情報について"><a href="#C-補足情報について" class="headerlink" title="C. 補足情報について"></a>C. 補足情報について</h2><p>最後に、 以下補足情報についてご案内します。  </p><h3 id="1-メール通知の設定方法"><a href="#1-メール通知の設定方法" class="headerlink" title="1. メール通知の設定方法"></a>1. メール通知の設定方法</h3><p>冒頭に紹介したメールは、特定の管理者ロールを持つユーザーにのみ送信されるメールです。<br>グローバル管理者、セキュリティ管理者、セキュリティ閲覧者をもつユーザーのうち、各ロールごとに最大 20 人（3 ロール併せて最大 60 人）のみに送付されています。  </p><p>通知が行われるタイミングは、おおよそ以下の 3 種類となります。  </p><ul><li>リスクのあるユーザーが新規に発生し、[危険なユーザー] に新しいユーザーが追加されたとき</li><li>リスク レベルが更新され、メール通知の閾値を超えたとき</li><li>過去すでにリスクが発生し通知が行われたユーザーに対し、新たなリスクが発生したとき</li></ul><p>メール通知は、あらかじめ設定したレベル以上のリスクが発生した時に、管理者にメールを送信しています。<br>そのため、”リスク レベル中” 以上で通知を行う設定としている場合、リスク レベル低のユーザーが発生しても通知は行われません。<br>しかしながら、リスク レベル低が発生した後、同じユーザーに新たなリスクが発生しリスク レベルが中に更新されると、そのタイミングで通知が行われます。</p><p>また、すでに中程度のリスクが発生しているユーザーに対し新たなリスクが発生した場合も、改めての通知が行われます。<br>この時、ユーザーのリスク レベルが更新されない（中のままとなった）場合であっても、通知設定の閾値が “リスク レベル中” となっていれば、通知が行われます。  </p><p>[危険な状態のユーザーが検出された電子メール] の動作の詳細につきましては、以下の公開情報もご確認ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-notifications#users-at-risk-detected-email">https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-notifications#users-at-risk-detected-email</a></p><p>もし通知を受け取りたくない管理者がいる場合や、逆に通知を行いたいメールアドレスがある場合は、以下の手順で設定が可能です。</p><p>▼ メール通知の設定手順</p><ol><li>Azure ポータルにサインインします。</li><li>[Azure AD Identity Protection] を開きます。</li><li>[リスクのあるユーザーが検知された警告] をクリックします。</li><li>メール通知が設定されているユーザー一覧が表示されることを確認します。  </li><li>一覧の各ユーザーごとに記載がございます、右側の [アクション] にて、該当するユーザーへの通知設定を変更いただくことが可能です。通知が不要なユーザーの場合は [無効] に設定します。<br> また、このページに表示されていないユーザーに通知を送信したい場合は、[カスタム メールをこちらに追加してください] の枠にメールアドレスを入力します。  </li><li>[選択したユーザー リスクレベル以上でアラートを生成する] の項目にて、通知が発生するリスク レベルの閾値を指定します。</li><li>[保存] をクリックして設定を保存します。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk21.png"></li></ol><div class="alert is-success"><p class="alert-title">ヒント</p><p>グローバル管理者、セキュリティ管理者、セキュリティ閲覧者 のロールのいずれかが割り当てられているユーザーは、メール アドレスが登録されていれば、ロールごとに最大 20 人まで自動的に表示されます。</p><p>メール アドレスが登録されているにもかかわらず表示されない場合は、ロールの割り当てが “アクティブ” な状態であるかを確認してください。</p></div><h3 id="2-ユーザーリスクポリシー、サインインリスクポリシーの紹介"><a href="#2-ユーザーリスクポリシー、サインインリスクポリシーの紹介" class="headerlink" title="2. ユーザーリスクポリシー、サインインリスクポリシーの紹介"></a>2. ユーザーリスクポリシー、サインインリスクポリシーの紹介</h3><p>ユーザー リスク ポリシーやサインイン リスク ポリシーを使用すると、一定以上のリスクのあるユーザーがサインインしようとした際などに、たとえばパスワードの変更や MFA を強制したり、アクセスをブロックしたりすることができるようになります。<br>実際にリスクが発生した際には、先に記載した手順でリスクへの手動対応も可能ですが、こうした機能を利用することで、上述した管理者が行うリスク検出時の煩雑な確認・修復作業を自動化し管理者の負担を大きく軽減することが可能です。</p><p>たとえば、以下のようにユーザー リスク ポリシーを構成した際の動作について、簡単に紹介します。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk22.png"></p><p>上記のポリシーでは、リスク レベルが高のユーザーがサインインしようとした際に、パスワードの変更を求めるよう設定しています。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk23.png"></p><p>本人確認を実施すると、パスワードの変更画面が表示されます。この画面からパスワードを変更することで、リスクを自動で修復することが可能です。<br>（本フロー以外からパスワードを変更した際は、リスクが修復されないためご留意ください。）<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk24.png"></p><p><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk25.png"></p><p>再度 [危険なユーザー] の画面を確認すると、パスワードを変更したことでリスクが修復されたことが確認できます。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk26.png"></p><p>なお、SSPR と MFA の登録が完了していない場合は、上記のポリシーが構成されていても、以下のようにブロックされます。<br>この場合は、上記に記載のステップ 5-1 と同様、管理者側でリスクに対応する必要があります。<br><img src="/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk27.png">  </p><p>ユーザー リスク ポリシーやサインイン リスク ポリシーの活用方法につきましては、以下の弊社ブログにて詳細にご案内しています。<br>本記事に記載のリスク対応方法と併せて、ポリシーでの制御方法につきましてもご確認ください。<br><a href="https://jpazureid.github.io/blog/azure-active-directory/identity-protection-riskpolicy-introduction/">Identity Protection 2 つのリスク ポリシーの導入メリットについて</a></p><p>Identity Protection とリスクに関する以下の公開情報も、併せてご確認ください。<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks">https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/concept-identity-protection-risks</a><br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-remediate-unblock#manual-password-reset">https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-remediate-unblock#manual-password-reset</a><br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-notifications#users-at-risk-detected-email">https://docs.microsoft.com/ja-jp/azure/active-directory/identity-protection/howto-identity-protection-configure-notifications#users-at-risk-detected-email</a>  </p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは、 Azure ID チームの小出です。&lt;br&gt;今回は、 Azure AD Identity Protection の通知機能のうち、 User at risk detected のメールを受け取ったときの対応についてご案内します。  &lt;/p&gt;
&lt;h2 id=&quot;はじめに&quot;&gt;&lt;a href=&quot;#はじめに&quot; class=&quot;headerlink&quot; title=&quot;はじめに&quot;&gt;&lt;/a&gt;はじめに&lt;/h2&gt;&lt;p&gt;Azure AD Premium P2 ライセンスをご利用いただいている多くの企業では、不審なサインインやリスクを監視するために Identity Protection を活用していることと思います。&lt;br&gt;Identity Protection を活用する中で、以下のメールを受信したことがある方も多いのではないでしょうか。  &lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/blog/azure-active-directory/howto-deal-with-user-at-risk-detected-email/UserRisk1.png&quot;&gt;&lt;/p&gt;
&lt;p&gt;日々お問い合わせいただくなかでも、上記のメールを受け取ったものの、どういった理由でメールが送られたのか知りたい、どのように対応していいかわからない、といったお問い合わせを多く頂戴していますので、今回は以下 3 点についてご紹介します。  &lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Security" scheme="https://jpazureid.github.io/blog/tags/Security/"/>
    
    <category term="Identity Protection" scheme="https://jpazureid.github.io/blog/tags/Identity-Protection/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Ignite Fall 2021 開催のご案内</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/join-us-at-microsoft-ignite-fall-2021/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/join-us-at-microsoft-ignite-fall-2021/</id>
    <published>2021-10-30T22:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.229Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。 </p><p>本記事は、2021 年 10 月 28 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/join-us-at-microsoft-ignite-fall-2021/ba-p/2464409">Join us at Microsoft Ignite Fall 2021</a> を意訳したものになります。</p><hr><p>皆さん、こんにちは。</p><p>2021年 11 月 2 日から 4 日にかけて開催される <a href="https://myignite.microsoft.com/home">Microsoft Ignite</a> に <a href="https://register.ignite.microsoft.com/auth/login">バーチャルで参加</a> してみませんか？私たちのチームが開発した最新のツールのご紹介や、ベスト プラクティスの Deep Dive セッション、技術的なスキルアップやネットワーキングの機会などをご用意しております。 </p><p>「<a href="https://myignite.microsoft.com/sessions/fe5951da-9fa5-4e09-b529-007fff7a2add?source=sessions">Strengthen resilience with identity innovations in Azure AD</a>」 のセッションでは、太平洋時間 11 月 2 日の 1:30 PM (日本時間 11 月 3 日の 5:30 AM) より、私の上司である Joy Chik (Microsoft Identity and Network Access / Corporate Vice President) が Azure AD の最新機能を紹介します。障害耐性のあるプラットフォームや高度な脅威を検知して保護する新しいツールなどをとおして、生産性と安全性を維持するための取り組みを紹介する予定です。また、最近の <a href="https://jpazureid.github.io/blog/azure-active-directory/CloudKnox-acquisition-whats-available-now-and-whats-coming-soon/">CloudKnox 社の買収</a> が、拡大し続けるデジタル資産のセキュリティ体制をどのように強化するかについても説明します。</p><p>セッションをご覧になった後は、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/bg-p/Identity">Tech Community ブログ</a> 上で詳しい ID に関するニュースをご確認ください。また、太平洋時間 11 月 2 日の 2:30 PM (日本時間 11 月 3 日の 6:30 AM) からの <a href="https://myignite.microsoft.com/sessions/6d998f60-d6a0-48ef-bf82-197c4faf9209?source=sessions">ライブ Q&amp;A</a> では、Azure AD の最新技術に関する皆様からのご質問にお答えします。</p><p>多くの方がセキュリティに強い関心をお持ちだと思いますので、私も 「<a href="https://myignite.microsoft.com/sessions/647a94c1-2a9f-4678-a5ff-591bf787e454?source=sessions">Grounding Zero Trust in reality: Best practices and emerging trends</a>」と題した講演を太平洋時間 11 月 3 日 12:30 PM (日本時間 11 月 4 日 4:30 AM) より行います。Forrester Research 社の Steve Turner 氏とともに、ゼロ トラストがいかにビジネスの必須条件となっているかや最新のトレンドをご紹介します。</p><p>セッションやトレーニングはイベント期間中に放映され、オンデマンドで視聴できるようになっていますので、世界中のどこにいても参加することができます。ぜひ皆様の参加をお待ちしております。また、<a href="https://twitter.com/azuread">Twitter</a> や <a href="https://www.linkedin.com/showcase/microsoft-security/">LinkedIn</a> で、ハッシュタグ 「#MSIgnite」 をつけて会話に参加することもできます。  </p><h2 id="こちらのセッションもおすすめです"><a href="#こちらのセッションもおすすめです" class="headerlink" title="こちらのセッションもおすすめです"></a>こちらのセッションもおすすめです</h2><ul><li><p><a href="https://myignite.microsoft.com/sessions/88384a03-efb9-423c-8591-2db6b43ec7d2?source=sessions">Protect everything with end-to-end security</a> | 太平洋時間 11 月 2 日 (火) 10:35 AM (日本時間 11 月 3 日 (水) 2:35 AM)</p></li><li><p><a href="https://myignite.microsoft.com/sessions/a90a40be-e953-4a43-8f6a-a07691c5a76e?source=sessions">Understanding cyber security with Microsoft</a> | 太平洋時間 11 月 2 日 (火) 2:30 PM (日本時間 11 月 3 日 (水) 6:30 AM)</p></li><li><p><a href="https://myignite.microsoft.com/sessions/2a22eb1c-f0b0-4f55-beeb-f271d3261275?source=sessions">Product roundtable: Multi-cloud permissions management</a> | 太平洋時間 11 月 3 日 (水) 10:30 AM (日本時間 11 月 4 日 (木) 2:30 AM)</p></li><li><p><a href="https://myignite.microsoft.com/sessions/a3d82b5d-5132-41bd-bbae-15a116727ac3?source=sessions">Microsoft Into Focus: Security</a> | 太平洋時間 11 月 3 日 (水) 10:30 AM (日本時間 11 月 4 日 (木) 2:30 AM)</p></li><li><p><a href="https://myignite.microsoft.com/sessions/2d983523-8935-4d8d-8f92-4b48e5da45a0?source=sessions">From strong to stronger: Phishing resistant authentication methods</a> | 太平洋時間 11 月 3 日 (水) 3:30 PM (日本時間 11 月 4 日 (木) 7:30 AM)</p></li></ul><h2 id="以下への参加もお待ちしております"><a href="#以下への参加もお待ちしております" class="headerlink" title="以下への参加もお待ちしております"></a>以下への参加もお待ちしております</h2><p><a href="https://myignite.microsoft.com/community-connect?t=%257B%2522from%2522%253A%25222021-11-02T00%253A00%253A00-04%253A00%2522%252C%2522to%2522%253A%25222021-11-04T23%253A59%253A00-04%253A00%2522%257D">Connection Zone</a> では、知識やスキルを深める機会を提供しております。  </p><ul><li><p><a href="https://csc.docs.microsoft.com/ignite/registration/fall2021">Cloud Skill Challenges</a> に参加し、専門知識を身につけながら、認定試験を無料で受験できます。  </p></li><li><p>太平洋時間 11 月 2 日 3:30 PM (日本時間 11 月 3 日 7:30 AM) からのライブ セッション「<a href="https://myignite.microsoft.com/sessions/6b0616fb-ec62-4234-90f1-0421bb30204b?source=sessions">Exploring the Zero Trust Security Model</a>」では、ゼロ トラスト モデルのコンセプトと原則、そしてマイクロソフトがどのようにその取り組みを支援しているかを紹介します。</p></li><li><p>ID の専門家に質問がありますか？<a href="https://myignite.microsoft.com/app-consult">One-on-one Consultst</a> にアクセスし、ID の専門家と直接対話できる 45 分間のコンサルテーションを予約できます。</p></li></ul><p>Alex Simons (Twitter: <a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate Vice President, Program Management<br>Microsoft Identity and Network Access</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。 &lt;/p&gt;
&lt;p&gt;本記事は、2021 年 10 月 28 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://tech</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Authenticator による住所や支払い情報の自動入力</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/</id>
    <published>2021-10-30T21:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.017Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。 </p><p>本記事は、2021 年 10 月 25 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/autofill-your-addresses-and-payment-info-with-microsoft/ba-p/2464379">Autofill your addresses and payment info with Microsoft Authenticator</a> を意訳したものになります。</p><hr><p>皆さん、こんにちは。 </p><p>この度、<a href="https://aka.ms/AuthApp">Microsoft Authenticator</a> を利用した住所や支払い情報の自動入力機能が一般公開されました。 </p><p>Microsoft Authenticator によりパスワードが自動入力できるのと同じように (<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/bg-p/Identity">2021年 2 月に発表</a>)、<a href="https://go.microsoft.com/fwlink/?linkid=2144423">Microsoft アカウント</a> を使用して住所や支払い情報を自動入力できるようになりました。モバイル デバイスで自動入力データを同期していない場合は、Microsoft Authenticator を起動し、「パスワード」 タブに移動して、データの同期を開始できます。その際に、<a href="https://go.microsoft.com/fwlink/?linkid=2172589">Authenticator をデフォルトの自動入力プロバイダとして選択ください</a>。  </p><h2 id="まず-Authenticator-に住所や支払い情報を保存します"><a href="#まず-Authenticator-に住所や支払い情報を保存します" class="headerlink" title="まず Authenticator に住所や支払い情報を保存します"></a>まず Authenticator に住所や支払い情報を保存します</h2><p>Android をご利用の場合、サイトやアプリで住所や支払い情報を入力した際、Authenticator にその情報を保存することができます。デスクトップの <a href="https://www.microsoft.com/en-us/edge?r=1">Microsoft Edge</a> や <a href="https://chrome.google.com/webstore/detail/microsoft-autofill/fiedbfgcleddlbcmgdigjgdfcggjcion">Microsoft Autofill Extension for Google Chrome</a> を含むデバイス間で住所が同期され、自動的に入力されます。 </p><p><img src="/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/Mobile-save-address.gif"></p><p><img src="/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/Mobile-save-payment.gif"></p><h2 id="次に-Authenticator-を使用して住所や支払い情報を自動入力します"><a href="#次に-Authenticator-を使用して住所や支払い情報を自動入力します" class="headerlink" title="次に Authenticator を使用して住所や支払い情報を自動入力します"></a>次に Authenticator を使用して住所や支払い情報を自動入力します</h2><p>Android をご利用の場合、Authenticator が住所、支払い情報、保存したパスワードを候補として提案し、お気に入りのアプリやサイトで自動入力できるようになりました。</p><p><img src="/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/Mobile-Autofill-Address.gif"> </p><p><img src="/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/Mobile-Autofill-Payment.gif"> </p><p><strong>補足</strong>: iOS プラットフォームは全てのサードパーティに制限をかけており、自動入力プロバイダーおよびパスワード マネージャーが自動入力できるのはパスワードのみです。その他 (住所など) のデータは自動入力されません。このため、Microsoft Authenticator（およびその他サードパーティの自動入力プロバイダー) を iOS 上で利用した場合、 上記の Android のような機能をご利用できません。iOS では、 Authenticator を使って住所を同期することのみ可能です。同期された住所は、iOS デバイス上でアクセスするアプリやサイトに Authenticator からコピーすることができます。</p><p>デスクトップ端末で Google Chrome をお使いの場合、Google Chrome ウェブ ストアで提供されている <a href="https://go.microsoft.com/fwlink/?linkid=2174025">Microsoft Autofill Extension</a> を使って、住所や支払い情報を自動入力することができます。</p><p>すべての自動入力データは、デバイスとクラウドの両方で暗号化されています。さらに、Authenticator を使用して支払い情報を自動入力する際には、生体認証が必要になります。</p><p>自動入力は、個人の <a href="https://go.microsoft.com/fwlink/?linkid=2144423">Microsoft アカウント</a> を使用してデータを同期します。職場や学校のアカウント (Azure Active Directory アカウントなど) とは同期しません。Microsoft Authenticator に [パスワード]、[支払い]、[住所] タブが表示されない場合、お客様の組織が個人の Microsoft アカウントを使用した自動入力を無効にしている可能性があります。詳細は <a href="https://go.microsoft.com/fwlink/?linkid=2172589">こちら</a>をご覧ください。</p><p><img src="/blog/azure-active-directory/autofill-your-addresses-and-payment-info-with-microsoft/Address-Payment-switch.gif"> </p><p>皆様のご意見、ご感想をお待ちしております。</p><p>Alex Simons (<a href="https://twitter.com/Alex_A_Simons">@Alex_A_Simons</a>)<br>Corporate VP of Program Management<br>Microsoft Identity Division</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。 &lt;/p&gt;
&lt;p&gt;本記事は、2021 年 10 月 25 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://tech</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft が IDC MarketScape により世界的かつ先進的な認証のリーダーとして認められました</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/recognized-by-idc-marketscape-as-a-leader/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/recognized-by-idc-marketscape-as-a-leader/</id>
    <published>2021-10-21T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.325Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>本記事は、2021 年 10 月 7 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/microsoft-recognized-by-the-idc-marketscape-as-a-leader-in/ba-p/2464411">Microsoft recognized by the IDC MarketScape as a Leader in Worldwide Advanced Authentication for AAD</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><p>なお、IDC のレポートからの抜粋部分については、IDC より許可を得て翻訳しました。</p><hr><p>Microsoft は、IDC MarketScape：Worldwide Advanced Authentication for Identity Security 2021 Vendor Assessment (doc #US46178720、2021 年 7 月) レポートにて、リーダー (先進的なベンダー) として選出されました。</p><p>IDC MarketScape では、企業の ID セキュリティ機能と戦略を分析しており、Microsoft はリーダーとして認められた 7 社のうちの 1 社と認定されました。詳細は <a href="https://idcdocserv.com/US46178720e_Microsoft">レポートの抜粋</a> をご覧ください。</p><p><img src="/blog/azure-active-directory/recognized-by-idc-marketscape-as-a-leader/image1.png"></p><p>注意: 図や付随する言語を加工、編集することは禁止されています。本文書を他の言語に翻訳する場合や、本文書を第三者に提供 (再頒布) する場合は、別途 IDC との契約が必要です。</p><p>IDC MarketScape のベンダー分析モデルは、特定の市場において ICT サプライヤーが他社と比較してどれほど市場に適切に対応しているか概要を提供することを目的としています。調査方法は、質的基準と量的基準の両方に基づいた厳密な採点手法を採用しており、その結果を特定の市場における各ベンダーのポジションとして 1 つのグラフで表しています。Capabilities (縦軸) のスコアは、ベンダーの製品、市場投入、短期的なビジネスの実行力を評価しています。Strategy (横軸) スコアは、3 ～ 5 年のタイムフレームでのベンターの戦略と顧客要求との整合性を評価しています。ベンダーの市場シェアは、円の大きさで表されています。</p><p>出典: “IDC MarketScape: Worldwide Advanced Authentication for Identity Security 2021 Vendor Assessment”, By: Jay Bretzmann、2021 年 7 月、IDC # US46178720</p><p>レポートの中で、サイバー  セキュリティ リサーチのプログラムディレクターであるジェイ・ブレッツマン氏は次のように述べています: “Microsoft Active Directory と Microsoft Azure Active Directory は、他の全ディレクトリ サービス プロバイダーを合わせたものよりも大きな ID ストアになっています。Microsoft の ID エコシステムは拡大を続けており、Windows 環境だけでなく非 Windows 環境においてもほとんどのユースケースに対応できる高度な認証機能を提供しています”。レポートではさらに、Azure Active Directory の Identity Protection、条件付きアクセス、継続的なアクセス評価、検証可能な資格情報 (verifiable credentials) の機能もハイライトとして挙げています。</p><p>Microsoft は、ID に基づくセキュリティに最優先で取り組んでいます。そのため、当社の取り組みが IDC MarketScape で評価されたことを非常に光栄に思います。私たちは、製品の開発や新しいソリューションの革新を行う際に、セキュリティの原則を重要視しています。IDC MarketScape で評価されたことは、お客様に ID に基づくセキュリティと快適なユーザー体験を提供するという当社のビジョンを証明するものだと考えています。</p><p>IDC MarketScape のガイダンスは、以下のように Microsoft のセキュリティ原則とも一致しています。</p><ul><li><strong>多要素認証 (MFA) の有効化</strong>: レポートでは次のように述べられています: “IDC では、IT の調達側は、今年のセキュリティ ソフトウェア予算に MFA ソリューションを含めるべきと考えています。これは必ず実施すべきセキュリティの対応です。MFA は事実上 SaaS として提供されており、企業や組織にとって利用が推奨されるセキュリティ対策です”。</li><li><strong>パスワードレス化</strong>: レポートでは以下のように述べられています: “2021 年もしくは恐らく 2022 年以降になるかも知れませんが、パスワードレスのソリューションが、利用形態により広くユーザーに活用されるようになる日はそう遠くはありません。テクノロジーの調達者として、パスワードレスの導入は先延ばしにすべきでしょうか？IDC としてはそれは推奨しません。現在のパスワードレスの恩恵はデメリットを上回るものだからです。企業がパスワードのない未来を見据えることを願っています。”</li><li><strong>条件付きアクセス ポリシーの利用</strong>: IT 部門は、ユーザーがあるリソースにアクセスするために特定の条件を満たすことを要求する if-then ステートメントを設定することができます。</li><li><strong>Identity Protection の適用</strong>: 継続的なアクセス評価では、アカウントの無効化やパスワードのリセット、管理者によるユーザーの失効などの変更があった場合に、Exchange や Microsoft Teams へのアクティブなユーザー セッションをリアルタイムに終了させることが可能です。</li></ul><p>本レポートではまた、業界の動向やセキュリティ侵害の主な原因を調査し、セキュリティ ソリューションの選定に関する推奨事項を提案しています。</p><p>詳細につきましては、<a href="https://idcdocserv.com/US46178720e_Microsoft">レポートの抜粋</a> をご覧ください。</p><p>IDC MarketScape のベンダー評価に Microsoft が選ばれたことは、企業のセキュリティを高めるための直近の取り組みが業界で評価された最も新しい例といえます。より詳細については Microsoft のセキュリティに対する <a href="https://www.microsoft.com/ja-jp/security/business/security-leaders-gartner-magic-quadrant">先進的な取り組みの評価</a> をご覧ください。</p><p>また、Azure AD でセキュリティ対策を強化するためにできることについては、<a href="https://docs.microsoft.com/ja-jp/azure/security/fundamentals/steps-secure-identity">ID 基盤をセキュリティ保護する 5 つのステップ</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 10 月 7 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcomm</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Azure コマンド ライン ツールにおける Azure AD Graph から Microsoft Graph への移行について</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/migrate-aadgraph-to-msgraph/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/migrate-aadgraph-to-msgraph/</id>
    <published>2021-10-20T18:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.265Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの栗井です。</p><p>本記事は、2021 年 10 月 12 日に米国の Azure Tools Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-tools/azure-ad-to-microsoft-graph-migration-for-azure-command-line/ba-p/2836666">Azure AD to Microsoft Graph migration for Azure command line tools.</a><br> を意訳したものになります。</p><hr><p>先日アナウンスされた <a href="https://azure.microsoft.com/en-us/updates/update-your-apps-to-use-microsoft-graph-before-30-june-2022/">Azure AD Graph の廃止</a> に伴い、現在 Azure AD Graph を利用しているすべてのアプリケーションは、Microsoft Graph (Azure AD Graph の既存の機能と新しい機能を含みます) への切り替え対応が必要となります。この変更は各種 Azure コマンド ライン ツール (Azure CLI、Azure PowerShell、Terraform) にも当てはまります。現在弊社では、各種ツールが Microsoft Graph を利用するように切り替えの作業を進行中であり、皆様がお手持ちのコードを更新できるようなるべく早く公開するよう取り組んでいます。</p><blockquote><p>[!NOTE]<br>本記事内に登場する “Azure PowerShell” は、類似呼称の “Azure AD PowerShell” とは異なる、Azure リソース管理用の PowerShell モジュールです。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/powershell/azure/">Azure PowerShell 公開情報</a></li><li><a href="https://jpazureid.github.io/blog/azure-active-directory/powershell-module/">Azure AD PowerShell 関連記事</a></li></ul></blockquote><h2 id="既存のスクリプトへの影響"><a href="#既存のスクリプトへの影響" class="headerlink" title="既存のスクリプトへの影響"></a>既存のスクリプトへの影響</h2><p>原則として<strong>既存のスクリプトへの影響を最小限とする</strong>ことを目標としています。そのため、アップグレードを実施しても可能な限り同じコマンド実行結果となるようにして、利用者の追加作業が必要無いように進めています。</p><p>しかし、一部のコマンドについては Microsoft Graph API と Azure AD Graph API の動作の違いによって、変更の発生が想定されます。例えば、Microsoft Graph API を利用した場合、従来とは異なり、<a href="https://docs.microsoft.com/en-us/graph/api/application-post-applications?view=graph-rest-1.0&tabs=http">Azure AD にアプリケーションを登録</a> した際にクライアント シークレットは同時に自動作成されない動作となります。シークレット値を利用する場合は、アプリケーションの登録完了後、別途作成することが必要になります。上記例のような互換性への影響が懸念される変更点の一覧とお客様側で必要な対応については、ツールのプレビュー版と併せて情報を公開予定です。 </p><h2 id="Azure-コマンド-ライン-ツールと-Microsoft-Graph-のコマンドラインツールの比較"><a href="#Azure-コマンド-ライン-ツールと-Microsoft-Graph-のコマンドラインツールの比較" class="headerlink" title="Azure コマンド ライン ツールと Microsoft Graph のコマンドラインツールの比較"></a>Azure コマンド ライン ツールと Microsoft Graph のコマンドラインツールの比較</h2><p>Azure AD に対する操作には Azure AD PowerShell や Microsoft Graph SDK PowrShell が用意されています。このため、Azure コマンド ライン ツールでの Azure AD 関連機能は、スクリプト開発者の利便性のためよく利用される一部の機能のみが提供されており、機能は限定的となっています。</p><p>今後の Azure コマンド ツールでも、Azure AD リソースに対する機能については、部分的に継続してサポートしてまいりますが、認証など基本的な部分については新しい Graph の機能を実装する予定もございます。そこで提供されない機能は、Microsoft Graph ツール (Microsoft Graph SDK PowerShell モジュール、もしくは Microsoft Graph CLI) をご利用ください。 </p><h2 id="今後のタイムライン"><a href="#今後のタイムライン" class="headerlink" title="今後のタイムライン"></a>今後のタイムライン</h2><h3 id="2021-年-10-月"><a href="#2021-年-10-月" class="headerlink" title="2021 年 10 月"></a>2021 年 10 月</h3><ul><li>MSAL を使用した Azure CLI のパブリック プレビュー (※ MS Graph への移行にあたって必要なため)。</li><li>Microsoft Graph API を使用した Azure PowerShell のパブリック プレビュー</li></ul><p>※ 各ツールのドキュメントが公開された際には、プレビューをインストールしてテストする方法についてのガイダンスが記載される予定です。</p><h3 id="2021-年-12-月"><a href="#2021-年-12-月" class="headerlink" title="2021 年 12 月"></a>2021 年 12 月</h3><ul><li>Microsoft Graph API を使用した Azure PowerShell の一般提供 (GA) 開始</li><li>古いコマンドを使用した Azure サービスの関連ドキュメントおよびスクリプトの更新対応</li></ul><h3 id="2022-年-1-月"><a href="#2022-年-1-月" class="headerlink" title="2022 年 1 月"></a>2022 年 1 月</h3><ul><li>Microsoft Graph API を使用した Azure CLI のプレビュー</li></ul><h3 id="2022-年-Q1-1-月-3-月-中"><a href="#2022-年-Q1-1-月-3-月-中" class="headerlink" title="2022 年 Q1 (1 月 - 3 月) 中"></a>2022 年 Q1 (1 月 - 3 月) 中</h3><ul><li>Microsoft Graph API を使用した Azure CLI の 一般提供 (GA) 開始</li></ul><p>Terraform については、HashiCorp 社が Azure AD プロバイダ v2 で Microsoft Graph への移行をすでに完了しています。詳細については <a href="https://registry.terraform.io/providers/hashicorp/azuread/latest/docs/guides/microsoft-graph">AzureAD v2.0 and Microsoft Graph (terraform.io) ※外部リンク</a> をご覧ください。ご質問がある場合は、Azure CLI (<a href="https://twitter.com/azurecli">@azurecli</a>) もしくは Azure PowerShell (<a href="https://twitter.com/azureposh">@azureposh</a>) までご連絡ください。</p><h2 id="参考情報など"><a href="#参考情報など" class="headerlink" title="参考情報など"></a>参考情報など</h2><p>Azure 各種製品の公式ドキュメントが更新されるまで、Microsoft Graph への移行に関する追加ガイダンスとして、以下のリソースをご参照いただけますと幸いです。</p><p>MSAL への移行に関する追加情報と Microsoft Graph への移行における重要性:</p><ul><li><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/update-your-applications-to-use-microsoft-authentication-library/ba-p/1257363">Update your applications to use Microsoft Authentication Library and Microsoft Graph API (英語記事)</a></li><li><a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/have-you-updated-your-applications-to-use-the-microsoft/ba-p/1144698">Have you updated your applications to use the Microsoft Authentication Library and Microsoft Graph? (英語記事)</a></li><li><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/develop/msal-migration">MSAL への移行に関する概要</a></li><li><a href="https://docs.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-planning-checklist?view=graph-rest-1.0">アプリの移行計画チェックリスト (機械翻訳)</a></li></ul><p>Terraform における本変更への対応についての詳細情報 (※外部リンク):</p><ul><li><a href="https://registry.terraform.io/providers/hashicorp/azuread/latest/docs/guides/microsoft-graph">Terraform AzureAD provider v2 is now using Microsoft Graph</a></li></ul><p>問題を発見した際には、各製品の Github リポジトリにて Issue をオープンいただけますと幸いです。</p><ul><li>Azure CLI: <a href="https://github.com/Azure/azure-cli/issues">https://github.com/Azure/azure-cli/issues</a></li><li>Azure PowerShell: <a href="https://github.com/Azure/azure-powershell/issues">https://github.com/Azure/azure-powershell/issues</a></li><li>Terraform: <a href="https://github.com/hashicorp/terraform-provider-azuread/issues">https://github.com/hashicorp/terraform-provider-azuread/issues</a> </li></ul><p>不明点がありましたら、サポート チームまでお知らせいただければ幸いです。</p><p>Damien<br>on behalf of the Azure CLIs tools team</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの栗井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 10 月 12 日に米国の Azure Tools Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
  </entry>
  
  <entry>
    <title>Values of identifierUris property must use a verified domain of the organization or its subdomain エラーの対処法</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/aad-changes-impacting-azurecli-azureps/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/aad-changes-impacting-azurecli-azureps/</id>
    <published>2021-10-20T01:00:00.000Z</published>
    <updated>2021-12-10T10:01:40.984Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの栗井です。</p><p>本記事は、2021 年 10 月 14 日に米国の Azure Tools Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-tools/azure-active-directory-breaking-change-impacting-azure-cli-and/ba-p/2848388">Azure Active Directory breaking change impacting Azure CLI and Azure PowerShell</a> を意訳したものになります。</p><hr><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>2021 年 10 月 15 日より、Azure AD に登録されるシングルテナントアプリケーションの AppId URI (identifierUris) には、デフォルトのスキーム (api://{appId}) または検証済みドメインのいずれかが要求されるようになります。</p><ul><li>参考情報 (英語) : <a href="https://docs.microsoft.com/en-us/azure/active-directory/develop/reference-breaking-changes#appid-uri-in-single-tenant-applications-will-require-use-of-default-scheme-or-verified-domains">Upcoming changes - October 2021 - AppId Uri in single tenant applications will require use of default scheme or verified domains</a><br>※ 日本語版の公開情報 (ja-jp) では、本変更に関する記述が未記載です (2021/10/20 時点)。英語の原文 (en-us) をご確認いただけますと幸いです。<br>実際にサポートされるアプリケーション ID の URI を、公開情報より抜粋します。</li></ul><blockquote><p>以下の例にある API と HTTP スキーマー ベースのアプリケーション ID の URI がサポートされます。<code>&lt;appid&gt;</code> などのプレース ホルダーの値を、公開情報に記載の説明を元に置き換えてください。</p></blockquote><blockquote><table><thead><tr><th>サポートされるアプリケーション ID の URI フォーマット</th><th>アプリケーション ID の URI の例</th></tr></thead><tbody><tr><td><code>api://&lt;appId&gt;</code></td><td><code>api://fc4d2d73-d05a-4a9b-85a8-4f2b3a5f38ed</code></td></tr><tr><td><code>api://&lt;tenantId&gt;/&lt;appId&gt;</code></td><td><code>api://a8573488-ff46-450a-b09a-6eca0c6a02dc/fc4d2d73-d05a-4a9b-85a8-4f2b3a5f38ed</code></td></tr><tr><td><code>api://&lt;tenantId&gt;/&lt;string&gt;</code></td><td><code>api://a8573488-ff46-450a-b09a-6eca0c6a02dc/api</code></td></tr><tr><td><code>api://&lt;string&gt;/&lt;appId&gt;</code></td><td><code>api://productapi/fc4d2d73-d05a-4a9b-85a8-4f2b3a5f38ed</code></td></tr><tr><td><code>https://&lt;tenantIdDomain&gt;.onmicrosoft.com/&lt;string&gt;</code></td><td><code>https://contoso.onmicrosoft.com/productsapi</code></td></tr><tr><td><code>https://&lt;verifiedCustomDomain&gt;/&lt;string&gt;</code></td><td><code>https://contoso.onmicrosoft.com/productsapi</code></td></tr><tr><td><code>https://&lt;string&gt;.&lt;verifiedCustomDomain&gt;</code></td><td><code>https://product.contoso.onmicrosoft.com</code></td></tr><tr><td><code>https://&lt;string&gt;.&lt;verifiedCustomDomain&gt;/&lt;string&gt;</code></td><td><code>https://product.onmicrosoft.com/productsapi</code></td></tr></tbody></table></blockquote><p>上記の変更の影響により、Azure CLI または Azure PowerShell を最新のバージョンにアップグレードしていない場合、サービス プリンシパルの作成時に次のようなエラーメッセージが表示されることが想定されます。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Values of identifierUris property must use a verified domain of the organization or its subdomain</span><br></pre></td></tr></table></figure><p>例 : “az ad sp create-for-rbac” コマンド実行時</p><p><img src="/blog/azure-active-directory/aad-changes-impacting-azurecli-azureps/ps.png" alt="該当画面"></p><h3 id="解決方法"><a href="#解決方法" class="headerlink" title="解決方法"></a>解決方法</h3><p>各種ツールを以下のバージョンにアップグレードください。</p><ul><li>Azure CLI : 2.25.0 以降</li><li>Azure PowerShell : 6.0.0 以降</li></ul><p>この変更による影響については、各ツールの GitHub ページからご確認いただけますと幸いです。</p><ul><li>Azure CLI: <a href="https://github.com/Azure/azure-cli/issues/19892">https://github.com/Azure/azure-cli/issues/19892</a></li><li>Azure PowerShell: <a href="https://github.com/Azure/azure-powershell/issues/16097">https://github.com/Azure/azure-powershell/issues/16097</a></li></ul><h3 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h3><p>自動化ツールの新バージョンへのアップグレードが実施いただけない場合は、以下の手順によってエラーを回避し、サービス プリンシパルを作成ください。</p><ol><li><p>Azure Active Directory にカスタム ドメインを登録します (未実施の場合)。</p></li><li><p>承認された形式の IdentifierUri で、アプリケーションを登録します。</p><p> 例 (<a href="https://docs.microsoft.com/ja-jp/cli/azure/ad/app?view=azure-cli-latest#az_ad_app_create">az ad app create</a> コマンド):</p> <figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">az ad app create --display-name <span class="string">&quot;myApp&quot;</span> --identifier-uris <span class="string">&quot;https://test.contoso.com&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>登録したアプリケーションを参照するサービスプリンシパルを作成します。</p><p> 例 (<a href="https://docs.microsoft.com/ja-jp/cli/azure/ad/sp?view=azure-cli-latest#az_ad_sp_create">az ad sp create</a> コマンド):</p> <figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">az ad sp create --id &lt;2.で登録したアプリの App Id&gt;</span><br></pre></td></tr></table></figure></li></ol><div class="alert is-info"><p class="alert-title">Note</p><p>訳注: az ad sp create-for-rbac コマンド実行時に、適切なアプリケーション ID の URI を指定することでも回避可能です。</p></div><blockquote><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">az ad sp create-for-rbac --name <span class="string">&quot;https://test.&lt;verified-domain&gt;.com&quot;</span></span><br></pre></td></tr></table></figure></blockquote><hr><p>以上の内容がご参考になりましたら幸いです。ご不明点等ございましたらサポート チームまでお問い合わせください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの栗井です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 10 月 14 日に米国の Azure Tools Blog で公開された &lt;a href=&quot;https://techcommunity.microsoft.com</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Service Principal" scheme="https://jpazureid.github.io/blog/tags/Service-Principal/"/>
    
  </entry>
  
  <entry>
    <title>このデバイスを Azure Active Directory に参加させる のリンクが表示されない場合の確認点</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/aadj-link-is-not-displayed/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/aadj-link-is-not-displayed/</id>
    <published>2021-10-17T15:00:00.000Z</published>
    <updated>2021-12-10T10:01:40.988Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは。 Azure Identity サポート チームです。</p><p>こちらのブログでは、手動で Azure AD 参加を構成する際に利用する [このデバイスを Azure Active Directory に参加させる] のリンクが表示されない場合の確認点について紹介します。</p><span id="more"></span><h2 id="どんな事象？"><a href="#どんな事象？" class="headerlink" title="どんな事象？"></a>どんな事象？</h2><p>Azure AD 参加を手動で構成する場合は、Windows 10 にて [スタート] &gt; [設定] &gt; [アカウント] &gt; [職場または学校にアクセスする] の [接続] をクリックし、次の画面にて [このデバイスを Azure Active Directory に参加させる] のリンクから参加させます。</p><p><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/screen1.png"></p><p>しかし、次の画像のように [このデバイスを Azure Active Directory に参加させる] のリンクが表示されない場合があります。</p><p><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/screen2.png"></p><p>この事象について、本記事にて説明します。</p><h2 id="確認点"><a href="#確認点" class="headerlink" title="確認点"></a>確認点</h2><p>[このデバイスを Azure Active Directory に参加させる] のリンクが表示されないケースの確認点として、以下のようなパターンが考えられます。<br>これらの条件を満たしているか確認してください。</p><h3 id="1-Windows-に対して、管理者権限を保持していないユーザーとしてログオンしている"><a href="#1-Windows-に対して、管理者権限を保持していないユーザーとしてログオンしている" class="headerlink" title="1. Windows に対して、管理者権限を保持していないユーザーとしてログオンしている"></a>1. Windows に対して、管理者権限を保持していないユーザーとしてログオンしている</h3><ul><li>ローカルの Administrators グループに所属しておらず、端末に対して管理者権限を保持していないユーザーとして Windows にログオンしている場合、[このデバイスを Azure Active Directory に参加させる] が表示されません。</li><li>操作時に Windows にログオンしているユーザーが、ローカルの管理者権限を保持しているかご確認ください。</li></ul><h3 id="2-Azure-AD-への通信が行えない"><a href="#2-Azure-AD-への通信が行えない" class="headerlink" title="2. Azure AD への通信が行えない"></a>2. Azure AD への通信が行えない</h3><ul><li>Azure AD への通信が行えない状態の場合、[このデバイスを Azure Active Directory に参加させる] が表示されません。</li><li>「Azure AD への通信が行えない状態」とは、Azure AD の認証時に利用されるエンドポイントにインターネット経由でアクセスができない状態です。</li><li>次の公開情報  <a href="https://docs.microsoft.com/ja-jp/microsoft-365/enterprise/urls-and-ip-address-ranges?view=o365-worldwide#microsoft-365-common-and-office-online">Office 365 URL および IP アドレス範囲 - Microsoft 365 Common および Office Online</a> の項番 56, 59, 125 の宛先が Azure AD の認証に利用されるエンドポイントです。</li><li>項番 125 の宛先は厳密には Azure AD が提供するエンドポイントではございませんが、 [Azure AD が提示しうるサーバー証明書の失効確認先] のエンドポイントとなり、アクセスできるよう構成ください。</li><li>インターネットへのアクセスにプロキシを利用しているネットワーク環境の場合、クライアント端末が適切にプロキシ参照設定を行っているか、参照しているプロキシにて必要なエンドポイントへの通信をブロックしていないかに関してもご確認ください。</li></ul><h3 id="3-Windows-が-Home-エディションである"><a href="#3-Windows-が-Home-エディションである" class="headerlink" title="3. Windows が Home エディションである"></a>3. Windows が Home エディションである</h3><ul><li>もしご利用の端末が Windows Home エディションの場合、[このデバイスを Azure Active Directory に参加させる] が表示されません。</li><li>Professional もしくは Enterprise エディションをご利用ください。</li></ul><h3 id="4-Windows-に-built-in-administrator-ユーザーとしてログオンしている"><a href="#4-Windows-に-built-in-administrator-ユーザーとしてログオンしている" class="headerlink" title="4. Windows に built-in administrator ユーザーとしてログオンしている"></a>4. Windows に built-in administrator ユーザーとしてログオンしている</h3><ul><li>もし端末のローカル ユーザーである Administrator (built-in administrator) として Windows にログオンしている場合、[このデバイスを Azure Active Directory に参加させる] は表示されません。(既定ではこのユーザーは無効状態です)</li><li>運用上の都合で built-in administrator ユーザーとして Windows にログオンしている場合、別の “ローカルの管理者権限を持つ ローカル ユーザー” として Windows にログオンしてください。</li><li>次の公開情報 <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/faq#----------------------pc---azure-ad-----------------------">エラー情報が表示されなかったにもかかわらず、PC を Azure AD に参加させることができなかったのはなぜですか?</a> にも案内があります。</li></ul><h3 id="5-Windows-端末がすでにオンプレミスの-AD-に参加している"><a href="#5-Windows-端末がすでにオンプレミスの-AD-に参加している" class="headerlink" title="5. Windows 端末がすでにオンプレミスの AD に参加している"></a>5. Windows 端末がすでにオンプレミスの AD に参加している</h3><ul><li>もし該当の Windows 端末が、すでにオンプレミスの AD に参加している場合、[このデバイスを Azure Active Directory に参加させる]  は表示されません。</li><li>Azure AD 参加 は Azure AD に対してのみ直接参加する機能となるため、Azure AD 参加をする際はオンプレミス AD から離脱し、ワークグループの状態で実施ください。</li><li>もし、オンプレミス AD と Azure AD の両方に対して参加されたい場合は、Hybrid Azure AD 参加の構成をご検討ください。</li><li>参考情報: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/concept-azure-ad-join-hybrid">ハイブリッド Azure AD 参加済みデバイス</a><br>, <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/hybrid-azuread-join-plan">方法:Hybrid Azure Active Directory 参加の実装を計画する</a></li></ul><h2 id="補足-手動で-Azure-AD-参加を構成する手順"><a href="#補足-手動で-Azure-AD-参加を構成する手順" class="headerlink" title="補足  :  手動で Azure AD 参加を構成する手順"></a>補足  :  手動で Azure AD 参加を構成する手順</h2><p>前提となります、手動で Azure AD 参加を構成する手順は次の通りです。</p><p>Windows にて、[スタート] &gt; [設定] &gt; [アカウント] &gt; [職場または学校にアクセスする] にて [接続] をクリック。<br><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/joinaad1.png"></p><p>[このデバイスを Azure Active Directory に参加させる] をクリック。<br><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/joinaad2.png"></p><p>サインインが要求されますのでサインインします。<br><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/joinaad3.png"></p><p>次の画面にて [参加する] をクリックすることでデバイスを Azure AD に参加させることができます。<br><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/joinaad4.png"></p><p>次の画面が表示され Azure AD への参加が完了します。<br><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/joinaad5.png"></p><p>このタイミングで Azure AD (Azure ポータル) 上でも該当のデバイスが Azure AD joind として登録されます。<br><img src="/blog/azure-active-directory/aadj-link-is-not-displayed/joinaad6.png"></p><p>以上の情報がご参考になれば幸いです。<br>ご不明な点がございましたら弊社サポートまでお気軽にお寄せください。</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;こんにちは。 Azure Identity サポート チームです。&lt;/p&gt;
&lt;p&gt;こちらのブログでは、手動で Azure AD 参加を構成する際に利用する [このデバイスを Azure Active Directory に参加させる] のリンクが表示されない場合の確認点について紹介します。&lt;/p&gt;</summary>
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Azure AD Join" scheme="https://jpazureid.github.io/blog/tags/Azure-AD-Join/"/>
    
    <category term="Troubleshooting" scheme="https://jpazureid.github.io/blog/tags/Troubleshooting/"/>
    
  </entry>
  
  <entry>
    <title>ゼロ トラスト ソリューション提供パートナーを支援する統合ガイダンスのご紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/integration-guidance-helps-partners-deliver-zero-trust-solutions/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/integration-guidance-helps-partners-deliver-zero-trust-solutions/</id>
    <published>2021-10-10T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.205Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの 村上 です。</p><p>本記事は、2021 年 10 月 6 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/integration-guidance-helps-partners-deliver-zero-trust-solutions/ba-p/2810650">Integration guidance helps partners deliver Zero Trust solutions</a> を意訳したものになります。ご不明点等ございましたらサポート チームまでお問い合わせください。</p><hr><p>優れた製品を作るにはお客様のニーズに耳を傾けることが大切です。弊社では、お客様よりゼロ トラストの導入がこれまで以上に重要であるという強い声をいただいております。2021 年の <a href="https://www.microsoft.com/security/blog/2021/07/28/zero-trust-adoption-report-how-does-your-organization-compare/">ゼロ トラスト導入レポート</a> より、セキュリティの意思決定者の 96% が、企業の成功にはゼロ トラストが不可欠であると述べており、76% の企業が少なくともゼロ トラスト戦略の導入を開始していることがわかっています。今後 2、3 年の間、ゼロ トラスト戦略はセキュリティの最優先事項であり続けると予想され、企業はそれに対する投資を増やすと考えられています。</p><p>ゼロ トラストの導入は米国政府でも加速しています。2021 年 5 月、ホワイト ハウスはゼロ トラスト アーキテクチャへの移行を含む、国のサイバー セキュリティの改善を求める <a href="https://www.whitehouse.gov/briefing-room/presidential-actions/2021/05/12/executive-order-on-improving-the-nations-cybersecurity/">大統領令</a> に署名しました。直近では、アメリカ合衆国行政管理予算局 (Office of Management and Budget) が、2024 年 までに達成すべき主要な目標として、ゼロ トラスト アーキテクチャに向けた <a href="https://www.whitehouse.gov/omb/briefing-room/2021/09/07/office-of-management-and-budget-releases-draft-federal-strategy-for-moving-the-u-s-government-towards-a-zero-trust-architecture/">連邦戦略のドラフト</a> を発表しました。マイクロソフトは <a href="https://www.microsoft.com/en-us/federal/CyberEO.aspx">大統領令の目標を達成するための顧客ガイダンスとリソース</a> を公開しています。</p><p>お客様がエンド ツー エンド (end-to-end) でゼロ トラストのセキュリティ体制を目指すなか、このような政府や業界の要請は、お客様へのサポートを強化する上でマイクロソフトとパートナーにとって大きな機会となります。マイクロソフトではお客様が最も包括的なセキュリティ ソリューションを容易に導入できるよう、独立系ソフトウェア ベンダーなどのパートナーとの連携に努めています。私たちは、お客様がゼロ トラストという目標に到達するために様々な道筋を経る必要があること、そしてすでに複数のセキュリティ ソリューションをお持ちであることを認識しています。私たちが協力し、お客様のニーズに応えることで、企業や国家をより強固に守ることができるのです。</p><p>パートナーの統合とゼロ トラストへの対応をサポートするために、ゼロ トラスト ガイダンス センターにおいて <a href="https://docs.microsoft.com/ja-jp/security/zero-trust/integrate/overview">パートナー統合ガイダンス</a> を公開しました。このガイダンスはゼロ トラストの基本概念に沿って構成されており、さまざまな製品やパートナーとの統合を支援するものです。以下にその例を示します。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/security/zero-trust/integrate/identity">貴社のソリューションを Azure Active Directory と統合</a> することで、リスク シグナルを共有し、顧客の信頼を高めると共に高度なソリューション シナリオをサポートします。</li><li><a href="https://docs.microsoft.com/ja-jp/security/zero-trust/integrate/endpoints#microsoft-endpoint-manager">Microsoft Endpoint Manager</a> API を使用して、従業員が使用しているデバイスのコンプライアンスを確保します。</li><li><a href="https://docs.microsoft.com/ja-jp/security/zero-trust/integrate/visibility-automation-orchestration">Azure Sentinel との統合</a> により、顧客がよりデジタル資産全体を俯瞰できるよう強化します。</li></ul><p>セキュリティ ソリューションにゼロ トラスト アプローチを取り入れている企業を非常に嬉しく思います。以下にこれら企業の例として、ISV パートナーである F5 と Yubico が、ゼロ トラスト ガイダンス センターのパートナー統合ガイダンスをどのように活用したかご紹介します。</p><h2 id="F5-とマイクロソフトがマルウェアからダーラム郡-ノース-カロライナ州-を救う"><a href="#F5-とマイクロソフトがマルウェアからダーラム郡-ノース-カロライナ州-を救う" class="headerlink" title="F5 とマイクロソフトがマルウェアからダーラム郡 (ノース カロライナ州) を救う"></a>F5 とマイクロソフトがマルウェアからダーラム郡 (ノース カロライナ州) を救う</h2><p><img src="/blog/azure-active-directory/integration-guidance-helps-partners-deliver-zero-trust-solutions/F5.png"></p><p>多くの企業では、SAML や OIDC などの最新の認証プロトコルが採用される前に開発された基幹業務アプリケーションに依存しています。これは、ユーザを認証するために複数の方法を管理しなければならないことを意味し、結果としてユーザー体験を複雑にし、さらにコストも増加させます。<a href="https://www.f5.com/products/security/access-policy-manager">BIG-IP Access Policy Manager (APM)</a> は、アプリケーション、API、データへのアクセスを一元化する F5 のアクセス管理プロキシ ソリューションです。BIG-IP APM を Microsoft Azure AD と統合することで、BIG-IP APM のユーザー インターフェイスへの <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/conditional-access/overview">条件付きアクセス</a> を実現できます。</p><p>ダーラム郡 (アメリカ合衆国ノース カロライナ州に位置する郡) は昨年、深刻なサイバー セキュリティ事件をきっかけに、<a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/durham-county-enhances-security-across-a-hybrid-environment-with/ba-p/1633530">Azure AD と F5 BIG-IP APM を用いて、ハイブリッド環境のセキュリティを強化</a> しました。F5 BIG-IP APM により、従業員は従来のレガシーなオンプレミスのアプリにアクセスするために必要な統合ソリューションを得ることができました。F5 は Azure AD を使用して、すべてのアプリにセキュリティ制御を適用するとともに多要素認証を強制し、従業員のログイン場所などの状況に順応したポリシーを適用しています。さらに、このソリューションを利用したセルフ サービスのパスワード リセットにより、パスワードに関するヘルプデスクへの問い合わせが 80% 減少しました。</p><p>【動画】 <a href="https://www.youtube.com/watch?v=jokwi85vVTA">F5 and Microsoft Rescue a County From Malware</a></p><h2 id="ヌナブト州政府、ランサムウェア攻撃を受けて-Yubico-と-Microsoft-にフィッシング対策を依頼"><a href="#ヌナブト州政府、ランサムウェア攻撃を受けて-Yubico-と-Microsoft-にフィッシング対策を依頼" class="headerlink" title="ヌナブト州政府、ランサムウェア攻撃を受けて Yubico と Microsoft にフィッシング対策を依頼"></a>ヌナブト州政府、ランサムウェア攻撃を受けて Yubico と Microsoft にフィッシング対策を依頼</h2><p><img src="/blog/azure-active-directory/integration-guidance-helps-partners-deliver-zero-trust-solutions/Yubico.png"></p><p>2019 年、カナダのヌナブト州政府はスピア フィッシング攻撃を受け、同州の重要な IT リソースがダウンした状態となりました。この攻撃を受け、ID とアプリケーションの保護が同州の最優先課題となりました。</p><p>Azure AD と YubiKey が共同してヌナブト州政府のセキュリティをアップグレードし、独自のニーズに合ったソリューションを提供することができました。同州政府は、フィッシングに強い認証ソリューションを導入したいと考えていました。また、政府機関ではさまざまな Windows ベースのシステムを使用していましたが、それらは遠隔地にあるため、アクセスする際のネットワークが安定していませんでした。これらの課題に対応するために、ネットワーク、電源、クライアント ソフトウェアを必要とせずに、多要素認証に使用できるハードウェア デバイスである YubiKeys を採用しました。詳しくは <a href="https://www.yubico.com/resources/reference-customers/government-of-nunavut/">Yubico の記事</a> と以下の動画をご覧ください。</p><p>【動画】 <a href="https://www.youtube.com/watch?v=BmdlVrepPhg">The Government of Nunavut turns to phishing-resistant YubiKeys after ransomware attack</a></p><h2 id="より詳細について"><a href="#より詳細について" class="headerlink" title="より詳細について"></a>より詳細について</h2><p>私たちは、パートナーの皆様がゼロ トラストの原則を用いて、重要なサイバーセキュリティ ソリューションをお客様に提供していることを非常に誇りに思っています。ゼロ トラストへの対応については、新しく発行された <a href="https://docs.microsoft.com/ja-jp/security/zero-trust/integrate/overview">パートナー統合ガイダンス</a> をご覧ください。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの 村上 です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 10 月 6 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techco</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>CloudKnox 社の買収について - 現在利用可能なものと近日公開予定のもの</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/CloudKnox-acquisition-whats-available-now-and-whats-coming-soon/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/CloudKnox-acquisition-whats-available-now-and-whats-coming-soon/</id>
    <published>2021-10-03T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:40.972Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの竜です。</p><p>本記事は、2021 年 9 月 30 日に米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/cloudknox-acquisition-what-s-available-now-and-what-s-coming/ba-p/2464367">CloudKnox acquisition: what’s available now and what’s coming soon</a> を意訳したものになります。</p><hr><p>皆さん、こんにちは。</p><p><a href="https://blogs.microsoft.com/blog/2021/07/21/microsoft-acquires-cloudknox-security-to-offer-unified-privileged-access-and-cloud-entitlement-management/">CloudKnox Security 社の買収</a>を発表してから 2 ヶ月が経ち、我々のチームは CloudKnox 社の技術を統合するべく取り組んでいる状況です。この発表に多くの方が関心を持ち、様々な質問が寄せられていますので、進捗状況をお伝えするとともにいくつかの質問にお答えしたいと思います。</p><p><strong>現在 CloudKnox を利用していますが、今後も製品を使い続けることはできますか？</strong></p><p>現在 CloudKnox をご利用のお客様は、サービスの中断や価格の変更なく継続して CloudKnox 製品をご利用いただけます。また、CloudKnox をご利用のお客様は引き続き Microsoft からセールス、エンジニアリング、サービスのサポートを受けることができます。Microsoft のセールスおよびサポートは、マルチクラウド下でのアクセス許可の管理におけるニーズにお応えするため、すべての CloudKnox サービスの提供およびサポートを継続いたします。</p><p><strong>CloudKnox 製品を今すぐ試したり購入したりすることはできますか？</strong></p><p>はい、CloudKnox の既存および新規のお客様をサポートするために、弊社ではセールスとサポートのスタッフを拡大しています。CloudKnox をご利用中のお客様ならびにご利用を検討されているお客様は、CloudKnox または Microsoft の担当者にご連絡ください。マルチクラウド下でのアクセス許可管理について弊社よりどのような支援が可能か情報を提供させていただきます。弊社からの連絡をご希望の場合は、<a href="https://cloudknox.io/contact/">こちらから</a>リクエストください。また、お客様の IT 環境の <a href="https://cloudknox.io/risk-assessment/#identity-risk">アクセス許可のリスク アセスメント (無料)</a> のご依頼も受け付けております。</p><p><strong>CloudKnox がマイクロソフトの傘下に入ったということは、Microsoft Azure のみをサポートし、マルチクラウドには対応しなくなるのでしょうか？</strong></p><p>私たちは、多くのお客様がマルチクラウドを活用しており、クラウド全体のセキュリティとコンプライアンスを管理するためのツールとサービスを必要としていることを存じております。お客様がどのクラウドを利用しているかに関わらず、クラウド基盤のエンタイトルメント管理、ID およびガバナンス機能を備えたマルチクラウド ソリューションを提供することに、我々は 100% コミットしています。何より、Microsoft が CloudKnox 社を買収した一番の理由は、お客様がご利用されている AWS、Google Cloud Platform、VMware の管理をより効率的に支援するためでございます。</p><p><strong>今後の CloudKnox の展望はどうでしょうか？</strong></p><p>製品のロードマップや今後の機能強化については、次の数ヶ月の間にお知らせしますので、楽しみにしていただければと思います。また、Microsoft Ignite も目前に迫っています。Microsoft と CloudKnox チームの取り組みをぜひご覧ください。</p><p>短いアップデートとなりますが、本内容が皆様にとって有益で役に立つものであれば幸いです。皆様のご意見、ご感想をお待ちしております。</p><p>Alex</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの竜です。&lt;/p&gt;
&lt;p&gt;本記事は、2021 年 9 月 30 日に米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommu</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="US Identity Blog" scheme="https://jpazureid.github.io/blog/tags/US-Identity-Blog/"/>
    
  </entry>
  
  <entry>
    <title>Microsoft Graph PowerShell SDK を使用したライセンス管理操作の紹介</title>
    <link href="https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/"/>
    <id>https://jpazureid.github.io/blog/azure-active-directory/operating-license-with-microsoft-graph/</id>
    <published>2021-10-01T00:00:00.000Z</published>
    <updated>2021-12-10T10:01:41.305Z</updated>
    
    <content type="html"><![CDATA[<p>こんにちは、Azure Identity サポート チームの中井です。</p><p>先日、以下にて 米国の Azure Active Directory Identity Blog で公開された <a href="https://techcommunity.microsoft.com/t5/azure-active-directory-identity/migrate-your-apps-to-access-the-license-managements-apis-from/ba-p/2464366">Migrate your apps to access the license managements APIs from Microsoft Graph</a> の翻訳ブログを公開いたしました。</p><p><a href="https://jpazureid.github.io/blog/azure-active-directory/migrate-your-apps-to-access-the-license-managements/">Azure AD Graph および MSOnline での従来のライセンスの割り当て方法が廃止され Microsoft Graph によるライセンス管理に変わります | Japan Azure Identity Support Blog (jpazureid.github.io)</a></p><p>上記記事では、Azure AD Graph エンドポイント廃止に伴い、MSOnline および Azure AD PowerShell モジュールでの従来のライセンス割り当て操作が利用できなくなることがアナウンスされています。そこで本記事では、今後利用が推奨される Microsoft Graph PowerShell (正式名称は Microsoft Graph PowerShell SDK) を使用したライセンス管理の方法をご紹介いたします。</p><h1 id="はじめに-Microsoft-Graph-PowerShell-とは？"><a href="#はじめに-Microsoft-Graph-PowerShell-とは？" class="headerlink" title="はじめに: Microsoft Graph PowerShell とは？"></a>はじめに: Microsoft Graph PowerShell とは？</h1><p><a href="https://docs.microsoft.com/ja-jp/powershell/microsoftgraph/overview?view=graph-powershell-1.0">Microsoft Graph PowerShell</a> は、Microsoft Graph API をコマンドを実行して呼び出せるようにした PowerShell モジュールです。</p><p>では Microsoft Graph API とは何かというと、 Azure AD だけでなく SharePoint、Outlook、Teams などの Microsoft 各サービスにアクセスし、データを取得できる統一のエンドポイントを提供しています。</p><p>Azure AD テナントにおける情報取得は、これまで<a href="https://jpazureid.github.io/blog/azure-active-directory/powershell-module/">MSOnline および Azure AD PowerShell モジュール</a> を用いてきました。Azure AD PowerShell では、2022 年 7 月以降にサポート終了予定の Azure AD Graph API を呼び出しており、上述の翻訳記事では、Set-AzureADUserLicense を中心とするライセンス管理のコマンドが廃止となる予定であることをアナウンスいたしました。</p><p><strong>ライセンス管理操作以外のコマンドは従来通りレスポンスを受け取れる予定です。</strong></p><p>それ以外のコマンドについて Azure AD や MSOnline の PowerShell で提供されていたコマンドで MS Graph PowerShell コマンドで利用できる対照表としては次の公開情報があります。</p><p><a href="https://docs.microsoft.com/en-us/powershell/microsoftgraph/azuread-msoline-cmdlet-map?view=graph-powershell-1.0">Find Azure AD and MSOnline cmdlets in Microsoft Graph PowerShell</a></p><p>対照表にしたがって、 MS Graph コマンドが利用できるものについての移行も併せてお願いしたいところではあるのですが、<br>実際のところ、対応表に記載があるコマンドであっても、従来のパラメーターやプロパティが Microsoft Graph PowerShell コマンドでは一部利用できないものもあります。<br>ライセンス管理以外のコマンドは現時点 (2021 年 10 月段階) では今後も利用可能な見込みであり、それ以外のコマンドについて無理に急いで移行を進める必要が無いということも付記させていただきます。</p><p>状況に変化がありましたら、改めてサポート チームでのブログでもお知らせを予定しています。</p><p>(Azure AD Graph API を呼び出すアプリケーションを作成されている場合、<a href="https://docs.microsoft.com/ja-jp/graph/migrate-azure-ad-graph-overview">公開情報</a> を参考に、Microsoft Graph API への移行をお願いいたします。)</p><hr><p>さて、前置きが長くなってしまいましたが、以下より、Microsoft Graph PowerShell を用いたライセンス管理操作についてご紹介いたします！</p><p>非常にボリュームのある内容となっていますので、目次「3. ライセンス情報の取得」から、知りたい操作のリンクの内容を参照いただくだけでもコマンドを確認可能です (もちろん、初めての操作の場合は 1 や 2 の事前準備が必要です)。</p><p>本記事で紹介する Microsoft Graph PowerShell メソッドの参考情報は、以下の通りとなっております。</p><ul><li><a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.users.actions/set-mguserlicense?view=graph-powershell-1.0">Set-MgUserLicense</a></li><li><a href="https://docs.microsoft.com/ja-jp/powershell/module/microsoft.graph.groups/set-mggrouplicense?view=graph-powershell-1.0">Set-MgUserGroupLicense</a></li></ul><h2 id="目次"><a href="#目次" class="headerlink" title="目次"></a>目次</h2><ol><li><a href="#idx1">Microsoft Graph PowerShell のインストール</a></li><li><a href="#idx2">Connect-MgGraph による Azure AD へのサインイン</a><ul><li><a href="#idx2-1">管理者の資格情報を利用する場合</a></li><li><a href="#idx2-2">サービス プリンシパル（アプリケーション）を利用する方法</a></li></ul></li><li><a href="#idx3">ライセンス情報の取得</a><ul><li><a href="#idx3-1">テナントに紐づくライセンス情報を確認する</a></li><li><a href="#idx3-2">ユーザーに割り当て済みのライセンスを確認する</a></li></ul></li><li><a href="#idx4">シナリオ 1: ユーザーにライセンスを割り当てる</a><ul><li><a href="#idx4-1">すべてのサービス プランを有効にして特定のライセンスを割り当てる</a></li><li><a href="#idx4-2">特定のサービス プランを無効にして特定のライセンスを割り当てる</a></li><li><a href="#idx4-3">複数のサービス プランを無効にして特定のライセンスを割り当てる</a></li><li><a href="#idx4-4">[新機能] グループにライセンスを割り当てる</a></li></ul></li><li><a href="#idx5">シナリオ 2: ユーザーから特定のライセンスを削除する</a><ul><li><a href="#idx5-1">ユーザーから特定のライセンスを削除する</a></li></ul></li><li><a href="#idx6">シナリオ 3: 割り当て済みライセンスの無効にするサービスプランを変更する</a><ul><li><a href="#idx6-1">割り当て済みライセンスの無効にするサービス プランを変更する</a></li><li><a href="#idx6-2">割り当て済みライセンスの無効にしているサービス プランをすべて有効にする</a></li><li><a href="#idx6-3">すでに一部のサービス プランを無効にしているライセンスに対して、追加で特定のサービス プランを無効にする</a></li><li><a href="#idx6-4">すでに 1 つ以上のサービス プランを無効にしているライセンスに対して、特定のサービス プランのみを無効から有効に変える</a></li></ul></li><li><a href="#idx7">シナリオ 4: ライセンスを変更する</a></li><li><a href="#idx8">操作完了後のサインアウト</a></li><li><a href="#idx9">[補足] Set-MgUserLicense : License assignment cannot be done for user with invalid usage location. が出力される場合</a></li></ol><h1 id="idx1">1. Microsoft Graph PowerShell のインストール</h1><p>PowerShell を管理者権限で開き、以下コマンドで、Microsoft Graph PowerShell SDK を操作端末にインストールします。</p><p>※ インストール先をローカル ユーザーのみに限定する場合は、<code>-Scope CurrentUser</code> パラメーターを付けます。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Install-Module Microsoft.Graph</span><br></pre></td></tr></table></figure><p>公開情報：<a href="https://docs.microsoft.com/en-us/graph/powershell/installation">Install the Microsoft Graph PowerShell SDK - Microsoft Graph | Microsoft Docs</a></p><h1 id="idx2">2. Connect-MgGraph による Azure AD への認証</h1><p>Azure AD への認証方法として、<strong>管理者の資格情報を使用する方法</strong>と、<strong>サービス プリンシパル</strong>を利用する方法があります。</p><p>サービス プリンシパルを利用する方法とは、簡単に言うと証明書を発行したアプリケーションにアクセス許可を付与し、アプリケーション経由で Azure AD の認証および操作を行う方法です。管理者自身が操作してライセンスの管理を行う場合は管理者の資格情報を使用する方法でも構いません。バッチ処理など、無人化や自動化を行う場合はサービス プリンシパルを使用します。</p><h2 id="idx2-1">管理者の資格情報を使用する場合</h2><p>以下のコマンドを実行して、サインインとライセンスの管理に必要なアクセス許可への同意を行います。</p><p>認証画面がポップアップしますので、管理者アカウントでサインします。アクセス許可の同意を求められたら [承諾] をクリックします。[組織の代理として同意する] はオフのままで問題ありません。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Connect-MgGraph -Scopes <span class="string">&quot;Organization.Read.All&quot;</span>,<span class="string">&quot;User.ReadWrite.All&quot;</span></span><br></pre></td></tr></table></figure><p>テナントに紐づくライセンスの情報を確認するために Organization.Read.All のアクセス許可が必要です。またライセンスの付与などのために User.ReadWrite.All のアクセス許可が必要です。</p><p>その後、シナリオ 1 以降の操作を行うために必要なモジュールをインポートしておきます。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Import-Module -Name Microsoft.Graph.Users</span><br></pre></td></tr></table></figure><h2 id="idx2-2">サービス プリンシパル（アプリケーション）を使用する方法</h2><p>基本的な内容は以下の公開情報となります。</p><p>公開情報: <a href="https://docs.microsoft.com/ja-jp/graph/powershell/app-only?tabs=azure-portal">Microsoft の PowerShell SDK でアプリGraphを使用する - Microsoft Graph | Microsoft Docs</a></p><p>まず、Azure AD にてアプリケーションの登録を行い、サービス プリンシパルを作成します。</p><ol><li>グローバル 管理者で Azure Portal にサインインし、[Azure Active Directory] – [アプリの登録] – [新規登録] をクリックします。</li><li>[名前] に任意のアプリの名前を入力します。(例: App01)</li><li>[サポートされているアカウントの種類] から [この組織ディレクトリのみに含まれるアカウント] を選択します。</li><li>[リダイレクト URI] で [Web] を選択し、テキスト ボックスは空欄のままにし、[登録] をクリックします。<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/image1.png"></li><li>表示された [アプリケーション (クライアント) ID] と [ディレクトリ (テナント) ID] の値を控えておきます。<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/image2.png"></li><li>[API のアクセス許可] – [+アクセス許可の追加] をクリックします。[Microsoft Graph] – [アプリケーションの許可] をクリックし、[Organization.Read.All] と [User.ReadWrite.All] を選択して [アクセス許可の追加] をクリックします。<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/image3.png"></li><li>[&lt;テナント名&gt; に管理者の同意を与えます] をクリックします。確認が表示されるので [はい] をクリックします。</li></ol><p>続いて、証明書を発行します。</p><ol start="8"><li><p>PowerShell を起動し、以下のようにコマンドを実行します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$mycert</span> = New-SelfSignedCertificate -Subject <span class="string">&quot;CN=SelfSignedCert&quot;</span> -CertStoreLocation <span class="string">&quot;Cert:\CurrentUser\My&quot;</span>  -KeyExportPolicy Exportable -KeySpec Signature</span><br><span class="line"></span><br><span class="line"><span class="comment"># &quot;.\SelfSignedCert.cer&quot; は、エクスポート先のパスを適宜変更ください。</span></span><br><span class="line"><span class="variable">$mycert</span> | Export-Certificate -FilePath <span class="string">&quot;.\SelfSignedCert.cer&quot;</span>  </span><br><span class="line"><span class="variable">$mycert</span> | Select Thumbprint</span><br></pre></td></tr></table></figure></li><li><p>Azure Portal で先ほど登録したアプリのページに戻り、[証明書とシークレット] をクリックします。</p></li><li><p>[証明書のアップロード] をクリックし、9 にて出力された SelfSignedCert.cer をアップロードします。</p></li></ol><p>以上で、準備は完了となります。</p><p>以下コマンドにて、サービス プリンシパルを使用して Azure AD に接続することができます。また、管理者の資格情報を使用する場合と同様、シナリオ 1 以降の操作を行うために必要なモジュールをインポートします。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Connect-MgGraph -Clientid <span class="string">&quot;&lt;登録したアプリのアプリケーション (クライアント) ID&gt;&quot;</span> -TenantId <span class="string">&quot;&lt;アプリを登録したテナントのディレクトリ (テナント) ID&gt;&quot;</span> -CertificateThumbprint <span class="string">&quot;&lt;証明書の拇印&gt;&quot;</span></span><br><span class="line">Import-Module -Name Microsoft.Graph.Users</span><br></pre></td></tr></table></figure><p>▼ 実行例</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Connect-MgGraph -Clientid <span class="string">&quot;89a531e4-38a8-41b3-9a5f-xxxxxxx&quot;</span> -TenantId <span class="string">&quot;a818a9d9-4bf7-4316-b8bb-xxxxxx&quot;</span> -CertificateThumbprint <span class="string">&quot;F683EBBE56184C197699930xxxxxxxxxx&quot;</span></span><br><span class="line">Import-Module -Name Microsoft.Graph.Users</span><br></pre></td></tr></table></figure><h1 id="idx3">3. ライセンス情報の取得</h1><h2 id="idx3-1">テナントに紐づくライセンス情報を確認する</h2><p>以下のコマンドを実行し、テナントに紐づくライセンス情報を確認します。</p><p>※ -Wrap 引数は、出力結果を途切れず折り返し表示するためのパラメーターです。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-MgSubscribedSku | ft Id, SkuId, SkuPartNumber -Wrap</span><br></pre></td></tr></table></figure><p>出力例<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/licenseDetail1.png"></p><p>ライセンスの付与の際には SkuId の値を使用します。そのため、どの SkuId がこれから管理したいライセンスなのかを判別する必要があります。</p><p>SkuPartNumber の値から推測できるものもありますが、詳細は以下の公開情報に記載されていますのでそちらをご参照ください。例えば Microsoft 365 E5 の SkuPartNumber は SPE_E5 で SkuId は 06ebc4ee-1bb5-47dd-8120-11324bc54e06 です。</p><p>公開情報: <a href="https://docs.microsoft.com/ja-jp/azure/active-directory/enterprise-users/licensing-service-plan-reference">ライセンスのための製品名とサービス プラン 識別子</a></p><p>さらにライセンスの中の一部のサービス プランを無効にしたいというシナリオの場合、サービス プランの情報も確認しておく必要があります。その場合は以下のようにコマンドを実行します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-MgSubscribedSku -SubscribedSkuId <span class="string">&quot;&lt;Get-MgSubscribedSku コマンドで確認した、サービス プランを確認したいライセンスの Id&gt;&quot;</span> | Select-Object -ExpandProperty ServicePlans | ft ServicePlanId, ServicePlanName</span><br></pre></td></tr></table></figure><p>▼ 実行例</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-MgSubscribedSku -SubscribedSkuId <span class="string">&quot;a818a9d9-4bf7-4316-b8bb-e0f1a52ce5ea_184efa21-98c3-4e5d-95ab-d07053a96e67&quot;</span> | Select-Object -ExpandProperty ServicePlans | ft ServicePlanId, ServicePlanName</span><br></pre></td></tr></table></figure><p>出力例<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/licenseDetail2.png"></p><h2 id="idx3-2">ユーザーに割り当て済みのライセンスを確認する</h2><p>ユーザーに割り当てられているライセンスを確認するには、<code>Get-MgUser</code> コマンドを使用する方法と、<code>Get-MgUserLicenseDetail</code> コマンドを使用する方法があります。</p><ul><li><code>Get-MgUser</code> コマンド</li></ul><p>Get-MgUser コマンドを使用することで、Set-MgUserLicense コマンドでも使用する MicrosoftGraphAssignedLicense の内容を確認することができます。（出力例は次のコマンド例と一緒に掲載します）</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-MgUser -UserId &lt;対象ユーザーの UPN&gt; -Property AssignedLicenses | Select-Object -ExpandProperty AssignedLicenses</span><br></pre></td></tr></table></figure><ul><li><code>Get-MgUserLicenseDetail</code> コマンド</li></ul><p>Get-MgUserLicenseDetail コマンドを使用することで、ユーザーに割り当てたライセンスやサービス プランのプロビジョニング状況を確認することができます。以下のように実行するとユーザーに割り当てたライセンスの情報を確認できます。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-MgUserLicenseDetail -UserId &lt;対象ユーザーの UPN&gt;</span><br></pre></td></tr></table></figure><p>出力例<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/licenseDetail3.png"></p><p>サービス プランの情報を確認するには以下のようにコマンドを実行します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Get-MgUserLicenseDetail -UserId &lt;対象ユーザーの UPN&gt; | Select-Object -ExpandProperty ServicePlans</span><br></pre></td></tr></table></figure><p>出力例<br><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/licenseDetail4.png"></p><h1 id="idx4">シナリオ 1: ユーザーにライセンスを割り当てる</h1><p>ユーザーにライセンスを割り当てます。まだライセンスが何も割り当てられていない場合であっても、既に割り当てられており追加する場合でも、どちらも手順は同じです。</p><h2 id="idx4-1"> すべてのサービス プランを有効にして特定のライセンスを割り当てる</h2><p>割り当てるライセンスの SkuId を指定した MicrosoftGraphAssignedLicense オブジェクトを作成し、<code>Set-MgUserLicense</code> コマンドの AddLicenses パラメーターに配列として指定します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = New-Object -TypeName Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense -Property @&#123;SkuId = <span class="string">&quot;&lt;割り当てるライセンスの SkuId&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses @(<span class="variable">$License1</span>) -RemoveLicenses @()</span><br></pre></td></tr></table></figure><p>▼ 実行例</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = New-Object -TypeName Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense -Property @&#123;SkuId = <span class="string">&quot;06ebc4ee-1bb5-47dd-8120-11324bc54e06&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId TestGraphUser01@contoso.onmicrosoft.com -AddLicenses @(<span class="variable">$License1</span>) -RemoveLicenses @()</span><br></pre></td></tr></table></figure><p>複数のライセンスを割り当てる場合はそれぞれの MicrosoftGraphAssignedLicense オブジェクトを作成し、<code>Set-MgUserLicense</code> コマンドの AddLicenses パラメーターに、以下のようにカンマ区切りで指定します。</p><p>▼ 実行例</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Set-MgUserLicense -UserId TestGraphUser01@contoso.onmicrosoft.com -AddLicenses @(<span class="variable">$License1</span>, <span class="variable">$License2</span>) -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h2 id="idx4-2"> 特定のサービス プランを無効にして特定のライセンスを割り当てる</h2><p>ライセンス割り当て時に無効にするサービス プランがある場合は DisablePlans に ServicePlanId を配列として指定します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = New-Object -TypeName Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense -Property @&#123;SkuId = <span class="string">&quot;&lt;割り当てるライセンスの SkuId&gt;&quot;</span>; DisabledPlans = @(<span class="string">&quot;&lt;無効にするサービス プランの ServicePlanId&gt;&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses @(<span class="variable">$License1</span>) -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h2 id="idx4-3">複数のサービス プランを無効にして特定のライセンスを割り当てる</h2><p>無効にするサービス プランが複数ある場合も、「複数のライセンスを割り当てる」 同様、 DisablePlans に ServicePlanId をカンマ区切りで指定します。</p><h2 id="idx4-4">[新機能] グループにライセンスを割り当てる</h2><p>Microsoft Graph PowerShell では、<code>Set-MgGroupLicense</code> コマンドにより、グループに対するライセンス割り当てを行うことが可能となりました。</p><p>使い方は、ライセンス割り当て対象として UserId ではなく GroupId パラメーターを用います。その他の引数は <code>Set-MgUserLicense</code> と同様です。</p><p>▼ すべてのサービス プランを有効にして特定のライセンスを割り当てる場合の実行例</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Set-MgGroupLicense -GroupId &lt;対象グループの ObjectId&gt; -AddLicenses @(<span class="variable">$License1</span>) -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h1 id="idx5">シナリオ 2: ユーザーからライセンスを削除する</h1><h2 id="idx5-1">ユーザーから特定のライセンスを削除する</h2><p>ユーザーからライセンスを削除するには <code>Set-MgUserLicense</code> コマンドの RemoveLicenses パラメーターに削除したいライセンスの SkuId を配列として指定します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses @() -RemoveLicenses @(<span class="string">&quot;&lt;削除するライセンスの SkuId&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="idx6"> シナリオ 3: 割り当て済みライセンスの無効にするサービス プランを変更する</h1><p>ライセンスを割り当てる場合と同じ方法で、DisabledPlans の内容を変更してコマンドを実行することにより、無効にするサービス プランを変更することができます。上書きになるので、元々無効だったサービス プランを引き続き無効にしたいのであれば DisabledPlans に改めて指定する必要があります。</p><h2 id="idx6-1">割り当て済みライセンスの無効にするサービス プランを変更する</h2><p>以下の例では、割り当て済みのライセンスに関して指定した 2 つのサービス プランだけを無効にします。指定していないサービス プランは有効になります。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = New-Object -TypeName Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense -Property @&#123;SkuId = <span class="string">&quot;&lt;無効にするサービス プランを変更する割り当て済みライセンスの SkuId&gt;&quot;</span>; DisabledPlans = @(<span class="string">&quot;&lt;無効にするサービス プランの ServicePlanId (1 つ目)&gt;&quot;</span>, <span class="string">&quot;&lt;無効にするサービス プランの ServicePlanId (2 つ目)&gt;&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses <span class="variable">$License1</span> -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h2 id="idx6-2">割り当て済みライセンスの無効にしているサービス プランをすべて有効にする</h2><p>割り当て済みライセンスの無効にしているサービス プランをすべて有効にするには、DisabledPlans に何も指定をせずにコマンドを実行します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = New-Object -TypeName Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense -Property @&#123;SkuId = <span class="string">&quot;&lt;すべてのサービス プランを有効にする割り当て済みライセンスの SkuId&gt;&quot;</span>; DisabledPlans = @()&#125;</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses <span class="variable">$License1</span> -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h2 id="idx6-3">すでに一部のサービス プランを無効にしているライセンスに対して、追加で特定のサービス プランを無効にする</h2><p>すでに一部のサービス プランを無効にしているライセンスに対して、追加で特定のサービス プランを無効にする場合、現在の DisablePlans の内容を取得した上で追加を行います。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = Get-MgUser -UserId &lt;対象ユーザーの UPN&gt; -Property AssignedLicenses | Select-Object -ExpandProperty AssignedLicenses | ?&#123;<span class="variable">$_</span>.SkuId -eq <span class="string">&quot;&lt;対象の割り当て済みライセンスの SkuId&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$License1</span>.DisabledPlans += <span class="string">&quot;&lt;追加で無効にするサービス プランの ServicePlanId&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses <span class="variable">$License1</span> -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h2 id="idx6-4">すでに 1 つ以上のサービス プランを無効にしているライセンスに対して、特定のサービス プランのみを無効から有効に変える</h2><p>すでに 1 つ以上のサービス プランを無効にしているライセンスに対して、特定のサービス プランのみを無効から有効に変える現在の DisablePlans の内容を取得した上で有効にするサービス プランを取り除きます。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = Get-MgUser -UserId &lt;対象ユーザーの UPN&gt; -Property AssignedLicenses | Select-Object -ExpandProperty AssignedLicenses | ?&#123;<span class="variable">$_</span>.SkuId -eq <span class="string">&quot;&lt;対象の割り当て済みライセンスの SkuId&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$License1</span>.DisabledPlans = @(<span class="variable">$License1</span>.DisabledPlans | ?&#123;<span class="variable">$_</span> -ne <span class="string">&quot;&lt;無効から有効に変えるサービス プランの ServicePlanId&gt;&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId &lt;対象ユーザーの UPN&gt; -AddLicenses <span class="variable">$License1</span> -RemoveLicenses @()</span><br></pre></td></tr></table></figure><h1 id="idx7">シナリオ 4: ライセンスを変更する</h1><p>現在割り当て済みのライセンスを削除して別のライセンスを割り当てるには、現在割り当て済みのライセンスは RemoveLicenses に指定し、新しく割り当てるライセンスを AddLicenses に指定します。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="variable">$License1</span> = New-Object -TypeName Microsoft.Graph.PowerShell.Models.MicrosoftGraphAssignedLicense -Property @&#123;SkuId = <span class="string">&quot;&lt;新しく割り当てるライセンスの SkuId&gt;&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">Set-MgUserLicense -UserId TestGraphUser01@contoso.onmicrosoft.com -AddLicenses @(<span class="variable">$License1</span>) -RemoveLicenses @(<span class="string">&quot;&lt;現在割り当て済みのライセンス&gt;&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="idx8">4. 操作完了後のサインアウト</h1>以下のコマンドを実行し、Azure AD よりサインアウトします。<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Disconnect-MgGraph</span><br></pre></td></tr></table></figure><h1 id="idx9">[補足] Set-MgUserLicense : License assignment cannot be done for user with invalid usage location. が出力される場合</h1><p><code>Set-MgUserLicense</code> を実行し、以下のようなエラーが出力される場合は、ライセンス付与対象のユーザーに UsageLocation（利用場所）属性が設定されていないことが原因です。</p><p>エラー例</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Set-MgUserLicense -UserId TestGraphUser01@contoso.onmicrosoft.com -AddLicenses @(<span class="variable">$License1</span>) -RemoveLicenses @()</span><br><span class="line">Set-MgUserLicense : License assignment cannot be <span class="keyword">done</span> <span class="keyword">for</span> user with invalid usage location.</span><br><span class="line">At line:1 char:1</span><br><span class="line">+ Set-MgUserLicense -UserId TestGraphUser01@contoso.onmicrosoft.com -AddLicenses @ ...</span><br><span class="line">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><br><span class="line">    + CategoryInfo          : InvalidOperation: (&#123; UserId = test...ionJsonSchema &#125;:&lt;&gt;f__AnonymousType10`2) [Set-MgUserLice</span><br><span class="line">   nse_AssignExpanded], RestException`1</span><br><span class="line">    + FullyQualifiedErrorId : Request_BadRequest,Microsoft.Graph.PowerShell.Cmdlets.SetMgUserLicense_AssignExpanded</span><br></pre></td></tr></table></figure><p>ライセンスを割り当てるユーザーは、事前に UsageLocation 属性が設定されている必要があるため、もし、上記エラーが出た場合は、以下のようなコマンドで UsageLocation を設定します。</p><p>この例ではユーザーの UsageLocation を ”JP”（日本） に設定します。<br>その後、ライセンスの割り当てなどのコマンドを再実行ください。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Update-MgUser &lt;対象ユーザーの UPN&gt; -UsageLocation <span class="string">&quot;JP&quot;</span></span><br></pre></td></tr></table></figure><p>また、UsageLocation 属性が設定されているかどうかは、[Azure Active Directory] &gt; [すべてのユーザー] &gt; [&lt;ライセンス付与対象のユーザー&gt;] より、プロファイルの「利用場所」項目から確認可能です。</p><p><img src="/blog/azure-active-directory/operating-license-with-microsoft-graph/image4.png"></p><p>本記事が皆様の参考となれば幸いです。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;こんにちは、Azure Identity サポート チームの中井です。&lt;/p&gt;
&lt;p&gt;先日、以下にて 米国の Azure Active Directory Identity Blog で公開された &lt;a href=&quot;https://techcommunity.microso</summary>
      
    
    
    
    
    <category term="Azure AD" scheme="https://jpazureid.github.io/blog/tags/Azure-AD/"/>
    
    <category term="Microsoft Graph" scheme="https://jpazureid.github.io/blog/tags/Microsoft-Graph/"/>
    
  </entry>
  
</feed>
